{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/db/useNotes.ts"],"sourcesContent":["\"use client\";\n\nimport { useLiveQuery } from \"dexie-react-hooks\";\nimport db, { Note, OperationType, EntityType, Folder } from \"./clientDb\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { useTier } from \"./useTier\";\nimport { triggerSync } from \"../sync/syncService\";\n\n// --- 1. Notes Hook ---\nexport function useNotes() {\n  const tier = useTier();\n  const canSync = !!tier;\n\n  // Live Query: Fetches notes and sorts them (Pinned first, then by Updated date)\n  const notes = useLiveQuery(async () => {\n    const activeNotes = await db.notes\n      .filter((note) => note.deletedAt === null)\n      .sortBy(\"updatedAt\");\n    activeNotes.reverse(); // Newest first\n    return activeNotes.sort(\n      (a, b) => (b.isPinned ? 1 : 0) - (a.isPinned ? 1 : 0)\n    );\n  }, []);\n\n  // Helper: Update a note\n  const updateNote = async (id: string, updates: Partial<Note>) => {\n    const now = Date.now();\n    const updatedFields = { ...updates, updatedAt: now };\n\n    await db.notes.update(id, updatedFields);\n\n    if (canSync) {\n      const updatedNote = await db.notes.get(id);\n      if (updatedNote) {\n        const syncOp = {\n          id: uuidv4(),\n          entityType: \"note\" as EntityType,\n          operation: \"update\" as OperationType,\n          payload: updatedNote,\n          timestamp: now,\n        };\n        await db.syncOutbox.add(syncOp);\n        console.log(\"ðŸ“¤ Added UPDATE note to sync outbox:\", updatedNote.id);\n        triggerSync();\n      }\n    }\n  };\n\n  // Helper: Add a new note\n  const addNote = async (payload: {\n    title: string;\n    content: string;\n    folderId?: string | null;\n    isQuickNote?: boolean; // [FIX] Supports Quick Notes flag\n  }) => {\n    const now = Date.now();\n    const newNote: Note = {\n      id: uuidv4(),\n      title: payload.title,\n      content: payload.content,\n      createdAt: now,\n      updatedAt: now,\n      folderId: payload.folderId || null,\n      isPinned: false,\n      isLocked: false,\n      isQuickNote: payload.isQuickNote || false, // [FIX] Default to false\n      deletedAt: null,\n      tags: [],\n    };\n\n    await db.notes.add(newNote);\n\n    if (canSync) {\n      const syncOp = {\n        id: uuidv4(),\n        entityType: \"note\" as EntityType,\n        operation: \"create\" as OperationType,\n        payload: newNote,\n        timestamp: now,\n      };\n      await db.syncOutbox.add(syncOp);\n      console.log(\"ðŸ“¤ Added CREATE note to sync outbox:\", newNote.id);\n      triggerSync();\n    }\n    return newNote;\n  };\n\n  // Legacy support (can be removed if not used, but kept for safety)\n  const addQuickNote = async (payload: { title: string; content: string }) => {\n    return addNote({ ...payload, isQuickNote: true });\n  };\n\n  // Soft Delete (Move to Trash)\n  const deleteNote = async (id: string) => {\n    console.log(`ðŸ—‘ï¸ Moving note to trash: ${id}`);\n    return updateNote(id, { deletedAt: Date.now(), isPinned: false });\n  };\n\n  // Hard Delete (Permanent)\n  const deleteNotePermanently = async (id: string) => {\n    console.log(`ðŸ”¥ Permanently deleting note: ${id}`);\n\n    await db.notes.delete(id);\n\n    if (canSync) {\n      const syncOp = {\n        id: uuidv4(),\n        entityType: \"note\" as EntityType,\n        operation: \"delete\" as OperationType,\n        payload: { id },\n        timestamp: Date.now(),\n      };\n      await db.syncOutbox.add(syncOp);\n      console.log(\"ðŸ“¤ Added DELETE note to sync outbox:\", id);\n      triggerSync();\n    }\n  };\n\n  const recoverNote = async (id: string) => {\n    console.log(`â™»ï¸ Recovering note from trash: ${id}`);\n    return updateNote(id, { deletedAt: null });\n  };\n\n  const pinNote = (id: string) => updateNote(id, { isPinned: true });\n  const unpinNote = (id: string) => updateNote(id, { isPinned: false });\n\n  const lockNote = (id: string) => updateNote(id, { isLocked: true });\n  const unlockNote = (id: string) => updateNote(id, { isLocked: false });\n\n  const moveNoteToFolder = (id: string, folderId: string | null) =>\n    updateNote(id, { folderId });\n\n  // Tag Management\n  const addTagToNote = async (id: string, tag: string) => {\n    const note = await db.notes.get(id);\n    if (!note) return;\n\n    const cleanTag = tag.trim().toLowerCase();\n    if (cleanTag && !(note.tags || []).includes(cleanTag)) {\n      return updateNote(id, { tags: [...(note.tags || []), cleanTag] });\n    }\n  };\n\n  const removeTagFromNote = async (id: string, tag: string) => {\n    const note = await db.notes.get(id);\n    if (!note) return;\n\n    const cleanTag = tag.trim().toLowerCase();\n    const newTags = (note.tags || []).filter((t) => t !== cleanTag);\n    return updateNote(id, { tags: newTags });\n  };\n\n  return {\n    notes,\n    addNote,\n    addQuickNote,\n    updateNote,\n    deleteNote,\n    deleteNotePermanently,\n    recoverNote,\n    pinNote,\n    unpinNote,\n    lockNote,\n    unlockNote,\n    moveNoteToFolder,\n    addTagToNote,\n    removeTagFromNote,\n  };\n}\n\n// --- 2. Trash Hook ---\nexport function useTrashNotes() {\n  const notes = useLiveQuery(\n    () =>\n      db.notes.filter((note) => note.deletedAt !== null).sortBy(\"deletedAt\"),\n    []\n  );\n\n  return {\n    trashedNotes: notes,\n  };\n}\n\n// --- 3. Folders Hook ---\nexport function useFolders() {\n  const tier = useTier();\n  const canSync = !!tier;\n\n  const folders = useLiveQuery(() => db.folders.orderBy(\"name\").toArray(), []);\n\n  const addFolder = async (name: string) => {\n    const now = Date.now();\n    const newFolder: Folder = {\n      id: uuidv4(),\n      name,\n      createdAt: now,\n      updatedAt: now,\n    };\n\n    await db.folders.add(newFolder);\n    console.log(\"Folder added:\", newFolder.id);\n\n    if (canSync) {\n      const syncOp = {\n        id: uuidv4(),\n        entityType: \"folder\" as EntityType,\n        operation: \"create\" as OperationType,\n        payload: newFolder,\n        timestamp: now,\n      };\n      await db.syncOutbox.add(syncOp);\n      triggerSync();\n    }\n    return newFolder;\n  };\n\n  const updateFolder = async (id: string, updates: Partial<Folder>) => {\n    const now = Date.now();\n    const updatedFields = { ...updates, updatedAt: now };\n\n    await db.folders.update(id, updatedFields);\n\n    if (canSync) {\n      const updatedFolder = await db.folders.get(id);\n      if (updatedFolder) {\n        const syncOp = {\n          id: uuidv4(),\n          entityType: \"folder\" as EntityType,\n          operation: \"update\" as OperationType,\n          payload: updatedFolder,\n          timestamp: now,\n        };\n        await db.syncOutbox.add(syncOp);\n        triggerSync();\n      }\n    }\n  };\n\n  // [FIX] Robust delete logic: Moves notes out of folder, then deletes folder\n  const deleteFolder = async (id: string) => {\n    console.log(`ðŸ”¥ Deleting folder: ${id}`);\n    const notesToMove = await db.notes.where(\"folderId\").equals(id).toArray();\n\n    // Transaction ensures data integrity\n    await db.transaction(\"rw\", db.notes, db.folders, async () => {\n      const now = Date.now();\n      if (notesToMove.length > 0) {\n        const noteUpdates = notesToMove.map((note) => {\n          // Set folderId to null (move to \"All Notes\")\n          return db.notes.update(note.id, { folderId: null, updatedAt: now });\n        });\n        await Promise.all(noteUpdates);\n      }\n      await db.folders.delete(id);\n    });\n\n    // Sync operations\n    if (canSync) {\n      const now = Date.now();\n      for (const note of notesToMove) {\n        const updatedNote = await db.notes.get(note.id);\n        if (updatedNote) {\n          const noteSyncOp = {\n            id: uuidv4(),\n            entityType: \"note\" as EntityType,\n            operation: \"update\" as OperationType,\n            payload: updatedNote,\n            timestamp: now,\n          };\n          await db.syncOutbox.add(noteSyncOp);\n        }\n      }\n\n      const folderSyncOp = {\n        id: uuidv4(),\n        entityType: \"folder\" as EntityType,\n        operation: \"delete\" as OperationType,\n        payload: { id },\n        timestamp: now,\n      };\n      await db.syncOutbox.add(folderSyncOp);\n      triggerSync();\n    }\n  };\n\n  return {\n    folders,\n    addFolder,\n    updateFolder,\n    deleteFolder,\n  };\n}\n\n// --- 4. Tags Hook ---\nexport function useNoteTags() {\n  const allTags = useLiveQuery(async () => {\n    const notes = await db.notes.toArray();\n    // Collect unique tags\n    const tagSet = new Set<string>();\n    notes.forEach((note) => {\n      (note.tags || []).forEach((tag) => tagSet.add(tag));\n    });\n    return Array.from(tagSet).sort();\n  }, []);\n\n  return {\n    tags: allTags,\n  };\n}\n\n// --- 5. User Metadata Hook ---\nexport function useUserMetadata() {\n  // Used to check if `hasNotesPassword` is true globally\n  const metadata = useLiveQuery(() => db.userMetadata.limit(1).first(), []);\n\n  return {\n    metadata,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/NotesSidebar.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport {\n  useFolders,\n  useNotes,\n  useTrashNotes,\n  useNoteTags,\n} from \"@/lib/db/useNotes\";\nimport {\n  Folder,\n  FolderPlus,\n  Notebook,\n  PanelLeftClose,\n  Trash2,\n  Zap,\n  Tag,\n  PanelRightClose,\n} from \"lucide-react\";\nimport * as ContextMenu from \"@radix-ui/react-context-menu\";\n\n// --- 1. Simple Tooltip Component (No external libraries needed) ---\nconst SidebarBtnWithTooltip = ({\n  onClick,\n  icon: Icon,\n  label,\n  isActive = false,\n  className = \"\",\n}: {\n  onClick: (e: React.MouseEvent) => void;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  icon: any;\n  label: string;\n  isActive?: boolean;\n  className?: string;\n}) => (\n  <div className=\"relative group flex justify-center my-1\">\n    <button\n      onClick={onClick}\n      className={`\n        p-2 rounded-md transition-colors duration-200\n        ${\n          isActive\n            ? \"bg-blue-100 text-blue-600\"\n            : \"text-gray-500 hover:bg-gray-100 hover:text-gray-900\"\n        }\n        ${className}\n      `}\n    >\n      <Icon size={20} strokeWidth={2} />\n    </button>\n    {/* Tooltip */}\n    <span className=\"absolute left-full top-1/2 -translate-y-1/2 ml-2 bg-gray-900 text-white text-[10px] font-medium px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-sm\">\n      {label}\n      {/* Tiny arrow pointing left */}\n      <span className=\"absolute top-1/2 -translate-y-1/2 -left-1 border-4 border-transparent border-r-gray-900\"></span>\n    </span>\n  </div>\n);\n\n// --- 2. New Folder Modal (Kept same) ---\nfunction NewFolderModal({\n  onClose,\n  onCreate,\n}: {\n  onClose: () => void;\n  onCreate: (name: string) => void;\n}) {\n  const [name, setName] = useState(\"New Folder\");\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (name.trim()) onCreate(name.trim());\n  };\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n      onClick={onClose}\n    >\n      <form\n        onSubmit={handleSubmit}\n        onClick={(e) => e.stopPropagation()}\n        className=\"bg-white rounded-2xl shadow-2xl w-80 p-6 animate-in fade-in zoom-in-95 duration-200\"\n      >\n        <h4 className=\"text-sm font-bold mb-4 text-gray-800\">\n          Create New Folder\n        </h4>\n        <label\n          htmlFor=\"folderName\"\n          className=\"text-xs font-semibold text-gray-500 uppercase tracking-wider\"\n        >\n          Name\n        </label>\n        <input\n          id=\"folderName\"\n          type=\"text\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          className=\"w-full border-b-2 border-gray-200 py-2 text-sm focus:outline-none focus:border-blue-500 transition-colors\"\n          autoFocus\n          onFocus={(e) => e.target.select()}\n        />\n        <div className=\"flex justify-end gap-3 mt-6\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-xs font-semibold text-gray-500 hover:bg-gray-100 rounded-lg transition-colors\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 text-xs font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition-colors shadow-md hover:shadow-lg\"\n          >\n            Create\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n\n// --- 3. Main Sidebar Component ---\nexport function NotesSidebar({\n  isCollapsed,\n  onToggleClick,\n  selectedView,\n  setSelectedView,\n}: {\n  isCollapsed: boolean;\n  onToggleClick: () => void;\n  selectedView: string;\n  setSelectedView: (view: string) => void;\n}) {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const { notes } = useNotes();\n  const { trashedNotes } = useTrashNotes();\n  const { folders, addFolder, deleteFolder } = useFolders();\n  const { tags } = useNoteTags();\n\n  const handleCreateFolder = async (folderName: string) => {\n    const newFolder = await addFolder(folderName);\n    setSelectedView(newFolder.id);\n    setIsModalOpen(false);\n  };\n\n  const handleDeleteFolder = (folderId: string) => {\n    if (confirm(\"Delete this folder? Notes inside will be moved to Trash.\")) {\n      deleteFolder(folderId);\n      if (selectedView === folderId) {\n        setSelectedView(\"all\");\n      }\n    }\n  };\n\n  // Counts\n  const quickNotesCount = notes?.filter((n) => n.isQuickNote).length || 0;\n  const allNotesCount = notes?.filter((n) => !n.isQuickNote).length || 0;\n  const trashCount = trashedNotes?.length || 0;\n\n  // --- Collapsed View ---\n  if (isCollapsed) {\n    return (\n      <div className=\"flex flex-col h-full items-center bg-gray-50/50\">\n        {/* Top Toolbar */}\n        <div className=\"w-full flex justify-center py-3 border-b border-gray-200\">\n          <SidebarBtnWithTooltip\n            onClick={onToggleClick}\n            icon={PanelRightClose}\n            label=\"Expand Sidebar\"\n          />\n        </div>\n\n        {/* Scrollable Icons */}\n        <div className=\"flex-1 overflow-y-auto w-full py-2 no-scrollbar\">\n          <SidebarBtnWithTooltip\n            onClick={() => setIsModalOpen(true)}\n            icon={FolderPlus}\n            label=\"New Folder\"\n          />\n\n          <div className=\"my-2 h-px w-8 bg-gray-200 mx-auto\" />\n\n          <SidebarBtnWithTooltip\n            onClick={() => setSelectedView(\"quick\")}\n            icon={Zap}\n            label=\"Quick Notes\"\n            isActive={selectedView === \"quick\"}\n          />\n          <SidebarBtnWithTooltip\n            onClick={() => setSelectedView(\"all\")}\n            icon={Notebook}\n            label=\"All Notes\"\n            isActive={selectedView === \"all\"}\n          />\n          <SidebarBtnWithTooltip\n            onClick={() => setSelectedView(\"trash\")}\n            icon={Trash2}\n            label=\"Trash\"\n            isActive={selectedView === \"trash\"}\n          />\n\n          <div className=\"my-2 h-px w-8 bg-gray-200 mx-auto\" />\n\n          {/* Folders */}\n          {folders?.map((folder) => (\n            <SidebarBtnWithTooltip\n              key={folder.id}\n              onClick={() => setSelectedView(folder.id)}\n              icon={Folder}\n              label={folder.name}\n              isActive={selectedView === folder.id}\n            />\n          ))}\n\n          {/* Tags */}\n          {tags?.map((tag) => (\n            <SidebarBtnWithTooltip\n              key={tag}\n              onClick={() => setSelectedView(`tag-${tag}`)}\n              icon={Tag}\n              label={`#${tag}`}\n              isActive={selectedView === `tag-${tag}`}\n            />\n          ))}\n        </div>\n\n        {isModalOpen && (\n          <NewFolderModal\n            onClose={() => setIsModalOpen(false)}\n            onCreate={handleCreateFolder}\n          />\n        )}\n      </div>\n    );\n  }\n\n  // --- Expanded View ---\n  const getNavItemClasses = (id: string) => {\n    const isActive = selectedView === id;\n    return `\n      flex items-center gap-3 px-4 py-2.5 cursor-pointer rounded-lg mx-3 my-1 \n      text-sm font-medium transition-all duration-200\n      ${\n        isActive\n          ? \"bg-white text-blue-600 shadow-sm ring-1 ring-gray-100\"\n          : \"text-gray-600 hover:bg-gray-100 hover:text-gray-900\"\n      }\n    `;\n  };\n\n  return (\n    <>\n      <div className=\"flex flex-col h-full bg-gray-50/30\">\n        {/* Toolbar */}\n        <div className=\"flex items-center px-4 h-[52px] border-b border-gray-200\">\n          <button\n            className=\"p-1.5 text-gray-500 hover:bg-gray-200 rounded-md transition-colors\"\n            onClick={onToggleClick}\n            title=\"Collapse Sidebar\"\n          >\n            <PanelLeftClose size={20} />\n          </button>\n          <div className=\"flex-grow\" />\n          <button\n            className=\"p-1.5 text-gray-500 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors\"\n            onClick={() => setIsModalOpen(true)}\n            title=\"Create Folder\"\n          >\n            <FolderPlus size={20} />\n          </button>\n        </div>\n\n        {/* List */}\n        <div className=\"flex-1 overflow-y-auto py-4 custom-scrollbar\">\n          <ul>\n            <li\n              className={getNavItemClasses(\"quick\")}\n              onClick={() => setSelectedView(\"quick\")}\n            >\n              <Zap\n                size={18}\n                className={selectedView === \"quick\" ? \"fill-blue-100\" : \"\"}\n              />\n              <span>Quick Notes</span>\n              <span className=\"ml-auto text-xs font-bold opacity-60\">\n                {quickNotesCount}\n              </span>\n            </li>\n            <li\n              className={getNavItemClasses(\"all\")}\n              onClick={() => setSelectedView(\"all\")}\n            >\n              <Notebook size={18} />\n              <span>All Notes</span>\n              <span className=\"ml-auto text-xs font-bold opacity-60\">\n                {allNotesCount}\n              </span>\n            </li>\n            <li\n              className={getNavItemClasses(\"trash\")}\n              onClick={() => setSelectedView(\"trash\")}\n            >\n              <Trash2 size={18} />\n              <span>Trash</span>\n              <span className=\"ml-auto text-xs font-bold opacity-60\">\n                {trashCount}\n              </span>\n            </li>\n          </ul>\n\n          {/* Custom Folders */}\n          <div className=\"mt-6 mb-2 px-5 flex items-center justify-between\">\n            <h3 className=\"text-[11px] font-bold text-gray-400 uppercase tracking-wider\">\n              Folders\n            </h3>\n          </div>\n          <ul>\n            {folders?.map((folder) => (\n              <ContextMenu.Root key={folder.id}>\n                <ContextMenu.Trigger>\n                  <li\n                    className={getNavItemClasses(folder.id)}\n                    onClick={() => setSelectedView(folder.id)}\n                  >\n                    <Folder\n                      size={18}\n                      className={\n                        selectedView === folder.id ? \"fill-blue-100\" : \"\"\n                      }\n                    />\n                    <span className=\"truncate\">{folder.name}</span>\n                    <span className=\"ml-auto text-xs font-bold opacity-60\">\n                      {notes?.filter((n) => n.folderId === folder.id).length ||\n                        0}\n                    </span>\n                  </li>\n                </ContextMenu.Trigger>\n                <ContextMenu.Content className=\"bg-white rounded-lg shadow-xl border border-gray-100 p-1 min-w-[150px] z-50 animate-in fade-in zoom-in-95\">\n                  <ContextMenu.Item\n                    onSelect={() => handleDeleteFolder(folder.id)}\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm text-red-600 rounded-md hover:bg-red-50 cursor-pointer outline-none\"\n                  >\n                    <Trash2 size={14} />\n                    Delete Folder\n                  </ContextMenu.Item>\n                </ContextMenu.Content>\n              </ContextMenu.Root>\n            ))}\n          </ul>\n\n          {/* Tags */}\n          <div className=\"mt-6 mb-2 px-5\">\n            <h3 className=\"text-[11px] font-bold text-gray-400 uppercase tracking-wider\">\n              Tags\n            </h3>\n          </div>\n          <ul>\n            {!tags || tags.length === 0 ? (\n              <li className=\"px-5 py-2 text-xs text-gray-400 italic\">\n                No tags yet...\n              </li>\n            ) : (\n              tags.map((tag) => (\n                <li\n                  key={tag}\n                  className={getNavItemClasses(`tag-${tag}`)}\n                  onClick={() => setSelectedView(`tag-${tag}`)}\n                >\n                  <Tag size={16} />\n                  <span className=\"truncate\">#{tag}</span>\n                </li>\n              ))\n            )}\n          </ul>\n        </div>\n      </div>\n\n      {isModalOpen && (\n        <NewFolderModal\n          onClose={() => setIsModalOpen(false)}\n          onCreate={handleCreateFolder}\n        />\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 963, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/NotePasswordModals.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport * as Dialog from \"@radix-ui/react-dialog\";\nimport { Loader2, Lock, Eye, EyeOff } from \"lucide-react\";\nimport db from \"@/lib/db/clientDb\"; // [NEW] Import the client DB\nimport { useSession } from \"next-auth/react\"; // [NEW] Import useSession\n\n/**\n * [NEW] Modal for *creating* the notes password\n */\nexport function CreateNotePasswordModal({\n  onClose,\n  onSuccess,\n}: {\n  onClose: () => void;\n  onSuccess: (password: string) => void;\n}) {\n  const [password, setPassword] = useState(\"\");\n  const [confirm, setConfirm] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const { data: session } = useSession(); // [NEW] Get the user's session\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (password !== confirm) {\n      setError(\"Passwords do not match.\");\n      return;\n    }\n    if (password.length < 4) {\n      setError(\"Password must be at least 4 characters long.\");\n      return;\n    }\n\n    setLoading(true);\n    try {\n      const res = await fetch(\"/api/notes-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ action: \"set\", password }),\n      });\n\n      if (!res.ok) {\n        throw new Error(\"Failed to set password\");\n      }\n\n      // [THE FIX]\n      // Manually update the local Dexie DB so our hook sees the change.\n      if (session?.user?.id) {\n        await db.userMetadata.update(session.user.id, {\n          hasNotesPassword: true,\n        });\n      }\n\n      // Success! Call the onSuccess prop to close and unlock.\n      onSuccess(password);\n    } catch {\n      setError(\"An error occurred. Please try again.\");\n    }\n    setLoading(false);\n  };\n\n  return (\n    <Dialog.Root open onOpenChange={onClose}>\n      <Dialog.Portal>\n        <Dialog.Overlay className=\"fixed inset-0 z-50 bg-black/50\" />\n        <Dialog.Content\n          className=\"fixed z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2\"\n          onInteractOutside={(e) => e.preventDefault()} // Don't close on click outside\n        >\n          <form\n            onSubmit={handleSubmit}\n            className=\"bg-white rounded-lg shadow-xl w-96 p-6\"\n          >\n            <Dialog.Title className=\"text-lg font-semibold mb-2 text-center\">\n              Create Notes Password\n            </Dialog.Title>\n            <Dialog.Description className=\"text-sm text-gray-600 mb-4 text-center\">\n              This password will protect all your locked notes.\n            </Dialog.Description>\n\n            {/* Password Input */}\n            <div className=\"mb-3\">\n              <label\n                htmlFor=\"password\"\n                className=\"text-sm font-medium text-gray-700\"\n              >\n                Password\n              </label>\n              <div className=\"relative\">\n                <input\n                  id=\"password\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={password}\n                  onChange={(e) => setPassword(e.target.value)}\n                  autoComplete=\"new-password\"\n                  className=\"w-full border border-gray-400 rounded-md px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-black\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={() => setShowPassword(!showPassword)}\n                  className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-500\"\n                >\n                  {showPassword ? (\n                    <EyeOff className=\"w-4 h-4\" />\n                  ) : (\n                    <Eye className=\"w-4 h-4\" />\n                  )}\n                </button>\n              </div>\n            </div>\n\n            {/* Confirm Password Input */}\n            <div>\n              <label\n                htmlFor=\"confirm\"\n                className=\"text-sm font-medium text-gray-700\"\n              >\n                Confirm Password\n              </label>\n              <div className=\"relative\">\n                <input\n                  id=\"confirm\"\n                  type={showPassword ? \"text\" : \"password\"}\n                  value={confirm}\n                  onChange={(e) => setConfirm(e.target.value)}\n                  autoComplete=\"new-password\"\n                  className=\"w-full border border-gray-400 rounded-md px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-black\"\n                />\n              </div>\n            </div>\n\n            {error && <p className=\"text-sm text-red-600 mt-3\">{error}</p>}\n\n            <div className=\"flex justify-end gap-3 mt-6\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-sm font-medium bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-black rounded-md hover:bg-gray-800 focus:outline-none flex items-center disabled:opacity-50\"\n              >\n                {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                Set Password\n              </button>\n            </div>\n          </form>\n        </Dialog.Content>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n}\n\n/**\n * [NEW] Modal for *verifying* the notes password\n */\nexport function VerifyNotePasswordModal({\n  onClose,\n  onSuccess,\n}: {\n  onClose: () => void;\n  onSuccess: (password: string) => void;\n}) {\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n\n    try {\n      const res = await fetch(\"/api/notes-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ action: \"verify\", password }),\n      });\n\n      if (res.status === 401) {\n        setError(\"Incorrect password. Please try again.\");\n      } else if (!res.ok) {\n        throw new Error(\"Verification failed\");\n      } else {\n        // Success!\n        onSuccess(password);\n      }\n    } catch {\n      setError(\"An error occurred. Please try again.\");\n    }\n    setLoading(false);\n  };\n\n  return (\n    <Dialog.Root open onOpenChange={onClose}>\n      <Dialog.Portal>\n        <Dialog.Overlay className=\"fixed inset-0 z-50 bg-black/50\" />\n        <Dialog.Content\n          className=\"fixed z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2\"\n          onInteractOutside={(e) => e.preventDefault()}\n        >\n          <form\n            onSubmit={handleSubmit}\n            className=\"bg-white rounded-lg shadow-xl w-96 p-6\"\n          >\n            <div className=\"flex flex-col items-center\">\n              <Lock className=\"w-12 h-12 mb-4 text-gray-500\" />\n              <Dialog.Title className=\"text-lg font-semibold mb-2\">\n                Note Locked\n              </Dialog.Title>\n              <Dialog.Description className=\"text-sm text-gray-600 mb-4\">\n                Enter your notes password to continue.\n              </Dialog.Description>\n            </div>\n\n            {/* Password Input */}\n            <div className=\"relative\">\n              <input\n                id=\"password\"\n                type={showPassword ? \"text\" : \"password\"}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                autoComplete=\"new-password\"\n                className=\"w-full border border-gray-400 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black\"\n                autoFocus\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-500\"\n              >\n                {showPassword ? (\n                  <EyeOff className=\"w-4 h-4\" />\n                ) : (\n                  <Eye className=\"w-4 h-4\" />\n                )}\n              </button>\n            </div>\n\n            {error && <p className=\"text-sm text-red-600 mt-3\">{error}</p>}\n\n            <div className=\"flex justify-end gap-3 mt-6\">\n              <button\n                type=\"button\"\n                onClick={onClose}\n                className=\"px-4 py-2 text-sm font-medium bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none\"\n              >\n                Cancel\n              </button>\n              <button\n                type=\"submit\"\n                disabled={loading}\n                className=\"px-4 py-2 text-sm font-medium text-white bg-black rounded-md hover:bg-gray-800 focus:outline-none flex items-center disabled:opacity-50\"\n              >\n                {loading && <Loader2 className=\"w-4 h-4 mr-2 animate-spin\" />}\n                Unlock\n              </button>\n            </div>\n          </form>\n        </Dialog.Content>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1434, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/TagsModal.tsx"],"sourcesContent":["// components/TagsModal.tsx\n\"use client\";\n\nimport React, { useState, useMemo, useEffect } from \"react\";\nimport * as Dialog from \"@radix-ui/react-dialog\";\nimport { useNotes } from \"@/lib/db/useNotes\";\nimport { type Note } from \"@/lib/db/clientDb\";\nimport { X, Tag, Plus, Check } from \"lucide-react\";\n\nexport function TagsModal({\n  note,\n  onClose,\n  allTags,\n}: {\n  note: Note;\n  onClose: () => void;\n  allTags: Set<string>;\n}) {\n  const { updateNote } = useNotes();\n  const [newTag, setNewTag] = useState(\"\");\n  const [currentTags, setCurrentTags] = useState(new Set(note.tags || []));\n\n  // This useEffect fixes the bug where you see the wrong tags for a note\n  useEffect(() => {\n    setCurrentTags(new Set(note.tags || []));\n  }, [note.id, note.tags]);\n\n  const sortedTags = useMemo(() => {\n    return Array.from(allTags).sort();\n  }, [allTags]);\n\n  // This function handles both ADDING and REMOVING a tag\n  const handleToggleTag = (tag: string) => {\n    const newTags = new Set(currentTags);\n    if (newTags.has(tag)) {\n      // --- THIS IS THE REMOVE LOGIC ---\n      // If the tag is already added, delete it\n      newTags.delete(tag);\n    } else {\n      // This is the add logic\n      newTags.add(tag);\n    }\n    setCurrentTags(newTags);\n    updateNote(note.id, { tags: Array.from(newTags) });\n  };\n\n  const handleAddNewTag = (e: React.FormEvent) => {\n    e.preventDefault();\n    const formattedTag = newTag.trim().replace(/\\s+/g, \"-\"); // no spaces\n    if (formattedTag && !currentTags.has(formattedTag)) {\n      const newTags = new Set(currentTags);\n      newTags.add(formattedTag);\n      setCurrentTags(newTags);\n      updateNote(note.id, { tags: Array.from(newTags) });\n      setNewTag(\"\"); // Clear input\n    }\n  };\n\n  return (\n    <Dialog.Root open onOpenChange={onClose}>\n      <Dialog.Portal>\n        <Dialog.Overlay className=\"fixed inset-0 z-50 bg-black/50\" />\n        <Dialog.Content\n          className=\"glass-morphism fixed z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 \n                     bg-white rounded-lg shadow-xl w-96 p-5\"\n        >\n          <div className=\"flex justify-between items-center mb-4\">\n            <Dialog.Title className=\"text-lg font-semibold\">\n              Tags for &quot;{note.title || \"Untitled Note\"}&quot;\n            </Dialog.Title>\n            <Dialog.Close asChild>\n              <button\n                className=\"p-1 rounded-full hover:bg-gray-200\"\n                aria-label=\"Close\"\n              >\n                <X className=\"w-4 h-4\" />\n              </button>\n            </Dialog.Close>\n          </div>\n\n          {/* Add New Tag Input */}\n          <form onSubmit={handleAddNewTag} className=\"flex gap-2 mb-4\">\n            <input\n              type=\"text\"\n              value={newTag}\n              onChange={(e) => setNewTag(e.target.value)}\n              placeholder=\"Add or create a tag...\"\n              className=\"w-full border border-gray-400 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-black\"\n            />\n            <button\n              type=\"submit\"\n              className=\"p-2 text-sm font-medium text-white bg-black rounded-md hover:bg-gray-800 focus:outline-none\"\n            >\n              <Plus className=\"w-4 h-4\" />\n            </button>\n          </form>\n\n          {/* Tag List */}\n          <div className=\"max-h-60 overflow-y-auto pr-2\">\n            {sortedTags.length === 0 && currentTags.size === 0 && (\n              <p className=\"text-sm text-gray-500 text-center py-4\">\n                No tags created yet.\n              </p>\n            )}\n            <ul>\n              {/* Show current tags first (the ones with checkmarks) */}\n              {Array.from(currentTags)\n                .sort()\n                .map((tag) => (\n                  <li\n                    key={tag}\n                    // Click this to REMOVE the tag\n                    onClick={() => handleToggleTag(tag)}\n                    className=\"flex items-center justify-between p-2 rounded-md cursor-pointer hover:bg-gray-200\"\n                  >\n                    <span className=\"flex items-center gap-2 text-sm\">\n                      <Tag className=\"w-4 h-4 text-gray-600\" />\n                      {tag}\n                    </span>\n                    <Check className=\"w-4 h-4 text-black\" />\n                  </li>\n                ))}\n              {/* Show other available tags (the ones without checkmarks) */}\n              {sortedTags\n                .filter((tag) => !currentTags.has(tag))\n                .map((tag) => (\n                  <li\n                    key={tag}\n                    // Click this to ADD the tag\n                    onClick={() => handleToggleTag(tag)}\n                    className=\"flex items-center justify-between p-2 rounded-md cursor-pointer hover:bg-gray-200\"\n                  >\n                    <span className=\"flex items-center gap-2 text-sm\">\n                      <Tag className=\"w-4 h-4 text-gray-600\" />\n                      {tag}\n                    </span>\n                  </li>\n                ))}\n            </ul>\n          </div>\n        </Dialog.Content>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1700, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/NoteList.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/no-unused-expressions */\n\"use client\";\n\nimport React, { useMemo, useState } from \"react\";\nimport * as DropdownMenu from \"@radix-ui/react-dropdown-menu\";\nimport * as Tooltip from \"@radix-ui/react-tooltip\";\nimport * as Dialog from \"@radix-ui/react-dialog\";\nimport * as ContextMenu from \"@radix-ui/react-context-menu\";\nimport {\n  PanelRightClose,\n  SquarePen,\n  MoreHorizontal,\n  GalleryVertical,\n  List,\n  SortAsc,\n  CalendarDays,\n  Pin,\n  Lock,\n  Trash2,\n  RotateCcw,\n  AlertTriangle,\n  Tag,\n  Check,\n} from \"lucide-react\";\nimport {\n  useNotes,\n  useTrashNotes,\n  useUserMetadata,\n  useNoteTags,\n} from \"@/lib/db/useNotes\";\nimport db, { type Note } from \"@/lib/db/clientDb\";\nimport {\n  CreateNotePasswordModal,\n  VerifyNotePasswordModal,\n} from \"./NotePasswordModals\";\nimport { TagsModal } from \"./TagsModal\";\n\n// --- Date Grouping Logic ---\nconst now = new Date();\nconst today = new Date(now.setHours(0, 0, 0, 0)).getTime();\nconst yesterday = new Date(now.setDate(now.getDate() - 1)).getTime();\nconst sevenDaysAgo = new Date(now.setDate(now.getDate() - 6)).getTime();\nconst thirtyDaysAgo = new Date(now.setDate(now.getDate() - 24)).getTime();\nconst currentYear = new Date().getFullYear();\n\nfunction getGroupTitle(timestamp: number | undefined) {\n  const ts = timestamp || 0;\n  if (ts >= today) return \"Today\";\n  if (ts >= yesterday) return \"Yesterday\";\n  if (ts >= sevenDaysAgo) return \"Previous 7 Days\";\n  if (ts >= thirtyDaysAgo) return \"Previous 30 Days\";\n\n  const date = new Date(ts);\n  const year = date.getFullYear();\n  if (year < currentYear) {\n    return year.toString();\n  }\n  return date.toLocaleString(\"default\", { month: \"long\" });\n}\n\nfunction groupNotesByDate(notes: Note[]) {\n  return notes.reduce((groups, note) => {\n    const title = getGroupTitle(note.updatedAt);\n    if (!groups[title]) {\n      groups[title] = [];\n    }\n    groups[title].push(note);\n    return groups;\n  }, {} as Record<string, Note[]>);\n}\n\n// --- Helper Components ---\n\nfunction NoteListItem({\n  note,\n  isActive,\n  onClick,\n  onTogglePin,\n  onLock,\n  onUnlock,\n  onDelete,\n  onTags,\n}: {\n  note: Note;\n  isActive: boolean;\n  onClick: () => void;\n  onTogglePin: (e: React.MouseEvent) => void;\n  onLock: () => void;\n  onUnlock: () => void;\n  onDelete: () => void;\n  onTags: () => void;\n}) {\n  // [FIX #3] Hide content preview if locked\n  const preview = useMemo(() => {\n    if (note.isLocked) return \"Note is locked\";\n    if (!note.content) return \"No additional text\";\n    const el = document.createElement(\"div\");\n    el.innerHTML = note.content;\n    return (el.textContent || \"\").substring(0, 100) || \"No additional text\";\n  }, [note.content, note.isLocked]);\n\n  const title = note.title || \"New Note\";\n\n  return (\n    <ContextMenu.Root>\n      <ContextMenu.Trigger>\n        <div\n          onClick={onClick}\n          className={`relative p-4 border-b border-gray-200 cursor-pointer group ${\n            isActive\n              ? \"bg-white shadow-inner border-l-4 border-l-black\"\n              : \"hover:bg-gray-100 border-l-4 border-l-transparent\"\n          }`}\n        >\n          <button\n            onClick={onTogglePin}\n            className={`absolute top-2 right-2 p-1 rounded-full text-gray-500 hover:bg-gray-300 hover:text-black transition-opacity duration-200\n              ${\n                note.isPinned\n                  ? \"opacity-100\"\n                  : \"opacity-0 group-hover:opacity-100\"\n              }`}\n          >\n            <Pin\n              className={`w-3.5 h-3.5 ${\n                note.isPinned ? \"fill-black\" : \"fill-none\"\n              }`}\n            />\n          </button>\n\n          <div className=\"flex items-center gap-2 mb-1\">\n            {note.isLocked && (\n              <Lock className=\"w-3 h-3 flex-shrink-0 text-gray-400\" />\n            )}\n            <h3\n              className={`font-semibold text-sm truncate pr-6 ${\n                isActive ? \"text-black\" : \"text-gray-700\"\n              }`}\n            >\n              {title}\n            </h3>\n          </div>\n\n          <p className=\"text-xs text-gray-500 truncate\">{preview}</p>\n        </div>\n      </ContextMenu.Trigger>\n\n      <ContextMenu.Content className=\"bg-white border border-gray-200 w-48 rounded-lg shadow-xl p-1.5 z-50 animate-in fade-in zoom-in-95 duration-100\">\n        <ContextMenu.Item\n          onSelect={() => onTogglePin(new MouseEvent(\"click\") as any)}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 outline-none text-gray-700\"\n        >\n          <Pin className=\"w-4 h-4\" />\n          {note.isPinned ? \"Unpin Note\" : \"Pin Note\"}\n        </ContextMenu.Item>\n        <ContextMenu.Item\n          onSelect={note.isLocked ? onUnlock : onLock}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 outline-none text-gray-700\"\n        >\n          <Lock className=\"w-4 h-4\" />\n          {note.isLocked ? \"Unlock Note\" : \"Lock Note\"}\n        </ContextMenu.Item>\n        <ContextMenu.Item\n          onSelect={onTags}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 outline-none text-gray-700\"\n        >\n          <Tag className=\"w-4 h-4\" />\n          Tags\n        </ContextMenu.Item>\n        <ContextMenu.Separator className=\"h-px bg-gray-100 my-1\" />\n        <ContextMenu.Item\n          onSelect={onDelete}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-red-50 outline-none text-red-600\"\n        >\n          <Trash2 className=\"w-4 h-4\" />\n          Delete Note\n        </ContextMenu.Item>\n      </ContextMenu.Content>\n    </ContextMenu.Root>\n  );\n}\n\nfunction NoteGalleryItem({\n  note,\n  isActive,\n  onClick,\n  onTogglePin,\n  onLock,\n  onUnlock,\n  onDelete,\n  onTags,\n}: {\n  note: Note;\n  isActive: boolean;\n  onClick: () => void;\n  onTogglePin: (e: React.MouseEvent) => void;\n  onLock: () => void;\n  onUnlock: () => void;\n  onDelete: () => void;\n  onTags: () => void;\n}) {\n  const preview = useMemo(() => {\n    if (note.isLocked) return \"Note is locked\";\n    if (!note.content) return \"No additional text\";\n    const el = document.createElement(\"div\");\n    el.innerHTML = note.content;\n    return (el.textContent || \"\").substring(0, 150) || \"No additional text\";\n  }, [note.content, note.isLocked]);\n\n  const title = note.title || \"New Note\";\n\n  return (\n    <ContextMenu.Root>\n      <ContextMenu.Trigger>\n        <div\n          onClick={onClick}\n          className={`relative h-40 flex flex-col p-4 border rounded-xl cursor-pointer group transition-all duration-200\n            ${\n              isActive\n                ? \"bg-white shadow-md border-black ring-1 ring-black/5\"\n                : \"bg-white border-gray-200 hover:border-gray-300 hover:shadow-sm\"\n            }`}\n        >\n          <button\n            onClick={onTogglePin}\n            className={`absolute top-3 right-3 p-1 rounded-full text-gray-400 hover:bg-gray-100 hover:text-black transition-all\n              ${\n                note.isPinned\n                  ? \"opacity-100\"\n                  : \"opacity-0 group-hover:opacity-100\"\n              }`}\n          >\n            <Pin\n              className={`w-3.5 h-3.5 ${\n                note.isPinned ? \"fill-black\" : \"fill-none\"\n              }`}\n            />\n          </button>\n\n          <div className=\"flex items-center gap-2 mb-2\">\n            {note.isLocked && (\n              <Lock className=\"w-3 h-3 flex-shrink-0 text-gray-400\" />\n            )}\n            <h3 className=\"font-bold text-sm truncate pr-6 text-gray-800\">\n              {title}\n            </h3>\n          </div>\n\n          <p className=\"text-xs text-gray-500 flex-grow overflow-hidden leading-relaxed\">\n            {preview}\n          </p>\n        </div>\n      </ContextMenu.Trigger>\n\n      <ContextMenu.Content className=\"bg-white border border-gray-200 w-48 rounded-lg shadow-xl p-1.5 z-50 animate-in fade-in zoom-in-95 duration-100\">\n        <ContextMenu.Item\n          onSelect={() => onTogglePin(new MouseEvent(\"click\") as any)}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 outline-none text-gray-700\"\n        >\n          <Pin className=\"w-4 h-4\" />\n          {note.isPinned ? \"Unpin Note\" : \"Pin Note\"}\n        </ContextMenu.Item>\n        <ContextMenu.Item\n          onSelect={note.isLocked ? onUnlock : onLock}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 outline-none text-gray-700\"\n        >\n          <Lock className=\"w-4 h-4\" />\n          {note.isLocked ? \"Unlock Note\" : \"Lock Note\"}\n        </ContextMenu.Item>\n        <ContextMenu.Item\n          onSelect={onTags}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 outline-none text-gray-700\"\n        >\n          <Tag className=\"w-4 h-4\" />\n          Tags\n        </ContextMenu.Item>\n        <ContextMenu.Separator className=\"h-px bg-gray-100 my-1\" />\n        <ContextMenu.Item\n          onSelect={onDelete}\n          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-red-50 outline-none text-red-600\"\n        >\n          <Trash2 className=\"w-4 h-4\" />\n          Delete Note\n        </ContextMenu.Item>\n      </ContextMenu.Content>\n    </ContextMenu.Root>\n  );\n}\n\nfunction TrashListItem({\n  note,\n  onRecover,\n  onDelete,\n}: {\n  note: Note;\n  onRecover: () => void;\n  onDelete: () => void;\n}) {\n  const title = note.title || \"New Note\";\n  const deletedDate = note.deletedAt\n    ? new Date(note.deletedAt).toLocaleDateString()\n    : \"Recently\";\n\n  return (\n    <div className=\"relative p-4 border-b border-gray-200 group bg-gray-50/50 hover:bg-gray-50\">\n      <h3 className=\"font-semibold text-sm truncate pr-6 text-gray-600 line-through opacity-70\">\n        {title}\n      </h3>\n      <p className=\"text-xs text-gray-400 truncate\">Deleted: {deletedDate}</p>\n      <div className=\"flex items-center gap-4 mt-3\">\n        <button\n          onClick={onRecover}\n          className=\"flex items-center gap-1 text-xs font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 px-2 py-1 rounded transition-colors\"\n        >\n          <RotateCcw className=\"w-3 h-3\" />\n          Recover\n        </button>\n        <button\n          onClick={onDelete}\n          className=\"flex items-center gap-1 text-xs font-medium text-red-600 hover:text-red-700 hover:bg-red-50 px-2 py-1 rounded transition-colors\"\n        >\n          <Trash2 className=\"w-3 h-3\" />\n          Delete Forever\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction EmptyTrashModal({\n  onClose,\n  onConfirm,\n}: {\n  onClose: () => void;\n  onConfirm: () => void;\n}) {\n  return (\n    <Dialog.Root open onOpenChange={onClose}>\n      <Dialog.Portal>\n        <Dialog.Overlay className=\"fixed inset-0 z-50 bg-black/30 backdrop-blur-sm\" />\n        <Dialog.Content className=\"fixed z-50 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-white rounded-xl shadow-2xl w-96 p-6 animate-in fade-in zoom-in-95 duration-200\">\n          <div className=\"flex flex-col items-center text-center\">\n            <div className=\"bg-red-50 p-3 rounded-full mb-4\">\n              <AlertTriangle className=\"w-8 h-8 text-red-500\" />\n            </div>\n            <Dialog.Title className=\"text-lg font-bold mb-2 text-gray-900\">\n              Empty Trash?\n            </Dialog.Title>\n            <Dialog.Description className=\"text-sm text-gray-500 mb-6 leading-relaxed\">\n              This will permanently delete all notes in the trash. This action\n              cannot be undone.\n            </Dialog.Description>\n          </div>\n          <div className=\"flex justify-end gap-3\">\n            <Dialog.Close asChild>\n              <button\n                type=\"button\"\n                className=\"px-4 py-2 text-sm font-medium text-gray-600 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors\"\n              >\n                Cancel\n              </button>\n            </Dialog.Close>\n            <button\n              type=\"button\"\n              onClick={onConfirm}\n              className=\"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors shadow-sm\"\n            >\n              Delete All\n            </button>\n          </div>\n        </Dialog.Content>\n      </Dialog.Portal>\n    </Dialog.Root>\n  );\n}\n\nconst TooltipButton = ({\n  children,\n  label,\n}: {\n  children: React.ReactNode;\n  label: string;\n}) => (\n  <Tooltip.Provider delayDuration={300}>\n    <Tooltip.Root>\n      <Tooltip.Trigger asChild>{children}</Tooltip.Trigger>\n      <Tooltip.Portal>\n        <Tooltip.Content\n          className=\"bg-gray-900 text-white px-2 py-1 rounded text-[10px] font-medium shadow-lg z-50 animate-in fade-in zoom-in-95 duration-100\"\n          sideOffset={5}\n        >\n          {label}\n          <Tooltip.Arrow className=\"fill-gray-900\" />\n        </Tooltip.Content>\n      </Tooltip.Portal>\n    </Tooltip.Root>\n  </Tooltip.Provider>\n);\n\n// --- Main Note List Component ---\nexport function NoteList({\n  isSidebarCollapsed,\n  onToggleSidebar,\n  selectedView,\n  activeNoteId,\n  setActiveNoteId,\n}: {\n  isSidebarCollapsed: boolean;\n  onToggleSidebar: () => void;\n  selectedView: string;\n  activeNoteId: string | null;\n  setActiveNoteId: (id: string | null) => void;\n}) {\n  const {\n    notes,\n    addNote,\n    pinNote,\n    unpinNote,\n    deleteNote,\n    lockNote,\n    unlockNote,\n    deleteNotePermanently,\n    recoverNote,\n  } = useNotes();\n  const { trashedNotes } = useTrashNotes();\n  const { metadata } = useUserMetadata();\n  const { tags } = useNoteTags();\n  const allTagsSet = useMemo(() => new Set(tags || []), [tags]);\n\n  const [showConfirm, setShowConfirm] = useState(false);\n\n  type SortKey = \"updatedAt\" | \"createdAt\" | \"title\";\n  const [viewType, setViewType] = useState<\"list\" | \"gallery\">(\"list\");\n\n  // âœ… FIX: Declared and now USED in the dropdown below\n  const [sortOrder, setSortOrder] = useState<SortKey>(\"updatedAt\");\n\n  const [isGrouped, setIsGrouped] = useState(true);\n\n  const [tagModalNote, setTagModalNote] = useState<Note | null>(null);\n\n  const [showCreatePasswordModal, setShowCreatePasswordModal] = useState(false);\n  const [showVerifyPasswordModal, setShowVerifyPasswordModal] = useState(false);\n  const [pendingActionNote, setPendingActionNote] = useState<Note | null>(null);\n  const [pendingActionType, setPendingActionType] = useState<\n    \"lock\" | \"unlock\" | null\n  >(null);\n\n  const isTrashView = selectedView === \"trash\";\n\n  const filteredNotes = useMemo(() => {\n    if (!notes || !trashedNotes) return [];\n    let baseNotes: Note[] = [];\n    if (isTrashView) {\n      baseNotes = trashedNotes;\n    } else {\n      switch (true) {\n        case selectedView === \"all\":\n          baseNotes = notes.filter((n) => !n.isQuickNote);\n          break;\n        case selectedView === \"quick\":\n          baseNotes = notes.filter((n) => n.isQuickNote);\n          break;\n        case selectedView.startsWith(\"tag-\"):\n          const tag = selectedView.replace(\"tag-\", \"\");\n          baseNotes = notes.filter((n) => (n.tags || []).includes(tag));\n          break;\n        default:\n          baseNotes = notes.filter((n) => n.folderId === selectedView);\n      }\n    }\n    return baseNotes;\n  }, [notes, trashedNotes, selectedView, isTrashView]);\n\n  const sortedNotes = useMemo(() => {\n    return [...filteredNotes].sort((a, b) => {\n      if (a.isPinned !== b.isPinned) {\n        return a.isPinned ? -1 : 1;\n      }\n      // âœ… FIX: Using sortOrder here\n      switch (sortOrder) {\n        case \"title\":\n          return (a.title || \"\").localeCompare(b.title || \"\");\n        case \"createdAt\":\n          return (b.createdAt || 0) - (a.createdAt || 0);\n        case \"updatedAt\":\n        default:\n          return (b.updatedAt || 0) - (a.updatedAt || 0);\n      }\n    });\n  }, [filteredNotes, sortOrder]);\n\n  const groupedNotes = useMemo(\n    () => (isTrashView || !isGrouped ? {} : groupNotesByDate(sortedNotes)),\n    [sortedNotes, isTrashView, isGrouped]\n  );\n  const groupTitles = Object.keys(groupedNotes);\n\n  const handleNewNote = async () => {\n    const isQuickNote = selectedView === \"quick\";\n    const folderId =\n      selectedView !== \"all\" &&\n      selectedView !== \"quick\" &&\n      selectedView !== \"trash\" &&\n      !selectedView.startsWith(\"tag-\")\n        ? selectedView\n        : null;\n\n    const newNote = await addNote({\n      title: \"New Note\",\n      content: \"\",\n      folderId: folderId,\n      isQuickNote: isQuickNote,\n    });\n\n    setActiveNoteId(newNote.id);\n  };\n\n  const viewTitle = useMemo(() => {\n    if (selectedView === \"all\") return \"All Notes\";\n    if (selectedView === \"quick\") return \"Quick Notes\";\n    if (selectedView === \"trash\") return \"Trash\";\n    if (selectedView.startsWith(\"tag-\"))\n      return `#${selectedView.replace(\"tag-\", \"\")}`;\n    return \"Folder\";\n  }, [selectedView]);\n\n  const handleEmptyTrash = () => {\n    trashedNotes?.forEach((note) => {\n      deleteNotePermanently(note.id);\n    });\n    setShowConfirm(false);\n  };\n\n  const handleLockNote = (note: Note) => {\n    setPendingActionNote(note);\n    setPendingActionType(\"lock\");\n    if (metadata?.hasNotesPassword) {\n      lockNote(note.id);\n      setPendingActionNote(null);\n      setPendingActionType(null);\n    } else {\n      setShowCreatePasswordModal(true);\n    }\n  };\n\n  const handleUnlockNote = (note: Note) => {\n    setPendingActionNote(note);\n    setPendingActionType(\"unlock\");\n    setShowVerifyPasswordModal(true);\n  };\n\n  const onVerifySuccess = () => {\n    if (pendingActionType === \"lock\" && pendingActionNote) {\n      lockNote(pendingActionNote.id);\n    }\n    if (pendingActionType === \"unlock\" && pendingActionNote) {\n      unlockNote(pendingActionNote.id);\n    }\n    setShowVerifyPasswordModal(false);\n    setPendingActionNote(null);\n  };\n\n  const onCreateSuccess = () => {\n    if (pendingActionType === \"lock\" && pendingActionNote) {\n      lockNote(pendingActionNote.id);\n    }\n    setShowCreatePasswordModal(false);\n    setPendingActionNote(null);\n    if (metadata) {\n      db.userMetadata.update(metadata.userId, { hasNotesPassword: true });\n    }\n  };\n\n  const handleTags = (note: Note) => {\n    setTagModalNote(note);\n  };\n\n  return (\n    <div className=\"flex flex-col h-full relative bg-white\">\n      {/* Toolbar */}\n      <div className=\"flex justify-between items-center px-4 h-[52px] box-border border-b border-gray-200 bg-white/80 backdrop-blur-sm sticky top-0 z-20\">\n        <div className=\"flex items-center gap-3\">\n          {isSidebarCollapsed && (\n            <TooltipButton label=\"Expand Sidebar\">\n              <button\n                type=\"button\"\n                className=\"text-gray-500 hover:bg-gray-100 p-1.5 rounded-md transition-colors\"\n                onClick={onToggleSidebar}\n              >\n                <PanelRightClose className=\"w-5 h-5\" strokeWidth={2} />\n              </button>\n            </TooltipButton>\n          )}\n          <div>\n            <h2 className=\"text-sm font-bold text-gray-800 m-0 leading-none\">\n              {viewTitle}\n            </h2>\n            <p className=\"text-[10px] font-medium text-gray-400 mt-0.5\">\n              {filteredNotes.length} notes\n            </p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-1\">\n          {!isTrashView && (\n            <TooltipButton label=\"New Note\">\n              <button\n                type=\"button\"\n                className=\"text-gray-600 hover:text-blue-600 hover:bg-blue-50 p-1.5 rounded-md transition-colors\"\n                onClick={handleNewNote}\n              >\n                <SquarePen className=\"w-5 h-5\" strokeWidth={2} />\n              </button>\n            </TooltipButton>\n          )}\n\n          {isTrashView && filteredNotes.length > 0 && (\n            <TooltipButton label=\"Empty Trash\">\n              <button\n                type=\"button\"\n                onClick={() => setShowConfirm(true)}\n                className=\"text-red-500 hover:bg-red-50 p-1.5 rounded-md transition-colors\"\n              >\n                <Trash2 className=\"w-5 h-5\" strokeWidth={2} />\n              </button>\n            </TooltipButton>\n          )}\n\n          {!isTrashView && (\n            <DropdownMenu.Root>\n              <TooltipButton label=\"View Options\">\n                <DropdownMenu.Trigger asChild>\n                  <button\n                    type=\"button\"\n                    className=\"text-gray-500 hover:bg-gray-100 p-1.5 rounded-md transition-colors\"\n                  >\n                    <MoreHorizontal className=\"w-5 h-5\" strokeWidth={2} />\n                  </button>\n                </DropdownMenu.Trigger>\n              </TooltipButton>\n              <DropdownMenu.Portal>\n                <DropdownMenu.Content\n                  className=\"bg-white rounded-lg shadow-xl p-1.5 z-50 border border-gray-100 w-48 animate-in fade-in zoom-in-95 duration-100\"\n                  sideOffset={5}\n                  align=\"end\"\n                >\n                  <DropdownMenu.Item\n                    onSelect={() => setViewType(\"gallery\")}\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\"\n                  >\n                    <GalleryVertical className=\"w-4 h-4\" /> Gallery{\" \"}\n                    {viewType === \"gallery\" && (\n                      <Check className=\"w-3.5 h-3.5 ml-auto text-blue-600\" />\n                    )}\n                  </DropdownMenu.Item>\n                  <DropdownMenu.Item\n                    onSelect={() => setViewType(\"list\")}\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\"\n                  >\n                    <List className=\"w-4 h-4\" /> List{\" \"}\n                    {viewType === \"list\" && (\n                      <Check className=\"w-3.5 h-3.5 ml-auto text-blue-600\" />\n                    )}\n                  </DropdownMenu.Item>\n                  <DropdownMenu.Separator className=\"h-px bg-gray-100 my-1\" />\n\n                  <DropdownMenu.Sub>\n                    <DropdownMenu.SubTrigger className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\">\n                      <SortAsc className=\"w-4 h-4\" /> Sort by...\n                    </DropdownMenu.SubTrigger>\n                    <DropdownMenu.Portal>\n                      <DropdownMenu.SubContent\n                        className=\"bg-white rounded-lg shadow-xl p-1.5 z-50 border border-gray-100 w-48 animate-in fade-in zoom-in-95 duration-100\"\n                        sideOffset={5}\n                      >\n                        {/* âœ… FIX: Using setSortOrder here */}\n                        <DropdownMenu.Item\n                          onSelect={() => setSortOrder(\"updatedAt\")}\n                          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\"\n                        >\n                          Date Edited\n                          {sortOrder === \"updatedAt\" && (\n                            <Check className=\"w-3.5 h-3.5 ml-auto text-blue-600\" />\n                          )}\n                        </DropdownMenu.Item>\n                        <DropdownMenu.Item\n                          onSelect={() => setSortOrder(\"createdAt\")}\n                          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\"\n                        >\n                          Date Created\n                          {sortOrder === \"createdAt\" && (\n                            <Check className=\"w-3.5 h-3.5 ml-auto text-blue-600\" />\n                          )}\n                        </DropdownMenu.Item>\n                        <DropdownMenu.Item\n                          onSelect={() => setSortOrder(\"title\")}\n                          className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\"\n                        >\n                          Title\n                          {sortOrder === \"title\" && (\n                            <Check className=\"w-3.5 h-3.5 ml-auto text-blue-600\" />\n                          )}\n                        </DropdownMenu.Item>\n                      </DropdownMenu.SubContent>\n                    </DropdownMenu.Portal>\n                  </DropdownMenu.Sub>\n\n                  <DropdownMenu.Item\n                    onSelect={() => setIsGrouped(!isGrouped)}\n                    className=\"flex items-center gap-2 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-50 outline-none text-gray-700\"\n                  >\n                    <CalendarDays className=\"w-4 h-4\" /> Group by Date{\" \"}\n                    {isGrouped && (\n                      <Check className=\"w-3.5 h-3.5 ml-auto text-blue-600\" />\n                    )}\n                  </DropdownMenu.Item>\n                </DropdownMenu.Content>\n              </DropdownMenu.Portal>\n            </DropdownMenu.Root>\n          )}\n        </div>\n      </div>\n\n      {/* Note List */}\n      <div className=\"flex-1 overflow-y-auto bg-white custom-scrollbar\">\n        {isTrashView ? (\n          <div>\n            {filteredNotes && filteredNotes.length > 0 ? (\n              filteredNotes.map((note) => (\n                <TrashListItem\n                  key={note.id}\n                  note={note}\n                  onRecover={() => recoverNote(note.id)}\n                  onDelete={() => deleteNotePermanently(note.id)}\n                />\n              ))\n            ) : (\n              <div className=\"flex flex-col items-center justify-center h-40 text-gray-400\">\n                <Trash2 size={32} className=\"mb-2 opacity-20\" />\n                <p className=\"text-xs\">Trash is empty</p>\n              </div>\n            )}\n          </div>\n        ) : viewType === \"gallery\" ? (\n          <div className=\"grid grid-cols-2 gap-3 p-4\">\n            {sortedNotes.map((note) => (\n              <NoteGalleryItem\n                key={note.id}\n                note={note}\n                isActive={note.id === activeNoteId}\n                onClick={() => setActiveNoteId(note.id)}\n                onTogglePin={(e) => {\n                  e.stopPropagation();\n                  note.isPinned ? unpinNote(note.id) : pinNote(note.id);\n                }}\n                onLock={() => handleLockNote(note)}\n                onUnlock={() => handleUnlockNote(note)}\n                onDelete={() => deleteNote(note.id)}\n                onTags={() => handleTags(note)}\n              />\n            ))}\n          </div>\n        ) : isGrouped ? (\n          groupTitles.map((title) => (\n            <div key={title}>\n              <h4 className=\"text-[11px] font-bold text-gray-400 px-5 pt-4 pb-2 uppercase tracking-wider bg-white sticky top-0 z-10\">\n                {title}\n              </h4>\n              {groupedNotes[title].map((note) => (\n                <NoteListItem\n                  key={note.id}\n                  note={note}\n                  isActive={note.id === activeNoteId}\n                  onClick={() => setActiveNoteId(note.id)}\n                  onTogglePin={(e) => {\n                    e.stopPropagation();\n                    note.isPinned ? unpinNote(note.id) : pinNote(note.id);\n                  }}\n                  onLock={() => handleLockNote(note)}\n                  onUnlock={() => handleUnlockNote(note)}\n                  onDelete={() => deleteNote(note.id)}\n                  onTags={() => handleTags(note)}\n                />\n              ))}\n            </div>\n          ))\n        ) : (\n          <div>\n            {sortedNotes.map((note) => (\n              <NoteListItem\n                key={note.id}\n                note={note}\n                isActive={note.id === activeNoteId}\n                onClick={() => setActiveNoteId(note.id)}\n                onTogglePin={(e) => {\n                  e.stopPropagation();\n                  note.isPinned ? unpinNote(note.id) : pinNote(note.id);\n                }}\n                onLock={() => handleLockNote(note)}\n                onUnlock={() => handleUnlockNote(note)}\n                onDelete={() => deleteNote(note.id)}\n                onTags={() => handleTags(note)}\n              />\n            ))}\n          </div>\n        )}\n\n        {!isTrashView && filteredNotes && filteredNotes.length === 0 && (\n          <div className=\"flex flex-col items-center justify-center h-64 text-gray-400\">\n            <SquarePen size={40} className=\"mb-3 opacity-20\" />\n            <p className=\"text-sm font-medium\">No notes found</p>\n            <p className=\"text-xs mt-1\">Create a new note to get started</p>\n          </div>\n        )}\n      </div>\n\n      {/* Modals */}\n      {showConfirm && (\n        <EmptyTrashModal\n          onClose={() => setShowConfirm(false)}\n          onConfirm={handleEmptyTrash}\n        />\n      )}\n      {showCreatePasswordModal && (\n        <CreateNotePasswordModal\n          onClose={() => {\n            setShowCreatePasswordModal(false);\n            setPendingActionNote(null);\n          }}\n          onSuccess={onCreateSuccess}\n        />\n      )}\n      {showVerifyPasswordModal && (\n        <VerifyNotePasswordModal\n          onClose={() => {\n            setShowVerifyPasswordModal(false);\n            setPendingActionNote(null);\n          }}\n          onSuccess={onVerifySuccess}\n        />\n      )}\n      {tagModalNote && (\n        <TagsModal\n          note={tagModalNote}\n          onClose={() => setTagModalNote(null)}\n          allTags={allTagsSet}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3067, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/EditorToolbar.tsx"],"sourcesContent":["/* eslint-disable jsx-a11y/alt-text */\n\"use client\";\n\nimport React from \"react\";\nimport { type Editor } from \"@tiptap/react\";\nimport * as DropdownMenu from \"@radix-ui/react-dropdown-menu\";\nimport * as Tooltip from \"@radix-ui/react-tooltip\";\nimport {\n  Bold,\n  Italic,\n  List,\n  ListOrdered,\n  ListChecks,\n  Heading1,\n  Heading2,\n  Heading3,\n  Paperclip,\n  Mic,\n  File,\n  Image,\n  Link,\n  Lock,\n  Unlock,\n  Trash2,\n} from \"lucide-react\";\n\nconst TooltipButtonWrapper = ({\n  children,\n  label,\n}: {\n  children: React.ReactNode;\n  label: string;\n}) => (\n  <Tooltip.Provider delayDuration={100}>\n    <Tooltip.Root>\n      <Tooltip.Trigger asChild>{children}</Tooltip.Trigger>\n      <Tooltip.Portal>\n        <Tooltip.Content\n          className=\"bg-black text-white px-2 py-1 rounded text-xs shadow-lg z-50\"\n          sideOffset={5}\n        >\n          {label}\n          <Tooltip.Arrow className=\"fill-black\" />\n        </Tooltip.Content>\n      </Tooltip.Portal>\n    </Tooltip.Root>\n  </Tooltip.Provider>\n);\n\ntype Props = {\n  editor: Editor | null;\n  mediaInputRef: React.RefObject<HTMLInputElement | null>;\n  docInputRef: React.RefObject<HTMLInputElement | null>;\n  onAddLink: () => void;\n  onRecordAudioClick: () => void;\n  isLocked: boolean;\n  onToggleLock: () => void;\n  onDeleteNote: () => void;\n};\n\nexport function EditorToolbar({\n  editor,\n  mediaInputRef,\n  docInputRef,\n  onAddLink,\n  onRecordAudioClick,\n  isLocked,\n  onToggleLock,\n  onDeleteNote,\n}: Props) {\n  if (!editor) {\n    return null;\n  }\n\n  // [FIX #1] Added onMouseDown={(e) => e.preventDefault()}\n  // This prevents the button from stealing focus from the editor\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  const Button = ({ onClick, isActive, children, label }: any) => (\n    <TooltipButtonWrapper label={label}>\n      <button\n        type=\"button\"\n        onMouseDown={(e) => e.preventDefault()} // Important for single click\n        onClick={onClick}\n        disabled={!editor.isEditable && !isLocked}\n        className={`p-2 rounded-md transition-colors disabled:opacity-50 ${\n          isActive\n            ? \"bg-black text-white\"\n            : \"text-gray-600 hover:bg-gray-200 hover:text-black\"\n        }`}\n      >\n        {children}\n      </button>\n    </TooltipButtonWrapper>\n  );\n\n  return (\n    <div className=\"flex items-center gap-1 p-2 h-[50px] box-border border-b border-gray-200 overflow-x-auto no-scrollbar bg-white sticky top-0 z-10\">\n      <>\n        <Button\n          onClick={() => editor.chain().focus().toggleBold().run()}\n          isActive={editor.isActive(\"bold\")}\n          label=\"Bold (Ctrl+B)\"\n        >\n          <Bold className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          onClick={() => editor.chain().focus().toggleItalic().run()}\n          isActive={editor.isActive(\"italic\")}\n          label=\"Italic (Ctrl+I)\"\n        >\n          <Italic className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          onClick={onAddLink}\n          isActive={editor.isActive(\"link\")}\n          label=\"Add Link (Ctrl+K)\"\n        >\n          <Link className=\"w-4 h-4\" />\n        </Button>\n\n        <div className=\"w-px h-5 bg-gray-300 mx-1\"></div>\n\n        <Button\n          onClick={() =>\n            editor.chain().focus().toggleHeading({ level: 1 }).run()\n          }\n          isActive={editor.isActive(\"heading\", { level: 1 })}\n          label=\"Heading 1\"\n        >\n          <Heading1 className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          onClick={() =>\n            editor.chain().focus().toggleHeading({ level: 2 }).run()\n          }\n          isActive={editor.isActive(\"heading\", { level: 2 })}\n          label=\"Heading 2\"\n        >\n          <Heading2 className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          onClick={() =>\n            editor.chain().focus().toggleHeading({ level: 3 }).run()\n          }\n          isActive={editor.isActive(\"heading\", { level: 3 })}\n          label=\"Heading 3\"\n        >\n          <Heading3 className=\"w-4 h-4\" />\n        </Button>\n\n        <div className=\"w-px h-5 bg-gray-300 mx-1\"></div>\n\n        <Button\n          onClick={() => editor.chain().focus().toggleBulletList().run()}\n          isActive={editor.isActive(\"bulletList\")}\n          label=\"Bullet List\"\n        >\n          <List className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          onClick={() => editor.chain().focus().toggleOrderedList().run()}\n          isActive={editor.isActive(\"orderedList\")}\n          label=\"Numbered List\"\n        >\n          <ListOrdered className=\"w-4 h-4\" />\n        </Button>\n        <Button\n          onClick={() => editor.chain().focus().toggleTaskList().run()}\n          isActive={editor.isActive(\"taskList\")}\n          label=\"Checklist\"\n        >\n          <ListChecks className=\"w-4 h-4\" />\n        </Button>\n\n        <div className=\"w-px h-5 bg-gray-300 mx-1\"></div>\n\n        {/* Attachment Dropdown */}\n        <Tooltip.Provider delayDuration={100}>\n          <DropdownMenu.Root>\n            <Tooltip.Root>\n              <Tooltip.Trigger asChild>\n                <DropdownMenu.Trigger asChild>\n                  <button\n                    type=\"button\"\n                    onMouseDown={(e) => e.preventDefault()}\n                    disabled={!editor.isEditable}\n                    className=\"p-2 rounded-md text-gray-600 hover:bg-gray-200 disabled:opacity-50\"\n                  >\n                    <Paperclip className=\"w-4 h-4\" />\n                  </button>\n                </DropdownMenu.Trigger>\n              </Tooltip.Trigger>\n              <Tooltip.Portal>\n                <Tooltip.Content\n                  className=\"bg-black text-white px-2 py-1 rounded text-xs shadow-lg z-50\"\n                  sideOffset={5}\n                >\n                  Attach <Tooltip.Arrow className=\"fill-black\" />\n                </Tooltip.Content>\n              </Tooltip.Portal>\n            </Tooltip.Root>\n            <DropdownMenu.Portal>\n              <DropdownMenu.Content\n                className=\"bg-white rounded-md shadow-lg p-2 z-50 border border-gray-200 min-w-[180px] animate-in fade-in zoom-in-95 duration-100\"\n                sideOffset={5}\n                align=\"start\"\n              >\n                <DropdownMenu.Item\n                  onSelect={() => mediaInputRef.current?.click()}\n                  className=\"flex items-center gap-3 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 focus:outline-none focus:bg-gray-100\"\n                >\n                  <Image className=\"w-4 h-4\" />\n                  <span>Photo / Video</span>\n                </DropdownMenu.Item>\n                <DropdownMenu.Item\n                  onSelect={onRecordAudioClick}\n                  className=\"flex items-center gap-3 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 focus:outline-none focus:bg-gray-100\"\n                >\n                  <Mic className=\"w-4 h-4\" />\n                  <span>Record Audio</span>\n                </DropdownMenu.Item>\n                <DropdownMenu.Item\n                  onSelect={() => docInputRef.current?.click()}\n                  className=\"flex items-center gap-3 px-3 py-2 text-sm rounded-md cursor-pointer hover:bg-gray-100 focus:outline-none focus:bg-gray-100\"\n                >\n                  <File className=\"w-4 h-4\" />\n                  <span>Document</span>\n                </DropdownMenu.Item>\n              </DropdownMenu.Content>\n            </DropdownMenu.Portal>\n          </DropdownMenu.Root>\n        </Tooltip.Provider>\n\n        <div className=\"flex-grow\"></div>\n\n        <Button\n          onClick={onToggleLock}\n          isActive={isLocked}\n          label={isLocked ? \"Unlock Note\" : \"Lock Note\"}\n        >\n          {isLocked ? (\n            <Lock className=\"w-4 h-4\" />\n          ) : (\n            <Unlock className=\"w-4 h-4\" />\n          )}\n        </Button>\n\n        <Button onClick={onDeleteNote} isActive={false} label=\"Move to Trash\">\n          <Trash2 className=\"w-4 h-4 text-gray-600 hover:text-red-600\" />\n        </Button>\n      </>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3573, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/uploadToS3.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/**\n * [UPDATED] The object returned by the uploader.\n * It now includes the full public URL.\n */\nexport interface S3UploadResponse {\n  s3Key: string;\n  url: string; // The full public URL\n  fileName: string;\n  fileSize: number;\n}\n\n/**\n * Uploads a file to AWS S3 using your Next.js presigned URL route.\n *\n * @param file - The File object (from input or drag-drop)\n * @param entityType - \"notes\" | \"diary\"\n * @returns An object with the s3Key, public URL, fileName, and fileSize\n */\nexport async function uploadToS3(\n  file: File,\n  entityType: \"notes\" | \"diary\"\n): Promise<S3UploadResponse> {\n  try {\n    // 1ï¸âƒ£ Request a presigned URL\n    const res = await fetch(\"/api/s3-upload\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        fileName: file.name,\n        fileType: file.type,\n        entityType,\n      }),\n    });\n\n    if (!res.ok) {\n      const err = await res.json();\n      throw new Error(err.error || \"Failed to get upload URL\");\n    }\n\n    const { uploadUrl, s3Key } = await res.json();\n\n    // 2ï¸âƒ£ Upload the file directly to S3\n    const upload = await fetch(uploadUrl, {\n      method: \"PUT\",\n      headers: { \"Content-Type\": file.type },\n      body: file,\n    });\n\n    if (!upload.ok) {\n      throw new Error(\"Failed to upload file to S3\");\n    }\n\n    // 3ï¸âƒ£ [NEW] Construct the final public URL\n    // Make sure these NEXT_PUBLIC_ variables are in your .env.local\n    const finalUrl = `https://${process.env.NEXT_PUBLIC_AWS_S3_BUCKET_NAME}.s3.${process.env.NEXT_PUBLIC_AWS_S3_REGION}.amazonaws.com/${s3Key}`;\n\n    return {\n      s3Key: s3Key,\n      url: finalUrl, // Return the full URL\n      fileName: file.name,\n      fileSize: file.size,\n    };\n  } catch (error: any) {\n    console.error(\"S3 Upload Error:\", error);\n    throw new Error(error.message || \"Upload failed\");\n  }\n}\n"],"names":[],"mappings":"AAAA,qDAAqD,GAErD;;;CAGC;;;;AAeM,eAAe,WACpB,IAAU,EACV,UAA6B;IAE7B,IAAI;QACF,8BAA8B;QAC9B,MAAM,MAAM,MAAM,MAAM,kBAAkB;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,UAAU,KAAK,IAAI;gBACnB,UAAU,KAAK,IAAI;gBACnB;YACF;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,MAAM,IAAI,MAAM,IAAI,KAAK,IAAI;QAC/B;QAEA,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAE3C,qCAAqC;QACrC,MAAM,SAAS,MAAM,MAAM,WAAW;YACpC,QAAQ;YACR,SAAS;gBAAE,gBAAgB,KAAK,IAAI;YAAC;YACrC,MAAM;QACR;QAEA,IAAI,CAAC,OAAO,EAAE,EAAE;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,2CAA2C;QAC3C,gEAAgE;QAChE,MAAM,WAAW,CAAC,QAAQ,+DAA6C,IAAI,iDAAwC,eAAe,EAAE,OAAO;QAE3I,OAAO;YACL,OAAO;YACP,KAAK;YACL,UAAU,KAAK,IAAI;YACnB,UAAU,KAAK,IAAI;QACrB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;AACF","debugId":null}},
    {"offset": {"line": 3628, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/deleteFromS3.ts"],"sourcesContent":["/**\n * Deletes a file from AWS S3 via your Next.js API route.\n * * @param url - The full S3 URL of the file to delete\n * @returns boolean - True if deleted successfully\n */\nexport async function deleteFromS3(url: string): Promise<boolean> {\n  try {\n    const res = await fetch(\"/api/s3-delete\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ url }),\n    });\n\n    if (!res.ok) {\n      const err = await res.json();\n      console.error(\"Failed to delete from S3:\", err.error);\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error(\"Error in deleteFromS3:\", error);\n    return false;\n  }\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AACM,eAAe,aAAa,GAAW;IAC5C,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,kBAAkB;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAI;QAC7B;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,QAAQ,KAAK,CAAC,6BAA6B,IAAI,KAAK;YACpD,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 3662, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/AudioRecorder.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { Mic, StopCircle, Play, Pause, X, Check } from \"lucide-react\";\n\ntype Props = {\n  onClose: () => void;\n  onAdd: (file: File) => void;\n};\n\nexport function AudioRecorder({ onClose, onAdd }: Props) {\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioURL, setAudioURL] = useState<string | null>(null);\n  const [audioFile, setAudioFile] = useState<File | null>(null);\n  const [permissionError, setPermissionError] = useState(false);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  // Request mic permission on mount\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ audio: true })\n      .then(() => {\n        // [THE FIX] Changed 'stream =>' to '() =>'\n        setPermissionError(false);\n      })\n      .catch((err) => {\n        console.error(\"Mic permission denied:\", err);\n        setPermissionError(true);\n      });\n  }, []);\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      setIsRecording(true);\n      setAudioURL(null);\n      setAudioFile(null);\n      audioChunksRef.current = [];\n\n      mediaRecorderRef.current = new MediaRecorder(stream);\n      mediaRecorderRef.current.ondataavailable = (event) => {\n        audioChunksRef.current.push(event.data);\n      };\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, {\n          type: \"audio/wav\",\n        });\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const file = new File([audioBlob], \"recording.wav\", {\n          type: \"audio/wav\",\n        });\n        setAudioURL(audioUrl);\n        setAudioFile(file);\n      };\n      mediaRecorderRef.current.start();\n    } catch (err) {\n      console.error(\"Error starting recording:\", err);\n      setPermissionError(true);\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const togglePlay = () => {\n    if (audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    }\n  };\n\n  const handleAddClick = () => {\n    if (audioFile) {\n      onAdd(audioFile);\n      onClose();\n    }\n  };\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n      onClick={onClose}\n    >\n      <div\n        onClick={(e) => e.stopPropagation()}\n        className=\"bg-white rounded-lg shadow-xl w-96 p-6\"\n      >\n        <div className=\"flex justify-between items-center mb-4\">\n          <h3 className=\"text-lg font-semibold\">Record Audio</h3>\n          <button\n            onClick={onClose}\n            className=\"p-1 rounded-full hover:bg-gray-200\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {permissionError && (\n          <div\n            className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\"\n            role=\"alert\"\n          >\n            <strong className=\"font-bold\">Error:</strong>\n            <span className=\"block sm:inline\">\n              {\" \"}\n              Microphone permission denied. Please allow mic access in your\n              browser settings.\n            </span>\n          </div>\n        )}\n\n        {/* Player / Recorder */}\n        <div className=\"flex flex-col items-center justify-center h-32\">\n          {!audioURL && (\n            <button\n              type=\"button\"\n              onClick={isRecording ? stopRecording : startRecording}\n              className={`flex items-center justify-center w-20 h-20 rounded-full text-white transition-all\n                ${\n                  isRecording\n                    ? \"bg-red-500 hover:bg-red-600\"\n                    : \"bg-blue-500 hover:bg-blue-600\"\n                }\n              `}\n              disabled={permissionError}\n            >\n              {isRecording ? (\n                <StopCircle className=\"w-8 h-8\" />\n              ) : (\n                <Mic className=\"w-8 h-8\" />\n              )}\n            </button>\n          )}\n\n          {audioURL && (\n            <div className=\"w-full flex items-center gap-3\">\n              <button\n                type=\"button\"\n                onClick={togglePlay}\n                className=\"flex-shrink-0 w-12 h-12 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center\"\n              >\n                {isPlaying ? (\n                  <Pause className=\"w-6 h-6\" />\n                ) : (\n                  <Play className=\"w-6 h-6\" />\n                )}\n              </button>\n              <audio\n                ref={audioRef}\n                src={audioURL}\n                onEnded={() => setIsPlaying(false)}\n                className=\"w-full\"\n              />\n            </div>\n          )}\n        </div>\n\n        {/* Footer Buttons */}\n        <div className=\"flex justify-end gap-3 mt-6 border-t pt-4\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleAddClick}\n            disabled={!audioFile}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-black rounded-md hover:bg-gray-800 focus:outline-none disabled:opacity-50\"\n          >\n            <Check className=\"w-4 h-4 inline-block mr-1\" />\n            Add to Note\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3951, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/NoteEditor.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\"use client\";\n\nimport React, {\n  useEffect,\n  useState,\n  useMemo,\n  useCallback,\n  useRef,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport {\n  useEditor,\n  EditorContent,\n  Node as TiptapNode,\n  mergeAttributes,\n} from \"@tiptap/react\";\nimport Document from \"@tiptap/extension-document\";\nimport Paragraph from \"@tiptap/extension-paragraph\";\nimport Text from \"@tiptap/extension-text\";\nimport Bold from \"@tiptap/extension-bold\";\nimport Italic from \"@tiptap/extension-italic\";\nimport Heading from \"@tiptap/extension-heading\";\nimport BulletList from \"@tiptap/extension-bullet-list\";\nimport OrderedList from \"@tiptap/extension-ordered-list\";\nimport ListItem from \"@tiptap/extension-list-item\";\nimport History from \"@tiptap/extension-history\";\nimport Dropcursor from \"@tiptap/extension-dropcursor\";\nimport Gapcursor from \"@tiptap/extension-gapcursor\";\nimport HardBreak from \"@tiptap/extension-hard-break\";\nimport HorizontalRule from \"@tiptap/extension-horizontal-rule\";\nimport Strike from \"@tiptap/extension-strike\";\nimport Placeholder from \"@tiptap/extension-placeholder\";\nimport Link from \"@tiptap/extension-link\";\nimport Image from \"@tiptap/extension-image\";\n\nimport tippy, { Instance as TippyInstance } from \"tippy.js\";\nimport \"tippy.js/dist/tippy.css\";\nimport \"tippy.js/dist/svg-arrow.css\";\n\nimport { useNotes, useUserMetadata } from \"@/lib/db/useNotes\";\nimport db, { type Note } from \"@/lib/db/clientDb\";\nimport { EditorToolbar } from \"./EditorToolbar\";\nimport * as Tooltip from \"@radix-ui/react-tooltip\";\n\nimport TaskList from \"@tiptap/extension-task-list\";\nimport TaskItem from \"@tiptap/extension-task-item\";\nimport {\n  Loader2,\n  Save,\n  Lock,\n  Eye,\n  EyeOff,\n  Search as SearchIcon,\n  FileText,\n  Trash2,\n} from \"lucide-react\";\nimport { uploadToS3 } from \"@/lib/uploadToS3\";\nimport { deleteFromS3 } from \"@/lib/deleteFromS3\";\nimport { AudioRecorder } from \"./AudioRecorder\";\nimport {\n  CreateNotePasswordModal,\n  VerifyNotePasswordModal,\n} from \"./NotePasswordModals\";\n\n// --- Module Declaration ---\ndeclare module \"@tiptap/core\" {\n  interface Commands<ReturnType> {\n    video: {\n      setVideo: (options: { src: string }) => ReturnType;\n    };\n    audio: {\n      setAudio: (options: { src: string }) => ReturnType;\n    };\n    file: {\n      setFile: (options: { src: string; name: string }) => ReturnType;\n    };\n  }\n}\n\n// --- Custom Hooks ---\nfunction useDebounce<T>(value: T, delay: number): T {\n  const [debouncedValue, setDebouncedValue] = useState<T>(value);\n  useEffect(() => {\n    const timer = setTimeout(() => setDebouncedValue(value), delay);\n    return () => clearTimeout(timer);\n  }, [value, delay]);\n  return debouncedValue;\n}\n\n// --- Helper Functions ---\nfunction getSnippet(content: string, term: string) {\n  const el = document.createElement(\"div\");\n  el.innerHTML = content;\n  const text = el.textContent || \"\";\n  const lowerText = text.toLowerCase();\n  const lowerTerm = term.toLowerCase();\n\n  const index = lowerText.indexOf(lowerTerm);\n  if (index === -1) {\n    return text.substring(0, 100);\n  }\n\n  const start = Math.max(0, index - 30);\n  const end = Math.min(text.length, index + lowerTerm.length + 70);\n\n  let snippet = text.substring(start, end);\n\n  if (start > 0) snippet = \"... \" + snippet;\n  if (end < text.length) snippet = snippet + \" ...\";\n\n  snippet = snippet.replace(\n    new RegExp(term.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, \"\\\\$&\"), \"gi\"),\n    (match) => `<strong class=\"bg-yellow-200\">${match}</strong>`\n  );\n\n  return snippet;\n}\n\n// --- Components ---\n\nfunction AddLinkModal({\n  editor,\n  onClose,\n  initialName,\n  initialUrl,\n}: {\n  editor: any;\n  onClose: () => void;\n  initialName: string;\n  initialUrl: string;\n}) {\n  const [url, setUrl] = useState(initialUrl);\n  const [name, setName] = useState(initialName);\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!url) {\n      editor.chain().focus().extendMarkRange(\"link\").unsetLink().run();\n      onClose();\n      return;\n    }\n    const { from, to, empty } = editor.state.selection;\n    const linkName = name.trim() || url;\n    const selectedText = editor.state.doc.textBetween(from, to, \" \");\n\n    if (empty) {\n      const textToInsert = linkName;\n      editor\n        .chain()\n        .focus()\n        .insertContentAt(from, textToInsert)\n        .setTextSelection({ from, to: from + textToInsert.length })\n        .setLink({ href: url })\n        .setTextSelection(from + textToInsert.length)\n        .run();\n    } else {\n      if (linkName && linkName !== selectedText) {\n        editor\n          .chain()\n          .focus()\n          .deleteRange(editor.state.selection)\n          .insertContent(linkName)\n          .setTextSelection({ from, to: from + linkName.length })\n          .setLink({ href: url })\n          .setTextSelection(from + linkName.length)\n          .run();\n      } else {\n        editor\n          .chain()\n          .focus()\n          .extendMarkRange(\"link\")\n          .setLink({ href: url })\n          .run();\n      }\n    }\n    onClose();\n  };\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n      onClick={onClose}\n    >\n      <form\n        onSubmit={handleSubmit}\n        onClick={(e) => e.stopPropagation()}\n        className=\"bg-white rounded-lg shadow-xl w-96 p-5\"\n      >\n        <h3 className=\"text-lg font-semibold mb-4 text-center\">Add Link</h3>\n        <label htmlFor=\"url\" className=\"text-sm font-medium text-gray-700\">\n          Link to\n        </label>\n        <input\n          id=\"url\"\n          type=\"text\"\n          value={url}\n          onChange={(e) => setUrl(e.target.value)}\n          placeholder=\"Enter a URL or note title\"\n          className=\"w-full border border-gray-400 rounded-md px-3 py-2 mt-1 mb-3 focus:outline-none focus:ring-2 focus:ring-black\"\n          autoFocus\n        />\n        <label htmlFor=\"name\" className=\"text-sm font-medium text-gray-700\">\n          Name\n        </label>\n        <input\n          id=\"name\"\n          type=\"text\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          placeholder=\"Text to display (optional)\"\n          className=\"w-full border border-gray-400 rounded-md px-3 py-2 mt-1 focus:outline-none focus:ring-2 focus:ring-black\"\n        />\n        <div className=\"flex justify-end gap-3 mt-6\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"submit\"\n            className=\"px-4 py-2 text-sm font-medium text-white bg-black rounded-md hover:bg-gray-800 focus:outline-none\"\n          >\n            OK\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n}\n\n// --- Custom Video/Audio/File Extensions (IMPROVED STYLING) ---\n\nconst CustomVideo = TiptapNode.create({\n  name: \"video\",\n  group: \"block\",\n  atom: true,\n  addAttributes() {\n    return { src: { default: null }, controls: { default: true } };\n  },\n  parseHTML() {\n    return [{ tag: \"video[src]\" }];\n  },\n  renderHTML({ HTMLAttributes }) {\n    return [\n      \"div\",\n      {\n        // [FIX #3] Centered, max width, margin auto\n        class:\n          \"media-node video-player my-4 mx-auto max-w-lg rounded-xl overflow-hidden shadow-sm border border-gray-200\",\n        \"data-media-wrapper\": \"true\",\n      },\n      [\n        \"video\",\n        mergeAttributes(HTMLAttributes, { class: \"w-full h-auto block\" }),\n      ],\n    ];\n  },\n  addCommands() {\n    return {\n      setVideo:\n        (options: { src: string }) =>\n        ({ commands }: any) => {\n          return commands.insertContent({ type: this.name, attrs: options });\n        },\n    };\n  },\n});\n\nconst CustomAudio = TiptapNode.create({\n  name: \"audio\",\n  group: \"block\",\n  atom: true,\n  addAttributes() {\n    return { src: { default: null }, controls: { default: true } };\n  },\n  parseHTML() {\n    return [{ tag: \"audio[src]\" }];\n  },\n  renderHTML({ HTMLAttributes }) {\n    return [\n      \"div\",\n      {\n        // [FIX #3] Centered, added padding so user can click outside player to select\n        class:\n          \"media-node audio-player my-4 mx-auto max-w-md p-4 bg-gray-50 rounded-xl border border-gray-200 cursor-pointer hover:border-blue-300 transition-colors\",\n        \"data-media-wrapper\": \"true\",\n      },\n      [\"audio\", mergeAttributes(HTMLAttributes, { class: \"w-full\" })],\n    ];\n  },\n  addCommands() {\n    return {\n      setAudio:\n        (options: { src: string }) =>\n        ({ commands }: any) => {\n          return commands.insertContent({ type: this.name, attrs: options });\n        },\n    };\n  },\n});\n\n// [FIX #3] Styled File Block\nconst CustomFile = TiptapNode.create({\n  name: \"file\",\n  group: \"block\",\n  atom: true,\n  addAttributes() {\n    return {\n      src: { default: null },\n      name: { default: \"Attachment\" },\n    };\n  },\n  parseHTML() {\n    return [{ tag: \"div[data-file-attachment]\" }];\n  },\n  renderHTML({ HTMLAttributes }) {\n    return [\n      \"div\",\n      {\n        // Centered, nice card look\n        class: \"media-node file-attachment my-3 mx-auto max-w-sm\",\n        \"data-media-wrapper\": \"true\",\n        \"data-file-attachment\": \"true\",\n      },\n      [\n        \"a\",\n        {\n          href: HTMLAttributes.src,\n          target: \"_blank\",\n          rel: \"noopener noreferrer\",\n          class:\n            \"flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg shadow-sm hover:shadow-md hover:border-blue-300 transition-all no-underline group cursor-pointer\",\n        },\n        // SVG Icon\n        [\n          \"div\",\n          {\n            class:\n              \"p-2 bg-blue-50 rounded-full text-blue-600 group-hover:bg-blue-100 transition-colors\",\n          },\n          [\n            \"svg\",\n            {\n              xmlns: \"http://www.w3.org/2000/svg\",\n              width: \"20\",\n              height: \"20\",\n              viewBox: \"0 0 24 24\",\n              fill: \"none\",\n              stroke: \"currentColor\",\n              \"stroke-width\": \"2\",\n              \"stroke-linecap\": \"round\",\n              \"stroke-linejoin\": \"round\",\n            },\n            [\n              \"path\",\n              {\n                d: \"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z\",\n              },\n            ],\n            [\"polyline\", { points: \"14 2 14 8 20 8\" }],\n          ],\n        ],\n        [\n          \"div\",\n          { class: \"flex flex-col overflow-hidden\" },\n          [\n            \"span\",\n            {\n              class:\n                \"text-sm font-medium text-gray-700 truncate block max-w-[200px]\",\n            },\n            HTMLAttributes.name,\n          ],\n          [\n            \"span\",\n            { class: \"text-[10px] text-gray-400 uppercase\" },\n            \"Document\",\n          ],\n        ],\n      ],\n    ];\n  },\n  addCommands() {\n    return {\n      setFile:\n        (options: { src: string; name: string }) =>\n        ({ commands }: any) => {\n          return commands.insertContent({ type: this.name, attrs: options });\n        },\n    };\n  },\n});\n\n// --- LockedNoteScreen ---\nfunction LockedNoteScreen({\n  onUnlockSubmit,\n  error,\n}: {\n  onUnlockSubmit: (password: string) => void;\n  error: string;\n}) {\n  const [password, setPassword] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    onUnlockSubmit(password);\n  };\n\n  return (\n    <div className=\"flex flex-col items-center justify-center h-full text-gray-500 p-4\">\n      <Lock className=\"w-16 h-16 mb-4\" />\n      <h2 className=\"text-xl font-semibold mb-2\">Note Locked</h2>\n      <p className=\"mb-4 text-center\">\n        This note is locked. Enter your notes password to view it.\n      </p>\n      <form onSubmit={handleSubmit} className=\"w-full max-w-sm\">\n        <div className=\"relative mb-2\">\n          <input\n            id=\"password\"\n            type={showPassword ? \"text\" : \"password\"}\n            value={password}\n            onChange={(e) => setPassword(e.target.value)}\n            autoComplete=\"new-password\"\n            name=\"lock_screen_pwd_field\"\n            className=\"w-full border border-gray-400 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-black\"\n            autoFocus\n          />\n          <button\n            type=\"button\"\n            onClick={() => setShowPassword(!showPassword)}\n            className=\"absolute right-3 top-1/2 -translate-y-1/2 p-1 text-gray-500\"\n          >\n            {showPassword ? (\n              <EyeOff className=\"w-4 h-4\" />\n            ) : (\n              <Eye className=\"w-4 h-4\" />\n            )}\n          </button>\n        </div>\n        {error && <p className=\"text-sm text-red-600 mb-4\">{error}</p>}\n        <button\n          type=\"submit\"\n          className=\"w-full bg-black text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-800\"\n        >\n          Unlock\n        </button>\n      </form>\n    </div>\n  );\n}\n\n// --- Custom Tiptap Extensions ---\nconst CustomListItem = ListItem.extend({\n  addKeyboardShortcuts() {\n    return {\n      Enter: () => {\n        const { state } = this.editor;\n        const { $from } = state.selection;\n        if (\n          $from.parent.type.name === \"listItem\" &&\n          $from.parent.content.size === 0\n        ) {\n          return this.editor.commands.liftListItem(\"listItem\");\n        }\n        return this.editor.commands.splitListItem(\"listItem\");\n      },\n      Backspace: (props) => {\n        const { state } = this.editor;\n        const { $from } = state.selection;\n        if (\n          $from.parent.type.name === \"listItem\" &&\n          $from.parent.content.size === 0 &&\n          $from.parentOffset === 0\n        ) {\n          return this.editor.commands.liftListItem(\"listItem\");\n        }\n        return this.parent?.()?.Backspace?.(props);\n      },\n    };\n  },\n});\n\nconst CustomTaskItem = TaskItem.extend({\n  content: \"paragraph\",\n});\n\n// --- Main NoteEditor Component ---\nexport function NoteEditor({\n  activeNoteId,\n  setActiveNoteId,\n}: {\n  activeNoteId: string | null;\n  setActiveNoteId: (id: string | null) => void;\n}) {\n  const { notes, updateNote, lockNote, unlockNote, deleteNote } = useNotes();\n  const { metadata } = useUserMetadata();\n\n  const [isUploading, setIsUploading] = useState(false);\n  const [title, setTitle] = useState(\"\");\n  const [originalContent, setOriginalContent] = useState(\"\");\n  const [originalTitle, setOriginalTitle] = useState(\"\");\n  const [currentContent, setCurrentContent] = useState(\"\");\n  const [isLinkModalOpen, setIsLinkModalOpen] = useState(false);\n  const [initialLinkName, setInitialLinkName] = useState(\"\");\n  const [initialLinkUrl, setInitialLinkUrl] = useState(\"\");\n  const [isAudioModalOpen, setIsAudioModalOpen] = useState(false);\n  const [activeNote, setActiveNote] = useState<Note | null>(null);\n  const [showCreatePasswordModal, setShowCreatePasswordModal] = useState(false);\n  const [showVerifyPasswordModal, setShowVerifyPasswordModal] = useState(false);\n  const [sessionPassword, setSessionPassword] = useState<string | null>(null);\n\n  const [pendingAction, setPendingAction] = useState<\"lock\" | \"unlock\" | null>(\n    null\n  );\n  const [lockError, setLockError] = useState(\"\");\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const mediaInputRef = useRef<HTMLInputElement | null>(null);\n  const docInputRef = useRef<HTMLInputElement | null>(null);\n  const searchWrapperRef = useRef<HTMLDivElement>(null);\n  const isInitialLoad = useRef(true);\n\n  // Media Deletion Refs\n  const menuContainerRef = useRef<HTMLDivElement | null>(null);\n  const tippyInstance = useRef<TippyInstance | null>(null);\n  const lastSelectedPos = useRef<number | null>(null);\n  const [isDeletingMedia, setIsDeletingMedia] = useState(false);\n\n  const [, setUpdateTrigger] = useState({});\n\n  const searchResults = useMemo(() => {\n    if (!searchTerm) return null;\n    if (!notes) return [];\n    const lowerTerm = searchTerm.toLowerCase();\n    return notes\n      .filter(\n        (note) =>\n          note.title.toLowerCase().includes(lowerTerm) ||\n          (note.content || \"\").toLowerCase().includes(lowerTerm)\n      )\n      .map((note) => ({\n        id: note.id,\n        title: note.title || \"Untitled Note\",\n        snippet: getSnippet(note.content || \"\", searchTerm),\n      }));\n  }, [searchTerm, notes]);\n\n  const editor = useEditor({\n    extensions: [\n      Document,\n      Paragraph,\n      Text,\n      Bold,\n      Italic,\n      Strike,\n      Heading.configure({ levels: [1, 2, 3] }),\n      BulletList,\n      OrderedList,\n      CustomListItem,\n      History,\n      Dropcursor,\n      Gapcursor,\n      HardBreak,\n      HorizontalRule,\n      Placeholder.configure({ placeholder: \"Start writing...\" }),\n      TaskList,\n      CustomTaskItem.configure({ nested: true }),\n      Link.configure({ openOnClick: true, autolink: true }),\n      // [FIX #3] Centered images with max width\n      Image.configure({\n        inline: false,\n        allowBase64: true,\n        HTMLAttributes: {\n          class:\n            \"rounded-lg max-h-[500px] w-auto mx-auto my-4 shadow-sm border border-gray-100\",\n        },\n      }),\n      CustomVideo,\n      CustomAudio,\n      CustomFile,\n    ],\n    content: \"\",\n    onTransaction: () => {\n      setUpdateTrigger({});\n    },\n    onUpdate: ({ editor }) => {\n      setCurrentContent(editor.getHTML());\n    },\n    editable: false,\n    editorProps: {\n      attributes: {\n        // [FIX #2] Added 'h-full' and 'min-h-[60vh]' to ensure scrolling works by making editor take height\n        // [FIX #3] Added styles for media selection\n        class:\n          \"tiptap-styles p-6 focus:outline-none prose prose-sm max-w-none min-h-full [&_img.ProseMirror-selectednode]:ring-2 [&_img.ProseMirror-selectednode]:ring-blue-500 [&_.media-node.ProseMirror-selectednode]:ring-2 [&_.media-node.ProseMirror-selectednode]:ring-blue-500 [&_.media-node]:outline-none\",\n      },\n    },\n    immediatelyRender: false,\n  });\n\n  // --- Media Deletion Logic ---\n\n  useEffect(() => {\n    if (typeof document !== \"undefined\") {\n      const container = document.createElement(\"div\");\n      container.setAttribute(\"data-tippy-menu\", \"true\");\n      menuContainerRef.current = container;\n      document.body.appendChild(container);\n\n      tippyInstance.current = tippy(document.body, {\n        content: container,\n        trigger: \"manual\",\n        interactive: true,\n        placement: \"top\",\n        appendTo: document.body,\n        animation: \"shift-away\",\n        zIndex: 9999,\n        arrow: true,\n        offset: [0, 10],\n      });\n\n      return () => {\n        tippyInstance.current?.destroy();\n        if (menuContainerRef.current?.parentNode) {\n          menuContainerRef.current.parentNode.removeChild(\n            menuContainerRef.current\n          );\n        }\n      };\n    }\n  }, []);\n\n  const updateBubble = useCallback(() => {\n    if (!editor || !tippyInstance.current) return;\n    const { state, view } = editor;\n    const { from } = state.selection;\n    const node = state.doc.nodeAt(from);\n\n    const isMedia =\n      !!node &&\n      (node.type.name === \"image\" ||\n        node.type.name === \"audio\" ||\n        node.type.name === \"video\" ||\n        node.type.name === \"file\");\n\n    if (!isMedia) {\n      tippyInstance.current.hide();\n      return;\n    }\n\n    const domNode = view.nodeDOM(from) as HTMLElement;\n    let targetElement = domNode;\n\n    // Handle wrappers\n    if (\n      node.type.name === \"audio\" ||\n      node.type.name === \"video\" ||\n      node.type.name === \"file\"\n    ) {\n      let selector = `[data-media-wrapper] ${node.type.name}[src=\"${node.attrs.src}\"]`;\n      if (node.type.name === \"file\") selector = `[data-file-attachment]`;\n\n      const wrapper = view.dom.querySelector(selector)?.closest(\".media-node\");\n\n      if (wrapper) {\n        targetElement = wrapper as HTMLElement;\n      } else if (domNode && domNode.classList.contains(\"media-node\")) {\n        targetElement = domNode;\n      }\n    }\n\n    let rect;\n    if (targetElement && targetElement.getBoundingClientRect) {\n      rect = targetElement.getBoundingClientRect();\n    } else {\n      const coords = view.coordsAtPos(from);\n      rect = {\n        width: 0,\n        height: 0,\n        top: coords.top,\n        bottom: coords.bottom,\n        left: coords.left,\n        right: coords.right,\n      };\n    }\n\n    tippyInstance.current.setProps({\n      getReferenceClientRect: () => rect as DOMRect,\n    });\n    tippyInstance.current.show();\n  }, [editor]);\n\n  // [FIX #3] Audio Selection Fix\n  // Logic: If click is on the Audio Controls -> Let it play.\n  // If click is on the Wrapper (padding area) -> Select it.\n  useEffect(() => {\n    if (!editor) return;\n    const dom = editor.view.dom;\n\n    const clickHandler = (e: Event) => {\n      const target = e.target as HTMLElement;\n      const isImg = target.tagName === \"IMG\";\n      const mediaWrapper = target.closest(\".media-node\");\n\n      // Audio/Video Control check:\n      const isControls =\n        target.tagName === \"AUDIO\" ||\n        target.tagName === \"VIDEO\" ||\n        target.tagName === \"INPUT\" ||\n        target.className.includes(\"controls\");\n\n      const isMediaClick = isImg || (mediaWrapper && !isControls);\n\n      if (mediaWrapper && isControls) {\n        // User clicked play/pause, do not toggle selection, hide menu if open\n        return;\n      }\n\n      if (isMediaClick) {\n        setTimeout(() => {\n          const { from } = editor.state.selection;\n          const isReClicking = lastSelectedPos.current === from;\n\n          if (isReClicking) {\n            // Toggle Off\n            const node = editor.state.doc.nodeAt(from);\n            if (node) {\n              const afterPos = from + node.nodeSize;\n              editor.chain().focus().setTextSelection(afterPos).run();\n              tippyInstance.current?.hide();\n              lastSelectedPos.current = null;\n            }\n          } else {\n            // Select\n            updateBubble();\n            lastSelectedPos.current = from;\n          }\n        }, 50);\n      } else {\n        tippyInstance.current?.hide();\n        lastSelectedPos.current = null;\n      }\n    };\n\n    dom.addEventListener(\"click\", clickHandler);\n    const scrollHandler = () => {\n      tippyInstance.current?.hide();\n    };\n    window.addEventListener(\"scroll\", scrollHandler, true);\n\n    return () => {\n      dom.removeEventListener(\"click\", clickHandler);\n      window.removeEventListener(\"scroll\", scrollHandler, true);\n    };\n  }, [editor, updateBubble]);\n\n  const deleteSelectedMedia = useCallback(async () => {\n    if (!editor) return;\n    setIsDeletingMedia(true);\n    const { state } = editor;\n    const { from } = state.selection;\n    const node = state.doc.nodeAt(from);\n\n    if (\n      node &&\n      (node.type.name === \"image\" ||\n        node.type.name === \"audio\" ||\n        node.type.name === \"video\" ||\n        node.type.name === \"file\")\n    ) {\n      const src = node.attrs.src;\n      if (src) await deleteFromS3(src);\n      editor.chain().focus().deleteSelection().run();\n      setCurrentContent(editor.getHTML());\n\n      tippyInstance.current?.hide();\n      lastSelectedPos.current = null;\n    }\n    setIsDeletingMedia(false);\n  }, [editor]);\n\n  // --- End Media Deletion Logic ---\n\n  useEffect(() => {\n    function handleClickOutside(event: MouseEvent) {\n      if (\n        searchWrapperRef.current &&\n        !searchWrapperRef.current.contains(event.target as Node)\n      ) {\n        setSearchTerm(\"\");\n      }\n    }\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => {\n      document.removeEventListener(\"mousedown\", handleClickOutside);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (!activeNoteId) {\n      editor?.setEditable(false);\n      editor?.commands.clearContent();\n      setTitle(\"\");\n      setOriginalTitle(\"\");\n      setCurrentContent(\"\");\n      setOriginalContent(\"\");\n      setActiveNote(null);\n      setSessionPassword(null);\n      setLockError(\"\");\n      isInitialLoad.current = true;\n      return;\n    }\n    const loadNote = async () => {\n      isInitialLoad.current = true;\n      const note = await db.notes.get(activeNoteId);\n      if (note) {\n        setActiveNote(note);\n        setLockError(\"\");\n\n        if (note.isLocked && !sessionPassword) {\n          editor?.commands.clearContent();\n          editor?.setEditable(false);\n        } else {\n          editor?.commands.setContent(note.content, { emitUpdate: false });\n          editor?.setEditable(true);\n        }\n\n        setTitle(note.title);\n        setCurrentContent(note.content);\n        setOriginalTitle(note.title);\n        setOriginalContent(note.content);\n\n        setTimeout(() => {\n          isInitialLoad.current = false;\n        }, 500);\n      }\n    };\n    loadNote();\n  }, [activeNoteId, editor, sessionPassword]);\n\n  const hasChanges = useMemo(() => {\n    if (!activeNoteId || !activeNote) return false;\n    if (activeNote.isLocked && !sessionPassword) return false;\n    return title !== originalTitle || currentContent !== originalContent;\n  }, [\n    title,\n    currentContent,\n    originalTitle,\n    originalContent,\n    activeNoteId,\n    activeNote,\n    sessionPassword,\n  ]);\n\n  const debouncedTitle = useDebounce(title, 500);\n  const debouncedContent = useDebounce(currentContent, 500);\n\n  useEffect(() => {\n    if (isInitialLoad.current || !activeNoteId || !editor?.isEditable) {\n      return;\n    }\n    if (\n      debouncedTitle !== originalTitle ||\n      debouncedContent !== originalContent\n    ) {\n      console.log(\"Auto-saving...\");\n      updateNote(activeNoteId, {\n        content: debouncedContent,\n        title: debouncedTitle,\n      });\n      setOriginalTitle(debouncedTitle);\n      setOriginalContent(debouncedContent);\n    }\n  }, [\n    debouncedTitle,\n    debouncedContent,\n    activeNoteId,\n    editor?.isEditable,\n    updateNote,\n    originalTitle,\n    originalContent,\n  ]);\n\n  const handleSave = () => {\n    if (!editor || !activeNoteId || !hasChanges) return;\n    updateNote(activeNoteId, {\n      content: currentContent,\n      title: title,\n    });\n    setOriginalTitle(title);\n    setOriginalContent(currentContent);\n  };\n\n  const handleFileUpload = async (files: FileList | File[] | null) => {\n    if (!activeNoteId || !files || !editor) return;\n    setIsUploading(true);\n    const filesToUpload = Array.from(files);\n    try {\n      for (const file of filesToUpload) {\n        const s3Response = await uploadToS3(file, \"notes\");\n        const url = s3Response.url;\n        const fileName = file.name.toLowerCase();\n        const fileType = file.type;\n        if (\n          fileType.startsWith(\"image/\") ||\n          fileName.endsWith(\".png\") ||\n          fileName.endsWith(\".jpg\") ||\n          fileName.endsWith(\".jpeg\") ||\n          fileName.endsWith(\".gif\") ||\n          fileName.endsWith(\".svg\")\n        ) {\n          editor.chain().focus().setImage({ src: url, alt: fileName }).run();\n        } else if (\n          fileType.startsWith(\"video/\") ||\n          fileName.endsWith(\".mp4\") ||\n          fileName.endsWith(\".webm\") ||\n          fileName.endsWith(\".mov\")\n        ) {\n          editor.chain().focus().setVideo({ src: url }).run();\n        } else if (\n          fileType.startsWith(\"audio/\") ||\n          fileName.endsWith(\".mp3\") ||\n          fileName.endsWith(\".wav\") ||\n          fileName.endsWith(\".ogg\")\n        ) {\n          editor.chain().focus().setAudio({ src: url }).run();\n        } else {\n          editor.chain().focus().setFile({ src: url, name: file.name }).run();\n        }\n      }\n    } catch (error) {\n      console.error(\"Failed to upload files:\", error);\n    }\n    setIsUploading(false);\n  };\n\n  const handleAddLink = useCallback(() => {\n    if (!editor) return;\n    const { from, to } = editor.state.selection;\n    const selectedText = editor.state.doc.textBetween(from, to, \" \");\n    setInitialLinkName(selectedText);\n    setInitialLinkUrl(editor.getAttributes(\"link\").href || \"\");\n    setIsLinkModalOpen(true);\n  }, [editor]);\n\n  const handleTitleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\n    if (e.key === \"Enter\") {\n      e.preventDefault();\n      editor?.commands.focus();\n    }\n  };\n\n  const handleDeleteNote = () => {\n    if (!activeNoteId) return;\n    deleteNote(activeNoteId);\n    setActiveNoteId(null);\n  };\n\n  const onVerifySuccess = (password: string) => {\n    setSessionPassword(password);\n    setShowVerifyPasswordModal(false);\n    setLockError(\"\");\n    if (pendingAction === \"lock\") performLock();\n    if (pendingAction === \"unlock\") performUnlock();\n    setPendingAction(null);\n  };\n  const onCreateSuccess = (password: string) => {\n    setSessionPassword(password);\n    setShowCreatePasswordModal(false);\n    if (metadata) {\n      db.userMetadata.update(metadata.userId, { hasNotesPassword: true });\n    }\n    if (pendingAction === \"lock\") performLock();\n    setPendingAction(null);\n  };\n  const performLock = () => {\n    if (!activeNote) return;\n    if (hasChanges) handleSave();\n    lockNote(activeNote.id);\n    setActiveNote({ ...activeNote, isLocked: true });\n    editor?.commands.clearContent();\n    editor?.setEditable(false);\n    setSessionPassword(null);\n  };\n  const performUnlock = () => {\n    if (!activeNote) return;\n    unlockNote(activeNote.id);\n    setActiveNote({ ...activeNote, isLocked: false });\n    editor?.commands.setContent(originalContent, { emitUpdate: false });\n    editor?.setEditable(true);\n  };\n\n  const handleToggleLock = () => {\n    if (!activeNote) return;\n    setLockError(\"\");\n    if (activeNote.isLocked) {\n      setPendingAction(\"unlock\");\n      setShowVerifyPasswordModal(true);\n    } else {\n      setPendingAction(\"lock\");\n      if (metadata?.hasNotesPassword) {\n        performLock();\n      } else {\n        setShowCreatePasswordModal(true);\n      }\n    }\n  };\n\n  const handleUnlockSubmit = async (password: string) => {\n    setLockError(\"\");\n    if (!password) {\n      setLockError(\"Password cannot be empty.\");\n      return;\n    }\n    try {\n      const res = await fetch(\"/api/notes-password\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ action: \"verify\", password }),\n      });\n      if (!res.ok) {\n        setLockError(\"Incorrect password. Please try again.\");\n      } else {\n        setSessionPassword(password);\n      }\n    } catch {\n      setLockError(\"An error occurred. Please try again.\");\n    }\n  };\n\n  const handleSearchResultClick = (noteId: string) => {\n    setActiveNoteId(noteId);\n    setSearchTerm(\"\");\n  };\n\n  const handleContainerClick = (e: React.MouseEvent) => {\n    if (!editor || !editor.isEditable) return;\n    const editorEl = editor.view.dom;\n    const titleEl = e.currentTarget.querySelector(\n      'input[placeholder=\"Note Title\"]'\n    );\n    if (\n      editorEl.contains(e.target as Node) ||\n      titleEl?.contains(e.target as Node)\n    ) {\n      return;\n    }\n    editor\n      .chain()\n      .focus()\n      .setTextSelection(editor.state.doc.content.size)\n      .run();\n  };\n\n  const floatingMenu = (\n    <div className=\"bg-gray-900 text-white rounded-lg shadow-xl px-3 py-2 flex items-center gap-2 text-xs font-medium\">\n      <button\n        onClick={deleteSelectedMedia}\n        className=\"flex items-center gap-1 hover:text-red-400 transition-colors\"\n      >\n        {isDeletingMedia ? (\n          <Loader2 size={14} className=\"animate-spin\" />\n        ) : (\n          <Trash2 size={14} />\n        )}\n        <span>Delete</span>\n      </button>\n    </div>\n  );\n\n  return (\n    <Tooltip.Provider delayDuration={100}>\n      <div className=\"flex flex-col h-full relative\">\n        {/* Search bar */}\n        <div\n          className=\"flex-shrink-0 p-2 border-b border-gray-200 relative\"\n          ref={searchWrapperRef}\n        >\n          <Tooltip.Root>\n            <Tooltip.Trigger asChild>\n              <div className=\"relative\">\n                <div className=\"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none\">\n                  <SearchIcon className=\"h-4 w-4 text-gray-400\" />\n                </div>\n                <input\n                  type=\"text\"\n                  placeholder=\"Search all notes...\"\n                  className=\"w-full pl-9 p-2 rounded-md bg-gray-100 focus:bg-white focus:outline-none focus:ring-2 focus:ring-black\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                />\n              </div>\n            </Tooltip.Trigger>\n            <Tooltip.Portal>\n              <Tooltip.Content\n                className=\"bg-black text-white px-2 py-1 rounded text-xs shadow-lg z-50\"\n                sideOffset={5}\n              >\n                Search all notes by title or content\n                <Tooltip.Arrow className=\"fill-black\" />\n              </Tooltip.Content>\n            </Tooltip.Portal>\n          </Tooltip.Root>\n\n          {searchResults && (\n            <div className=\"absolute top-full left-2 right-2 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-50 max-h-80 overflow-y-auto\">\n              {searchResults.length === 0 ? (\n                <p className=\"p-3 text-sm text-gray-500\">No results found.</p>\n              ) : (\n                <ul>\n                  {searchResults.map((note) => (\n                    <li key={note.id}>\n                      <button\n                        onClick={() => handleSearchResultClick(note.id)}\n                        className=\"w-full text-left flex items-center gap-3 p-3 hover:bg-gray-100\"\n                      >\n                        <FileText className=\"w-4 h-4 text-gray-500 flex-shrink-0\" />\n                        <div className=\"overflow-hidden\">\n                          <p className=\"text-sm font-medium truncate\">\n                            {note.title}\n                          </p>\n                          <p\n                            className=\"text-xs text-gray-500 truncate\"\n                            dangerouslySetInnerHTML={{ __html: note.snippet }}\n                          />\n                        </div>\n                      </button>\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Editor Toolbar */}\n        <EditorToolbar\n          editor={editor}\n          mediaInputRef={mediaInputRef}\n          docInputRef={docInputRef}\n          onAddLink={handleAddLink}\n          onRecordAudioClick={() => setIsAudioModalOpen(true)}\n          isLocked={activeNote?.isLocked || false}\n          onToggleLock={handleToggleLock}\n          onDeleteNote={handleDeleteNote}\n        />\n\n        {/* Content Area */}\n        {!activeNoteId || !activeNote ? (\n          <div\n            className=\"flex-1 flex items-center justify-center text-gray-500\"\n            onClick={handleContainerClick}\n          >\n            Select a note to start editing.\n          </div>\n        ) : activeNote.isLocked && !sessionPassword ? (\n          <LockedNoteScreen\n            onUnlockSubmit={handleUnlockSubmit}\n            error={lockError}\n          />\n        ) : (\n          <>\n            {isUploading && (\n              <div className=\"flex items-center gap-2 p-2 text-xs text-gray-600 border-b border-gray-200\">\n                <Loader2 className=\"w-4 h-4 animate-spin\" />\n                <span>Uploading files...</span>\n              </div>\n            )}\n            {/* [FIX #2] Added 'flex-1 overflow-y-auto' here as well to align with parent layout */}\n            <div\n              className=\"flex-1 overflow-y-auto [&::-webkit-scrollbar]:hidden [-ms-overflow-style:none] [scrollbar-width:none]\"\n              onClick={handleContainerClick}\n            >\n              <input\n                type=\"text\"\n                value={title}\n                onChange={(e) => setTitle(e.target.value)}\n                onKeyDown={handleTitleKeyDown}\n                placeholder=\"Note Title\"\n                className=\"text-2xl font-bold w-full p-6 pb-0 focus:outline-none\"\n                disabled={!editor?.isEditable}\n              />\n              <EditorContent editor={editor} />\n            </div>\n            {hasChanges && (\n              <Tooltip.Root>\n                <Tooltip.Trigger asChild>\n                  <button\n                    onClick={handleSave}\n                    className=\"absolute bottom-6 right-6 z-10 bg-black text-white px-4 py-2 rounded-full shadow-lg flex items-center gap-2 text-sm font-medium hover:bg-gray-800\"\n                  >\n                    <Save className=\"w-4 h-4\" />\n                    Save Changes\n                  </button>\n                </Tooltip.Trigger>\n                <Tooltip.Portal>\n                  <Tooltip.Content\n                    className=\"bg-black text-white px-2 py-1 rounded text-xs shadow-lg z-50\"\n                    sideOffset={5}\n                  >\n                    Save\n                    <Tooltip.Arrow className=\"fill-black\" />\n                  </Tooltip.Content>\n                </Tooltip.Portal>\n              </Tooltip.Root>\n            )}\n          </>\n        )}\n\n        {/* Modals */}\n        {isLinkModalOpen && (\n          <AddLinkModal\n            editor={editor}\n            onClose={() => setIsLinkModalOpen(false)}\n            initialName={initialLinkName}\n            initialUrl={initialLinkUrl}\n          />\n        )}\n        {isAudioModalOpen && (\n          <AudioRecorder\n            onClose={() => setIsAudioModalOpen(false)}\n            onAdd={(file) => handleFileUpload([file])}\n          />\n        )}\n        {showCreatePasswordModal && (\n          <CreateNotePasswordModal\n            onClose={() => {\n              setShowCreatePasswordModal(false);\n              setPendingAction(null);\n            }}\n            onSuccess={onCreateSuccess}\n          />\n        )}\n        {showVerifyPasswordModal && (\n          <VerifyNotePasswordModal\n            onClose={() => {\n              setShowVerifyPasswordModal(false);\n              setPendingAction(null);\n            }}\n            onSuccess={onVerifySuccess}\n          />\n        )}\n\n        <input\n          type=\"file\"\n          ref={mediaInputRef}\n          onChange={(e) => {\n            handleFileUpload(e.target.files);\n            e.target.value = \"\";\n          }}\n          className=\"hidden\"\n          multiple\n          accept=\"image/*,video/*\"\n        />\n        <input\n          type=\"file\"\n          ref={docInputRef}\n          onChange={(e) => {\n            handleFileUpload(e.target.files);\n            e.target.value = \"\";\n          }}\n          className=\"hidden\"\n          multiple\n          accept=\".pdf,.doc,.docx,.txt,.csv,audio/*\"\n        />\n      </div>\n\n      {/* Render Floating Menu Portal */}\n      {menuContainerRef.current &&\n        createPortal(floatingMenu, menuContainerRef.current)}\n    </Tooltip.Provider>\n  );\n}\n"],"names":[],"mappings":"AAAA,qDAAqD;;;;;AAGrD;AAOA;AACA;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AACA;AACA;AA3DA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+EA,uBAAuB;AACvB,SAAS,YAAe,KAAQ,EAAE,KAAa;IAC7C,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAI;IACxD,IAAA,kNAAS,EAAC;QACR,MAAM,QAAQ,WAAW,IAAM,kBAAkB,QAAQ;QACzD,OAAO,IAAM,aAAa;IAC5B,GAAG;QAAC;QAAO;KAAM;IACjB,OAAO;AACT;AAEA,2BAA2B;AAC3B,SAAS,WAAW,OAAe,EAAE,IAAY;IAC/C,MAAM,KAAK,SAAS,aAAa,CAAC;IAClC,GAAG,SAAS,GAAG;IACf,MAAM,OAAO,GAAG,WAAW,IAAI;IAC/B,MAAM,YAAY,KAAK,WAAW;IAClC,MAAM,YAAY,KAAK,WAAW;IAElC,MAAM,QAAQ,UAAU,OAAO,CAAC;IAChC,IAAI,UAAU,CAAC,GAAG;QAChB,OAAO,KAAK,SAAS,CAAC,GAAG;IAC3B;IAEA,MAAM,QAAQ,KAAK,GAAG,CAAC,GAAG,QAAQ;IAClC,MAAM,MAAM,KAAK,GAAG,CAAC,KAAK,MAAM,EAAE,QAAQ,UAAU,MAAM,GAAG;IAE7D,IAAI,UAAU,KAAK,SAAS,CAAC,OAAO;IAEpC,IAAI,QAAQ,GAAG,UAAU,SAAS;IAClC,IAAI,MAAM,KAAK,MAAM,EAAE,UAAU,UAAU;IAE3C,UAAU,QAAQ,OAAO,CACvB,IAAI,OAAO,KAAK,OAAO,CAAC,0BAA0B,SAAS,OAC3D,CAAC,QAAU,CAAC,8BAA8B,EAAE,MAAM,SAAS,CAAC;IAG9D,OAAO;AACT;AAEA,qBAAqB;AAErB,SAAS,aAAa,EACpB,MAAM,EACN,OAAO,EACP,WAAW,EACX,UAAU,EAMX;IACC,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,iNAAQ,EAAC;IAC/B,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,IAAI,CAAC,KAAK;YACR,OAAO,KAAK,GAAG,KAAK,GAAG,eAAe,CAAC,QAAQ,SAAS,GAAG,GAAG;YAC9D;YACA;QACF;QACA,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,KAAK,EAAE,GAAG,OAAO,KAAK,CAAC,SAAS;QAClD,MAAM,WAAW,KAAK,IAAI,MAAM;QAChC,MAAM,eAAe,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,IAAI;QAE5D,IAAI,OAAO;YACT,MAAM,eAAe;YACrB,OACG,KAAK,GACL,KAAK,GACL,eAAe,CAAC,MAAM,cACtB,gBAAgB,CAAC;gBAAE;gBAAM,IAAI,OAAO,aAAa,MAAM;YAAC,GACxD,OAAO,CAAC;gBAAE,MAAM;YAAI,GACpB,gBAAgB,CAAC,OAAO,aAAa,MAAM,EAC3C,GAAG;QACR,OAAO;YACL,IAAI,YAAY,aAAa,cAAc;gBACzC,OACG,KAAK,GACL,KAAK,GACL,WAAW,CAAC,OAAO,KAAK,CAAC,SAAS,EAClC,aAAa,CAAC,UACd,gBAAgB,CAAC;oBAAE;oBAAM,IAAI,OAAO,SAAS,MAAM;gBAAC,GACpD,OAAO,CAAC;oBAAE,MAAM;gBAAI,GACpB,gBAAgB,CAAC,OAAO,SAAS,MAAM,EACvC,GAAG;YACR,OAAO;gBACL,OACG,KAAK,GACL,KAAK,GACL,eAAe,CAAC,QAChB,OAAO,CAAC;oBAAE,MAAM;gBAAI,GACpB,GAAG;YACR;QACF;QACA;IACF;IACA,qBACE,8OAAC;QACC,WAAU;QACV,SAAS;kBAET,cAAA,8OAAC;YACC,UAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;YACjC,WAAU;;8BAEV,8OAAC;oBAAG,WAAU;8BAAyC;;;;;;8BACvD,8OAAC;oBAAM,SAAQ;oBAAM,WAAU;8BAAoC;;;;;;8BAGnE,8OAAC;oBACC,IAAG;oBACH,MAAK;oBACL,OAAO;oBACP,UAAU,CAAC,IAAM,OAAO,EAAE,MAAM,CAAC,KAAK;oBACtC,aAAY;oBACZ,WAAU;oBACV,SAAS;;;;;;8BAEX,8OAAC;oBAAM,SAAQ;oBAAO,WAAU;8BAAoC;;;;;;8BAGpE,8OAAC;oBACC,IAAG;oBACH,MAAK;oBACL,OAAO;oBACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;oBACvC,aAAY;oBACZ,WAAU;;;;;;8BAEZ,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,MAAK;4BACL,SAAS;4BACT,WAAU;sCACX;;;;;;sCAGD,8OAAC;4BACC,MAAK;4BACL,WAAU;sCACX;;;;;;;;;;;;;;;;;;;;;;;AAOX;AAEA,gEAAgE;AAEhE,MAAM,cAAc,yJAAU,CAAC,MAAM,CAAC;IACpC,MAAM;IACN,OAAO;IACP,MAAM;IACN;QACE,OAAO;YAAE,KAAK;gBAAE,SAAS;YAAK;YAAG,UAAU;gBAAE,SAAS;YAAK;QAAE;IAC/D;IACA;QACE,OAAO;YAAC;gBAAE,KAAK;YAAa;SAAE;IAChC;IACA,YAAW,EAAE,cAAc,EAAE;QAC3B,OAAO;YACL;YACA;gBACE,4CAA4C;gBAC5C,OACE;gBACF,sBAAsB;YACxB;YACA;gBACE;gBACA,IAAA,oKAAe,EAAC,gBAAgB;oBAAE,OAAO;gBAAsB;aAChE;SACF;IACH;IACA;QACE,OAAO;YACL,UACE,CAAC,UACD,CAAC,EAAE,QAAQ,EAAO;oBAChB,OAAO,SAAS,aAAa,CAAC;wBAAE,MAAM,IAAI,CAAC,IAAI;wBAAE,OAAO;oBAAQ;gBAClE;QACJ;IACF;AACF;AAEA,MAAM,cAAc,yJAAU,CAAC,MAAM,CAAC;IACpC,MAAM;IACN,OAAO;IACP,MAAM;IACN;QACE,OAAO;YAAE,KAAK;gBAAE,SAAS;YAAK;YAAG,UAAU;gBAAE,SAAS;YAAK;QAAE;IAC/D;IACA;QACE,OAAO;YAAC;gBAAE,KAAK;YAAa;SAAE;IAChC;IACA,YAAW,EAAE,cAAc,EAAE;QAC3B,OAAO;YACL;YACA;gBACE,8EAA8E;gBAC9E,OACE;gBACF,sBAAsB;YACxB;YACA;gBAAC;gBAAS,IAAA,oKAAe,EAAC,gBAAgB;oBAAE,OAAO;gBAAS;aAAG;SAChE;IACH;IACA;QACE,OAAO;YACL,UACE,CAAC,UACD,CAAC,EAAE,QAAQ,EAAO;oBAChB,OAAO,SAAS,aAAa,CAAC;wBAAE,MAAM,IAAI,CAAC,IAAI;wBAAE,OAAO;oBAAQ;gBAClE;QACJ;IACF;AACF;AAEA,6BAA6B;AAC7B,MAAM,aAAa,yJAAU,CAAC,MAAM,CAAC;IACnC,MAAM;IACN,OAAO;IACP,MAAM;IACN;QACE,OAAO;YACL,KAAK;gBAAE,SAAS;YAAK;YACrB,MAAM;gBAAE,SAAS;YAAa;QAChC;IACF;IACA;QACE,OAAO;YAAC;gBAAE,KAAK;YAA4B;SAAE;IAC/C;IACA,YAAW,EAAE,cAAc,EAAE;QAC3B,OAAO;YACL;YACA;gBACE,2BAA2B;gBAC3B,OAAO;gBACP,sBAAsB;gBACtB,wBAAwB;YAC1B;YACA;gBACE;gBACA;oBACE,MAAM,eAAe,GAAG;oBACxB,QAAQ;oBACR,KAAK;oBACL,OACE;gBACJ;gBACA,WAAW;gBACX;oBACE;oBACA;wBACE,OACE;oBACJ;oBACA;wBACE;wBACA;4BACE,OAAO;4BACP,OAAO;4BACP,QAAQ;4BACR,SAAS;4BACT,MAAM;4BACN,QAAQ;4BACR,gBAAgB;4BAChB,kBAAkB;4BAClB,mBAAmB;wBACrB;wBACA;4BACE;4BACA;gCACE,GAAG;4BACL;yBACD;wBACD;4BAAC;4BAAY;gCAAE,QAAQ;4BAAiB;yBAAE;qBAC3C;iBACF;gBACD;oBACE;oBACA;wBAAE,OAAO;oBAAgC;oBACzC;wBACE;wBACA;4BACE,OACE;wBACJ;wBACA,eAAe,IAAI;qBACpB;oBACD;wBACE;wBACA;4BAAE,OAAO;wBAAsC;wBAC/C;qBACD;iBACF;aACF;SACF;IACH;IACA;QACE,OAAO;YACL,SACE,CAAC,UACD,CAAC,EAAE,QAAQ,EAAO;oBAChB,OAAO,SAAS,aAAa,CAAC;wBAAE,MAAM,IAAI,CAAC,IAAI;wBAAE,OAAO;oBAAQ;gBAClE;QACJ;IACF;AACF;AAEA,2BAA2B;AAC3B,SAAS,iBAAiB,EACxB,cAAc,EACd,KAAK,EAIN;IACC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAC;IACzC,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IAEjD,MAAM,eAAe,CAAC;QACpB,EAAE,cAAc;QAChB,eAAe;IACjB;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC,0MAAI;gBAAC,WAAU;;;;;;0BAChB,8OAAC;gBAAG,WAAU;0BAA6B;;;;;;0BAC3C,8OAAC;gBAAE,WAAU;0BAAmB;;;;;;0BAGhC,8OAAC;gBAAK,UAAU;gBAAc,WAAU;;kCACtC,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCACC,IAAG;gCACH,MAAM,eAAe,SAAS;gCAC9B,OAAO;gCACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;gCAC3C,cAAa;gCACb,MAAK;gCACL,WAAU;gCACV,SAAS;;;;;;0CAEX,8OAAC;gCACC,MAAK;gCACL,SAAS,IAAM,gBAAgB,CAAC;gCAChC,WAAU;0CAET,6BACC,8OAAC,oNAAM;oCAAC,WAAU;;;;;yDAElB,8OAAC,uMAAG;oCAAC,WAAU;;;;;;;;;;;;;;;;;oBAIpB,uBAAS,8OAAC;wBAAE,WAAU;kCAA6B;;;;;;kCACpD,8OAAC;wBACC,MAAK;wBACL,WAAU;kCACX;;;;;;;;;;;;;;;;;;AAMT;AAEA,mCAAmC;AACnC,MAAM,iBAAiB,iMAAQ,CAAC,MAAM,CAAC;IACrC;QACE,OAAO;YACL,OAAO;gBACL,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,MAAM;gBAC7B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS;gBACjC,IACE,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,cAC3B,MAAM,MAAM,CAAC,OAAO,CAAC,IAAI,KAAK,GAC9B;oBACA,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAC;gBAC3C;gBACA,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,aAAa,CAAC;YAC5C;YACA,WAAW,CAAC;gBACV,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,CAAC,MAAM;gBAC7B,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS;gBACjC,IACE,MAAM,MAAM,CAAC,IAAI,CAAC,IAAI,KAAK,cAC3B,MAAM,MAAM,CAAC,OAAO,CAAC,IAAI,KAAK,KAC9B,MAAM,YAAY,KAAK,GACvB;oBACA,OAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,YAAY,CAAC;gBAC3C;gBACA,OAAO,IAAI,CAAC,MAAM,MAAM,YAAY;YACtC;QACF;IACF;AACF;AAEA,MAAM,iBAAiB,iMAAQ,CAAC,MAAM,CAAC;IACrC,SAAS;AACX;AAGO,SAAS,WAAW,EACzB,YAAY,EACZ,eAAe,EAIhB;IACC,MAAM,EAAE,KAAK,EAAE,UAAU,EAAE,QAAQ,EAAE,UAAU,EAAE,UAAU,EAAE,GAAG,IAAA,wIAAQ;IACxE,MAAM,EAAE,QAAQ,EAAE,GAAG,IAAA,+IAAe;IAEpC,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IACvD,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAAC;IACnD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC;IACrD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IACvD,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IACvD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAC;IACrD,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,iNAAQ,EAAC;IACzD,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAc;IAC1D,MAAM,CAAC,yBAAyB,2BAA2B,GAAG,IAAA,iNAAQ,EAAC;IACvE,MAAM,CAAC,yBAAyB,2BAA2B,GAAG,IAAA,iNAAQ,EAAC;IACvE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAgB;IAEtE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,iNAAQ,EAChD;IAEF,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,iNAAQ,EAAC;IAC7C,MAAM,gBAAgB,IAAA,+MAAM,EAA0B;IACtD,MAAM,cAAc,IAAA,+MAAM,EAA0B;IACpD,MAAM,mBAAmB,IAAA,+MAAM,EAAiB;IAChD,MAAM,gBAAgB,IAAA,+MAAM,EAAC;IAE7B,sBAAsB;IACtB,MAAM,mBAAmB,IAAA,+MAAM,EAAwB;IACvD,MAAM,gBAAgB,IAAA,+MAAM,EAAuB;IACnD,MAAM,kBAAkB,IAAA,+MAAM,EAAgB;IAC9C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,iNAAQ,EAAC;IAEvD,MAAM,GAAG,iBAAiB,GAAG,IAAA,iNAAQ,EAAC,CAAC;IAEvC,MAAM,gBAAgB,IAAA,gNAAO,EAAC;QAC5B,IAAI,CAAC,YAAY,OAAO;QACxB,IAAI,CAAC,OAAO,OAAO,EAAE;QACrB,MAAM,YAAY,WAAW,WAAW;QACxC,OAAO,MACJ,MAAM,CACL,CAAC,OACC,KAAK,KAAK,CAAC,WAAW,GAAG,QAAQ,CAAC,cAClC,CAAC,KAAK,OAAO,IAAI,EAAE,EAAE,WAAW,GAAG,QAAQ,CAAC,YAE/C,GAAG,CAAC,CAAC,OAAS,CAAC;gBACd,IAAI,KAAK,EAAE;gBACX,OAAO,KAAK,KAAK,IAAI;gBACrB,SAAS,WAAW,KAAK,OAAO,IAAI,IAAI;YAC1C,CAAC;IACL,GAAG;QAAC;QAAY;KAAM;IAEtB,MAAM,SAAS,IAAA,+KAAS,EAAC;QACvB,YAAY;YACV,6KAAQ;YACR,8KAAS;YACT,yKAAI;YACJ,yKAAI;YACJ,2KAAM;YACN,2KAAM;YACN,4KAAO,CAAC,SAAS,CAAC;gBAAE,QAAQ;oBAAC;oBAAG;oBAAG;iBAAE;YAAC;YACtC,mMAAU;YACV,oMAAW;YACX;YACA,4LAAO;YACP,+LAAU;YACV,8LAAS;YACT,kLAAS;YACT,uLAAc;YACd,gMAAW,CAAC,SAAS,CAAC;gBAAE,aAAa;YAAmB;YACxD,iMAAQ;YACR,eAAe,SAAS,CAAC;gBAAE,QAAQ;YAAK;YACxC,yKAAI,CAAC,SAAS,CAAC;gBAAE,aAAa;gBAAM,UAAU;YAAK;YACnD,0CAA0C;YAC1C,0KAAK,CAAC,SAAS,CAAC;gBACd,QAAQ;gBACR,aAAa;gBACb,gBAAgB;oBACd,OACE;gBACJ;YACF;YACA;YACA;YACA;SACD;QACD,SAAS;QACT,eAAe;YACb,iBAAiB,CAAC;QACpB;QACA,UAAU,CAAC,EAAE,MAAM,EAAE;YACnB,kBAAkB,OAAO,OAAO;QAClC;QACA,UAAU;QACV,aAAa;YACX,YAAY;gBACV,oGAAoG;gBACpG,4CAA4C;gBAC5C,OACE;YACJ;QACF;QACA,mBAAmB;IACrB;IAEA,+BAA+B;IAE/B,IAAA,kNAAS,EAAC;QACR,IAAI,OAAO,aAAa,aAAa;YACnC,MAAM,YAAY,SAAS,aAAa,CAAC;YACzC,UAAU,YAAY,CAAC,mBAAmB;YAC1C,iBAAiB,OAAO,GAAG;YAC3B,SAAS,IAAI,CAAC,WAAW,CAAC;YAE1B,cAAc,OAAO,GAAG,IAAA,8JAAK,EAAC,SAAS,IAAI,EAAE;gBAC3C,SAAS;gBACT,SAAS;gBACT,aAAa;gBACb,WAAW;gBACX,UAAU,SAAS,IAAI;gBACvB,WAAW;gBACX,QAAQ;gBACR,OAAO;gBACP,QAAQ;oBAAC;oBAAG;iBAAG;YACjB;YAEA,OAAO;gBACL,cAAc,OAAO,EAAE;gBACvB,IAAI,iBAAiB,OAAO,EAAE,YAAY;oBACxC,iBAAiB,OAAO,CAAC,UAAU,CAAC,WAAW,CAC7C,iBAAiB,OAAO;gBAE5B;YACF;QACF;IACF,GAAG,EAAE;IAEL,MAAM,eAAe,IAAA,oNAAW,EAAC;QAC/B,IAAI,CAAC,UAAU,CAAC,cAAc,OAAO,EAAE;QACvC,MAAM,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG;QACxB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS;QAChC,MAAM,OAAO,MAAM,GAAG,CAAC,MAAM,CAAC;QAE9B,MAAM,UACJ,CAAC,CAAC,QACF,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,WAClB,KAAK,IAAI,CAAC,IAAI,KAAK,WACnB,KAAK,IAAI,CAAC,IAAI,KAAK,WACnB,KAAK,IAAI,CAAC,IAAI,KAAK,MAAM;QAE7B,IAAI,CAAC,SAAS;YACZ,cAAc,OAAO,CAAC,IAAI;YAC1B;QACF;QAEA,MAAM,UAAU,KAAK,OAAO,CAAC;QAC7B,IAAI,gBAAgB;QAEpB,kBAAkB;QAClB,IACE,KAAK,IAAI,CAAC,IAAI,KAAK,WACnB,KAAK,IAAI,CAAC,IAAI,KAAK,WACnB,KAAK,IAAI,CAAC,IAAI,KAAK,QACnB;YACA,IAAI,WAAW,CAAC,qBAAqB,EAAE,KAAK,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,KAAK,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC;YAChF,IAAI,KAAK,IAAI,CAAC,IAAI,KAAK,QAAQ,WAAW,CAAC,sBAAsB,CAAC;YAElE,MAAM,UAAU,KAAK,GAAG,CAAC,aAAa,CAAC,WAAW,QAAQ;YAE1D,IAAI,SAAS;gBACX,gBAAgB;YAClB,OAAO,IAAI,WAAW,QAAQ,SAAS,CAAC,QAAQ,CAAC,eAAe;gBAC9D,gBAAgB;YAClB;QACF;QAEA,IAAI;QACJ,IAAI,iBAAiB,cAAc,qBAAqB,EAAE;YACxD,OAAO,cAAc,qBAAqB;QAC5C,OAAO;YACL,MAAM,SAAS,KAAK,WAAW,CAAC;YAChC,OAAO;gBACL,OAAO;gBACP,QAAQ;gBACR,KAAK,OAAO,GAAG;gBACf,QAAQ,OAAO,MAAM;gBACrB,MAAM,OAAO,IAAI;gBACjB,OAAO,OAAO,KAAK;YACrB;QACF;QAEA,cAAc,OAAO,CAAC,QAAQ,CAAC;YAC7B,wBAAwB,IAAM;QAChC;QACA,cAAc,OAAO,CAAC,IAAI;IAC5B,GAAG;QAAC;KAAO;IAEX,+BAA+B;IAC/B,2DAA2D;IAC3D,0DAA0D;IAC1D,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,QAAQ;QACb,MAAM,MAAM,OAAO,IAAI,CAAC,GAAG;QAE3B,MAAM,eAAe,CAAC;YACpB,MAAM,SAAS,EAAE,MAAM;YACvB,MAAM,QAAQ,OAAO,OAAO,KAAK;YACjC,MAAM,eAAe,OAAO,OAAO,CAAC;YAEpC,6BAA6B;YAC7B,MAAM,aACJ,OAAO,OAAO,KAAK,WACnB,OAAO,OAAO,KAAK,WACnB,OAAO,OAAO,KAAK,WACnB,OAAO,SAAS,CAAC,QAAQ,CAAC;YAE5B,MAAM,eAAe,SAAU,gBAAgB,CAAC;YAEhD,IAAI,gBAAgB,YAAY;gBAC9B,sEAAsE;gBACtE;YACF;YAEA,IAAI,cAAc;gBAChB,WAAW;oBACT,MAAM,EAAE,IAAI,EAAE,GAAG,OAAO,KAAK,CAAC,SAAS;oBACvC,MAAM,eAAe,gBAAgB,OAAO,KAAK;oBAEjD,IAAI,cAAc;wBAChB,aAAa;wBACb,MAAM,OAAO,OAAO,KAAK,CAAC,GAAG,CAAC,MAAM,CAAC;wBACrC,IAAI,MAAM;4BACR,MAAM,WAAW,OAAO,KAAK,QAAQ;4BACrC,OAAO,KAAK,GAAG,KAAK,GAAG,gBAAgB,CAAC,UAAU,GAAG;4BACrD,cAAc,OAAO,EAAE;4BACvB,gBAAgB,OAAO,GAAG;wBAC5B;oBACF,OAAO;wBACL,SAAS;wBACT;wBACA,gBAAgB,OAAO,GAAG;oBAC5B;gBACF,GAAG;YACL,OAAO;gBACL,cAAc,OAAO,EAAE;gBACvB,gBAAgB,OAAO,GAAG;YAC5B;QACF;QAEA,IAAI,gBAAgB,CAAC,SAAS;QAC9B,MAAM,gBAAgB;YACpB,cAAc,OAAO,EAAE;QACzB;QACA,OAAO,gBAAgB,CAAC,UAAU,eAAe;QAEjD,OAAO;YACL,IAAI,mBAAmB,CAAC,SAAS;YACjC,OAAO,mBAAmB,CAAC,UAAU,eAAe;QACtD;IACF,GAAG;QAAC;QAAQ;KAAa;IAEzB,MAAM,sBAAsB,IAAA,oNAAW,EAAC;QACtC,IAAI,CAAC,QAAQ;QACb,mBAAmB;QACnB,MAAM,EAAE,KAAK,EAAE,GAAG;QAClB,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,SAAS;QAChC,MAAM,OAAO,MAAM,GAAG,CAAC,MAAM,CAAC;QAE9B,IACE,QACA,CAAC,KAAK,IAAI,CAAC,IAAI,KAAK,WAClB,KAAK,IAAI,CAAC,IAAI,KAAK,WACnB,KAAK,IAAI,CAAC,IAAI,KAAK,WACnB,KAAK,IAAI,CAAC,IAAI,KAAK,MAAM,GAC3B;YACA,MAAM,MAAM,KAAK,KAAK,CAAC,GAAG;YAC1B,IAAI,KAAK,MAAM,IAAA,0IAAY,EAAC;YAC5B,OAAO,KAAK,GAAG,KAAK,GAAG,eAAe,GAAG,GAAG;YAC5C,kBAAkB,OAAO,OAAO;YAEhC,cAAc,OAAO,EAAE;YACvB,gBAAgB,OAAO,GAAG;QAC5B;QACA,mBAAmB;IACrB,GAAG;QAAC;KAAO;IAEX,mCAAmC;IAEnC,IAAA,kNAAS,EAAC;QACR,SAAS,mBAAmB,KAAiB;YAC3C,IACE,iBAAiB,OAAO,IACxB,CAAC,iBAAiB,OAAO,CAAC,QAAQ,CAAC,MAAM,MAAM,GAC/C;gBACA,cAAc;YAChB;QACF;QACA,SAAS,gBAAgB,CAAC,aAAa;QACvC,OAAO;YACL,SAAS,mBAAmB,CAAC,aAAa;QAC5C;IACF,GAAG,EAAE;IAEL,IAAA,kNAAS,EAAC;QACR,IAAI,CAAC,cAAc;YACjB,QAAQ,YAAY;YACpB,QAAQ,SAAS;YACjB,SAAS;YACT,iBAAiB;YACjB,kBAAkB;YAClB,mBAAmB;YACnB,cAAc;YACd,mBAAmB;YACnB,aAAa;YACb,cAAc,OAAO,GAAG;YACxB;QACF;QACA,MAAM,WAAW;YACf,cAAc,OAAO,GAAG;YACxB,MAAM,OAAO,MAAM,uIAAE,CAAC,KAAK,CAAC,GAAG,CAAC;YAChC,IAAI,MAAM;gBACR,cAAc;gBACd,aAAa;gBAEb,IAAI,KAAK,QAAQ,IAAI,CAAC,iBAAiB;oBACrC,QAAQ,SAAS;oBACjB,QAAQ,YAAY;gBACtB,OAAO;oBACL,QAAQ,SAAS,WAAW,KAAK,OAAO,EAAE;wBAAE,YAAY;oBAAM;oBAC9D,QAAQ,YAAY;gBACtB;gBAEA,SAAS,KAAK,KAAK;gBACnB,kBAAkB,KAAK,OAAO;gBAC9B,iBAAiB,KAAK,KAAK;gBAC3B,mBAAmB,KAAK,OAAO;gBAE/B,WAAW;oBACT,cAAc,OAAO,GAAG;gBAC1B,GAAG;YACL;QACF;QACA;IACF,GAAG;QAAC;QAAc;QAAQ;KAAgB;IAE1C,MAAM,aAAa,IAAA,gNAAO,EAAC;QACzB,IAAI,CAAC,gBAAgB,CAAC,YAAY,OAAO;QACzC,IAAI,WAAW,QAAQ,IAAI,CAAC,iBAAiB,OAAO;QACpD,OAAO,UAAU,iBAAiB,mBAAmB;IACvD,GAAG;QACD;QACA;QACA;QACA;QACA;QACA;QACA;KACD;IAED,MAAM,iBAAiB,YAAY,OAAO;IAC1C,MAAM,mBAAmB,YAAY,gBAAgB;IAErD,IAAA,kNAAS,EAAC;QACR,IAAI,cAAc,OAAO,IAAI,CAAC,gBAAgB,CAAC,QAAQ,YAAY;YACjE;QACF;QACA,IACE,mBAAmB,iBACnB,qBAAqB,iBACrB;YACA,QAAQ,GAAG,CAAC;YACZ,WAAW,cAAc;gBACvB,SAAS;gBACT,OAAO;YACT;YACA,iBAAiB;YACjB,mBAAmB;QACrB;IACF,GAAG;QACD;QACA;QACA;QACA,QAAQ;QACR;QACA;QACA;KACD;IAED,MAAM,aAAa;QACjB,IAAI,CAAC,UAAU,CAAC,gBAAgB,CAAC,YAAY;QAC7C,WAAW,cAAc;YACvB,SAAS;YACT,OAAO;QACT;QACA,iBAAiB;QACjB,mBAAmB;IACrB;IAEA,MAAM,mBAAmB,OAAO;QAC9B,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,QAAQ;QACxC,eAAe;QACf,MAAM,gBAAgB,MAAM,IAAI,CAAC;QACjC,IAAI;YACF,KAAK,MAAM,QAAQ,cAAe;gBAChC,MAAM,aAAa,MAAM,IAAA,sIAAU,EAAC,MAAM;gBAC1C,MAAM,MAAM,WAAW,GAAG;gBAC1B,MAAM,WAAW,KAAK,IAAI,CAAC,WAAW;gBACtC,MAAM,WAAW,KAAK,IAAI;gBAC1B,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,QAAQ,CAAC,WAClB,SAAS,QAAQ,CAAC,WAClB,SAAS,QAAQ,CAAC,YAClB,SAAS,QAAQ,CAAC,WAClB,SAAS,QAAQ,CAAC,SAClB;oBACA,OAAO,KAAK,GAAG,KAAK,GAAG,QAAQ,CAAC;wBAAE,KAAK;wBAAK,KAAK;oBAAS,GAAG,GAAG;gBAClE,OAAO,IACL,SAAS,UAAU,CAAC,aACpB,SAAS,QAAQ,CAAC,WAClB,SAAS,QAAQ,CAAC,YAClB,SAAS,QAAQ,CAAC,SAClB;oBACA,OAAO,KAAK,GAAG,KAAK,GAAG,QAAQ,CAAC;wBAAE,KAAK;oBAAI,GAAG,GAAG;gBACnD,OAAO,IACL,SAAS,UAAU,CAAC,aACpB,SAAS,QAAQ,CAAC,WAClB,SAAS,QAAQ,CAAC,WAClB,SAAS,QAAQ,CAAC,SAClB;oBACA,OAAO,KAAK,GAAG,KAAK,GAAG,QAAQ,CAAC;wBAAE,KAAK;oBAAI,GAAG,GAAG;gBACnD,OAAO;oBACL,OAAO,KAAK,GAAG,KAAK,GAAG,OAAO,CAAC;wBAAE,KAAK;wBAAK,MAAM,KAAK,IAAI;oBAAC,GAAG,GAAG;gBACnE;YACF;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;QACA,eAAe;IACjB;IAEA,MAAM,gBAAgB,IAAA,oNAAW,EAAC;QAChC,IAAI,CAAC,QAAQ;QACb,MAAM,EAAE,IAAI,EAAE,EAAE,EAAE,GAAG,OAAO,KAAK,CAAC,SAAS;QAC3C,MAAM,eAAe,OAAO,KAAK,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,IAAI;QAC5D,mBAAmB;QACnB,kBAAkB,OAAO,aAAa,CAAC,QAAQ,IAAI,IAAI;QACvD,mBAAmB;IACrB,GAAG;QAAC;KAAO;IAEX,MAAM,qBAAqB,CAAC;QAC1B,IAAI,EAAE,GAAG,KAAK,SAAS;YACrB,EAAE,cAAc;YAChB,QAAQ,SAAS;QACnB;IACF;IAEA,MAAM,mBAAmB;QACvB,IAAI,CAAC,cAAc;QACnB,WAAW;QACX,gBAAgB;IAClB;IAEA,MAAM,kBAAkB,CAAC;QACvB,mBAAmB;QACnB,2BAA2B;QAC3B,aAAa;QACb,IAAI,kBAAkB,QAAQ;QAC9B,IAAI,kBAAkB,UAAU;QAChC,iBAAiB;IACnB;IACA,MAAM,kBAAkB,CAAC;QACvB,mBAAmB;QACnB,2BAA2B;QAC3B,IAAI,UAAU;YACZ,uIAAE,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,MAAM,EAAE;gBAAE,kBAAkB;YAAK;QACnE;QACA,IAAI,kBAAkB,QAAQ;QAC9B,iBAAiB;IACnB;IACA,MAAM,cAAc;QAClB,IAAI,CAAC,YAAY;QACjB,IAAI,YAAY;QAChB,SAAS,WAAW,EAAE;QACtB,cAAc;YAAE,GAAG,UAAU;YAAE,UAAU;QAAK;QAC9C,QAAQ,SAAS;QACjB,QAAQ,YAAY;QACpB,mBAAmB;IACrB;IACA,MAAM,gBAAgB;QACpB,IAAI,CAAC,YAAY;QACjB,WAAW,WAAW,EAAE;QACxB,cAAc;YAAE,GAAG,UAAU;YAAE,UAAU;QAAM;QAC/C,QAAQ,SAAS,WAAW,iBAAiB;YAAE,YAAY;QAAM;QACjE,QAAQ,YAAY;IACtB;IAEA,MAAM,mBAAmB;QACvB,IAAI,CAAC,YAAY;QACjB,aAAa;QACb,IAAI,WAAW,QAAQ,EAAE;YACvB,iBAAiB;YACjB,2BAA2B;QAC7B,OAAO;YACL,iBAAiB;YACjB,IAAI,UAAU,kBAAkB;gBAC9B;YACF,OAAO;gBACL,2BAA2B;YAC7B;QACF;IACF;IAEA,MAAM,qBAAqB,OAAO;QAChC,aAAa;QACb,IAAI,CAAC,UAAU;YACb,aAAa;YACb;QACF;QACA,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,uBAAuB;gBAC7C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE,QAAQ;oBAAU;gBAAS;YACpD;YACA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,aAAa;YACf,OAAO;gBACL,mBAAmB;YACrB;QACF,EAAE,OAAM;YACN,aAAa;QACf;IACF;IAEA,MAAM,0BAA0B,CAAC;QAC/B,gBAAgB;QAChB,cAAc;IAChB;IAEA,MAAM,uBAAuB,CAAC;QAC5B,IAAI,CAAC,UAAU,CAAC,OAAO,UAAU,EAAE;QACnC,MAAM,WAAW,OAAO,IAAI,CAAC,GAAG;QAChC,MAAM,UAAU,EAAE,aAAa,CAAC,aAAa,CAC3C;QAEF,IACE,SAAS,QAAQ,CAAC,EAAE,MAAM,KAC1B,SAAS,SAAS,EAAE,MAAM,GAC1B;YACA;QACF;QACA,OACG,KAAK,GACL,KAAK,GACL,gBAAgB,CAAC,OAAO,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,IAAI,EAC9C,GAAG;IACR;IAEA,MAAM,6BACJ,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YACC,SAAS;YACT,WAAU;;gBAET,gCACC,8OAAC,4NAAO;oBAAC,MAAM;oBAAI,WAAU;;;;;yCAE7B,8OAAC,oNAAM;oBAAC,MAAM;;;;;;8BAEhB,8OAAC;8BAAK;;;;;;;;;;;;;;;;;IAKZ,qBACE,8OAAC,+KAAgB;QAAC,eAAe;;0BAC/B,8OAAC;gBAAI,WAAU;;kCAEb,8OAAC;wBACC,WAAU;wBACV,KAAK;;0CAEL,8OAAC,2KAAY;;kDACX,8OAAC,8KAAe;wCAAC,OAAO;kDACtB,cAAA,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;8DACb,cAAA,8OAAC,gNAAU;wDAAC,WAAU;;;;;;;;;;;8DAExB,8OAAC;oDACC,MAAK;oDACL,aAAY;oDACZ,WAAU;oDACV,OAAO;oDACP,UAAU,CAAC,IAAM,cAAc,EAAE,MAAM,CAAC,KAAK;;;;;;;;;;;;;;;;;kDAInD,8OAAC,6KAAc;kDACb,cAAA,8OAAC,8KAAe;4CACd,WAAU;4CACV,YAAY;;gDACb;8DAEC,8OAAC,4KAAa;oDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;4BAK9B,+BACC,8OAAC;gCAAI,WAAU;0CACZ,cAAc,MAAM,KAAK,kBACxB,8OAAC;oCAAE,WAAU;8CAA4B;;;;;yDAEzC,8OAAC;8CACE,cAAc,GAAG,CAAC,CAAC,qBAClB,8OAAC;sDACC,cAAA,8OAAC;gDACC,SAAS,IAAM,wBAAwB,KAAK,EAAE;gDAC9C,WAAU;;kEAEV,8OAAC,0NAAQ;wDAAC,WAAU;;;;;;kEACpB,8OAAC;wDAAI,WAAU;;0EACb,8OAAC;gEAAE,WAAU;0EACV,KAAK,KAAK;;;;;;0EAEb,8OAAC;gEACC,WAAU;gEACV,yBAAyB;oEAAE,QAAQ,KAAK,OAAO;gEAAC;;;;;;;;;;;;;;;;;;2CAZ/C,KAAK,EAAE;;;;;;;;;;;;;;;;;;;;;kCAyB5B,8OAAC,oJAAa;wBACZ,QAAQ;wBACR,eAAe;wBACf,aAAa;wBACb,WAAW;wBACX,oBAAoB,IAAM,oBAAoB;wBAC9C,UAAU,YAAY,YAAY;wBAClC,cAAc;wBACd,cAAc;;;;;;oBAIf,CAAC,gBAAgB,CAAC,2BACjB,8OAAC;wBACC,WAAU;wBACV,SAAS;kCACV;;;;;+BAGC,WAAW,QAAQ,IAAI,CAAC,gCAC1B,8OAAC;wBACC,gBAAgB;wBAChB,OAAO;;;;;6CAGT;;4BACG,6BACC,8OAAC;gCAAI,WAAU;;kDACb,8OAAC,4NAAO;wCAAC,WAAU;;;;;;kDACnB,8OAAC;kDAAK;;;;;;;;;;;;0CAIV,8OAAC;gCACC,WAAU;gCACV,SAAS;;kDAET,8OAAC;wCACC,MAAK;wCACL,OAAO;wCACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wCACxC,WAAW;wCACX,aAAY;wCACZ,WAAU;wCACV,UAAU,CAAC,QAAQ;;;;;;kDAErB,8OAAC,mLAAa;wCAAC,QAAQ;;;;;;;;;;;;4BAExB,4BACC,8OAAC,2KAAY;;kDACX,8OAAC,8KAAe;wCAAC,OAAO;kDACtB,cAAA,8OAAC;4CACC,SAAS;4CACT,WAAU;;8DAEV,8OAAC,0MAAI;oDAAC,WAAU;;;;;;gDAAY;;;;;;;;;;;;kDAIhC,8OAAC,6KAAc;kDACb,cAAA,8OAAC,8KAAe;4CACd,WAAU;4CACV,YAAY;;gDACb;8DAEC,8OAAC,4KAAa;oDAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;;;;oBASpC,iCACC,8OAAC;wBACC,QAAQ;wBACR,SAAS,IAAM,mBAAmB;wBAClC,aAAa;wBACb,YAAY;;;;;;oBAGf,kCACC,8OAAC,oJAAa;wBACZ,SAAS,IAAM,oBAAoB;wBACnC,OAAO,CAAC,OAAS,iBAAiB;gCAAC;6BAAK;;;;;;oBAG3C,yCACC,8OAAC,mKAAuB;wBACtB,SAAS;4BACP,2BAA2B;4BAC3B,iBAAiB;wBACnB;wBACA,WAAW;;;;;;oBAGd,yCACC,8OAAC,mKAAuB;wBACtB,SAAS;4BACP,2BAA2B;4BAC3B,iBAAiB;wBACnB;wBACA,WAAW;;;;;;kCAIf,8OAAC;wBACC,MAAK;wBACL,KAAK;wBACL,UAAU,CAAC;4BACT,iBAAiB,EAAE,MAAM,CAAC,KAAK;4BAC/B,EAAE,MAAM,CAAC,KAAK,GAAG;wBACnB;wBACA,WAAU;wBACV,QAAQ;wBACR,QAAO;;;;;;kCAET,8OAAC;wBACC,MAAK;wBACL,KAAK;wBACL,UAAU,CAAC;4BACT,iBAAiB,EAAE,MAAM,CAAC,KAAK;4BAC/B,EAAE,MAAM,CAAC,KAAK,GAAG;wBACnB;wBACA,WAAU;wBACV,QAAQ;wBACR,QAAO;;;;;;;;;;;;YAKV,iBAAiB,OAAO,kBACvB,IAAA,4NAAY,EAAC,cAAc,iBAAiB,OAAO;;;;;;;AAG3D","debugId":null}},
    {"offset": {"line": 5479, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/app/app/notes/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useRef, useState } from \"react\";\nimport {\n  Panel,\n  PanelGroup,\n  PanelResizeHandle,\n  type ImperativePanelHandle,\n} from \"react-resizable-panels\";\nimport { NotesSidebar } from \"@/components/NotesSidebar\";\nimport { NoteList } from \"@/components/NoteList\";\nimport { NoteEditor } from \"@/components/NoteEditor\";\n\nexport default function NotesPage() {\n  const sidebarPanelRef = useRef<ImperativePanelHandle>(null);\n  const [isSidebarCollapsed, setIsSidebarCollapsed] = useState(false);\n  const [selectedView, setSelectedView] = useState(\"all\");\n  const [activeNoteId, setActiveNoteId] = useState<string | null>(null);\n\n  const toggleSidebar = () => {\n    const panel = sidebarPanelRef.current;\n    if (panel) {\n      if (panel.isCollapsed()) {\n        panel.expand();\n      } else {\n        panel.collapse();\n      }\n    }\n  };\n\n  return (\n    // [FIX] Removed 'rounded-lg' from this container div\n    <div\n      className=\"flex overflow-hidden bg-white text-black fixed top-[60px] left-0 right-0 bottom-0 z-40 \n                 border-t border-gray-200 shadow-sm\"\n    >\n      <PanelGroup\n        direction=\"horizontal\"\n        // 'overflow-hidden' here clips the corners\n        className=\"overflow-hidden\"\n      >\n        {/* Pane 1: Folder Sidebar */}\n        <Panel\n          ref={sidebarPanelRef}\n          collapsible={true}\n          defaultSize={20}\n          minSize={15}\n          maxSize={30}\n          // [FIX] 'rounded-tl-lg' gives you the top-left curve\n          className=\"h-full box-border bg-gray-50 rounded-tl-lg\"\n          onCollapse={() => setIsSidebarCollapsed(true)}\n          onExpand={() => setIsSidebarCollapsed(false)}\n        >\n          <NotesSidebar\n            isCollapsed={isSidebarCollapsed}\n            onToggleClick={toggleSidebar}\n            selectedView={selectedView}\n            setSelectedView={setSelectedView}\n          />\n        </Panel>\n\n        {/* Resize Handle 1 */}\n        <PanelResizeHandle\n          className=\"w-px bg-gray-200 cursor-col-resize transition-colors \n                     data-[active=true]:bg-gray-800 data-[active=true]:w-[2px] \n                     hover:bg-gray-800 hover:w-[2px]\"\n        />\n\n        {/* Pane 2: Note List */}\n        <Panel\n          defaultSize={30}\n          minSize={20}\n          maxSize={40}\n          className=\"h-full box-border bg-gray-100\"\n        >\n          <NoteList\n            isSidebarCollapsed={isSidebarCollapsed}\n            onToggleSidebar={toggleSidebar}\n            selectedView={selectedView}\n            activeNoteId={activeNoteId}\n            setActiveNoteId={setActiveNoteId}\n          />\n        </Panel>\n\n        {/* Resize Handle 2 */}\n        <PanelResizeHandle\n          className=\"w-px bg-gray-200 cursor-col-resize transition-colors \n                     data-[active=true]:bg-gray-800 data-[active=true]:w-[2px] \n                     hover:bg-gray-800 hover:w-[2px]\"\n        />\n\n        {/* Pane 3: Editor */}\n        <Panel\n          defaultSize={50}\n          minSize={30}\n          // [FIX] 'rounded-tr-lg' gives you the top-right curve\n          className=\"h-full box-border bg-white rounded-tr-lg\"\n        >\n          <NoteEditor\n            activeNoteId={activeNoteId}\n            setActiveNoteId={setActiveNoteId}\n          />\n        </Panel>\n      </PanelGroup>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAMA;AACA;AACA;AAXA;;;;;;;AAae,SAAS;IACtB,MAAM,kBAAkB,IAAA,+MAAM,EAAwB;IACtD,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,iNAAQ,EAAC;IAC7D,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAgB;IAEhE,MAAM,gBAAgB;QACpB,MAAM,QAAQ,gBAAgB,OAAO;QACrC,IAAI,OAAO;YACT,IAAI,MAAM,WAAW,IAAI;gBACvB,MAAM,MAAM;YACd,OAAO;gBACL,MAAM,QAAQ;YAChB;QACF;IACF;IAEA,OACE,qDAAqD;kBACrD,8OAAC;QACC,WAAU;kBAGV,cAAA,8OAAC,kOAAU;YACT,WAAU;YACV,2CAA2C;YAC3C,WAAU;;8BAGV,8OAAC,6NAAK;oBACJ,KAAK;oBACL,aAAa;oBACb,aAAa;oBACb,SAAS;oBACT,SAAS;oBACT,qDAAqD;oBACrD,WAAU;oBACV,YAAY,IAAM,sBAAsB;oBACxC,UAAU,IAAM,sBAAsB;8BAEtC,cAAA,8OAAC,kJAAY;wBACX,aAAa;wBACb,eAAe;wBACf,cAAc;wBACd,iBAAiB;;;;;;;;;;;8BAKrB,8OAAC,yOAAiB;oBAChB,WAAU;;;;;;8BAMZ,8OAAC,6NAAK;oBACJ,aAAa;oBACb,SAAS;oBACT,SAAS;oBACT,WAAU;8BAEV,cAAA,8OAAC,0IAAQ;wBACP,oBAAoB;wBACpB,iBAAiB;wBACjB,cAAc;wBACd,cAAc;wBACd,iBAAiB;;;;;;;;;;;8BAKrB,8OAAC,yOAAiB;oBAChB,WAAU;;;;;;8BAMZ,8OAAC,6NAAK;oBACJ,aAAa;oBACb,SAAS;oBACT,sDAAsD;oBACtD,WAAU;8BAEV,cAAA,8OAAC,8IAAU;wBACT,cAAc;wBACd,iBAAiB;;;;;;;;;;;;;;;;;;;;;;AAM7B","debugId":null}}]
}