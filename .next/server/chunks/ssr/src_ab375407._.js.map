{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/db/useDiary.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport db, { DiaryEntry, OperationType, EntityType } from \"./clientDb\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { format } from \"date-fns\";\nimport { useTier } from \"./useTier\";\nimport { triggerSync } from \"../sync/syncService\"; // âœ… 1. Import the trigger\n\nexport function useDiary() {\n  const [entries, setEntries] = useState<DiaryEntry[]>([]);\n  const tier = useTier();\n  const canSync = !!tier;\n  // Load diary entries from IndexedDB on mount\n  useEffect(() => {\n    const fetchEntries = async () => {\n      const allEntries = await db.diaryEntries.toArray();\n      const sorted = allEntries.sort(\n        (a, b) =>\n          new Date(b.entryDate).getTime() - new Date(a.entryDate).getTime()\n      );\n      setEntries(sorted);\n    };\n    fetchEntries();\n  }, []);\n\n  // Add or update today's entry\n  const saveTodayEntry = async (content: string) => {\n    const today = format(new Date(), \"yyyy-MM-dd\");\n    const existing = entries.find((entry) => entry.entryDate === today);\n    const now = Date.now();\n\n    if (existing) {\n      // Update existing\n      await db.diaryEntries.update(existing.id, { content, createdAt: now });\n      setEntries((prev) =>\n        prev.map((entry) =>\n          entry.id === existing.id\n            ? { ...entry, content, createdAt: now }\n            : entry\n        )\n      );\n\n      // Add to sync outbox if paid user\n      if (canSync) {\n        const updatedEntry = { ...existing, content, createdAt: now };\n        const syncOp = {\n          id: uuidv4(),\n          entityType: \"diary\" as EntityType,\n          operation: \"update\" as OperationType,\n          payload: updatedEntry,\n          timestamp: now,\n        };\n        await db.syncOutbox.add(syncOp);\n        console.log(\"ðŸ“¤ Added UPDATE diary entry to sync outbox\");\n        triggerSync(); // Poke the sync service\n      }\n    } else {\n      // Create new\n      const newEntry: DiaryEntry = {\n        id: uuidv4(),\n        entryDate: today,\n        content,\n        createdAt: now,\n      };\n      await db.diaryEntries.add(newEntry);\n      setEntries((prev) => [newEntry, ...prev]);\n\n      // Add to sync outbox if paid user\n      if (canSync) {\n        const syncOp = {\n          id: uuidv4(),\n          entityType: \"diary\" as EntityType,\n          operation: \"create\" as OperationType,\n          payload: newEntry,\n          timestamp: now,\n        };\n        await db.syncOutbox.add(syncOp);\n        console.log(\"ðŸ“¤ Added CREATE diary entry to sync outbox\");\n        triggerSync(); // Poke the sync service\n      }\n    }\n  };\n\n  // âœ… --- NEW FUNCTION: Delete Diary Entry ---\n  const deleteDiaryEntry = async (id: string) => {\n    await db.diaryEntries.delete(id);\n    setEntries((prev) => prev.filter((entry) => entry.id !== id));\n\n    if (canSync) {\n      const syncOp = {\n        id: uuidv4(),\n        entityType: \"diary\" as EntityType,\n        operation: \"delete\" as OperationType,\n        payload: { id }, // For a delete, we only need the ID\n        timestamp: Date.now(),\n      };\n      await db.syncOutbox.add(syncOp);\n      console.log(\"ðŸ“¤ Added DELETE diary entry to sync outbox\");\n      triggerSync();\n    }\n  };\n\n  return {\n    entries,\n    saveTodayEntry,\n    deleteDiaryEntry, // âœ… Export the new function\n  };\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA,iOAAmD,0BAA0B;AAP7E;;;;;;;AASO,SAAS;IACd,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAe,EAAE;IACvD,MAAM,OAAO,IAAA,sIAAO;IACpB,MAAM,UAAU,CAAC,CAAC;IAClB,6CAA6C;IAC7C,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe;YACnB,MAAM,aAAa,MAAM,uIAAE,CAAC,YAAY,CAAC,OAAO;YAChD,MAAM,SAAS,WAAW,IAAI,CAC5B,CAAC,GAAG,IACF,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;YAEnE,WAAW;QACb;QACA;IACF,GAAG,EAAE;IAEL,8BAA8B;IAC9B,MAAM,iBAAiB,OAAO;QAC5B,MAAM,QAAQ,IAAA,+JAAM,EAAC,IAAI,QAAQ;QACjC,MAAM,WAAW,QAAQ,IAAI,CAAC,CAAC,QAAU,MAAM,SAAS,KAAK;QAC7D,MAAM,MAAM,KAAK,GAAG;QAEpB,IAAI,UAAU;YACZ,kBAAkB;YAClB,MAAM,uIAAE,CAAC,YAAY,CAAC,MAAM,CAAC,SAAS,EAAE,EAAE;gBAAE;gBAAS,WAAW;YAAI;YACpE,WAAW,CAAC,OACV,KAAK,GAAG,CAAC,CAAC,QACR,MAAM,EAAE,KAAK,SAAS,EAAE,GACpB;wBAAE,GAAG,KAAK;wBAAE;wBAAS,WAAW;oBAAI,IACpC;YAIR,kCAAkC;YAClC,IAAI,SAAS;gBACX,MAAM,eAAe;oBAAE,GAAG,QAAQ;oBAAE;oBAAS,WAAW;gBAAI;gBAC5D,MAAM,SAAS;oBACb,IAAI,IAAA,iLAAM;oBACV,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,WAAW;gBACb;gBACA,MAAM,uIAAE,CAAC,UAAU,CAAC,GAAG,CAAC;gBACxB,QAAQ,GAAG,CAAC;gBACZ,IAAA,gJAAW,KAAI,wBAAwB;YACzC;QACF,OAAO;YACL,aAAa;YACb,MAAM,WAAuB;gBAC3B,IAAI,IAAA,iLAAM;gBACV,WAAW;gBACX;gBACA,WAAW;YACb;YACA,MAAM,uIAAE,CAAC,YAAY,CAAC,GAAG,CAAC;YAC1B,WAAW,CAAC,OAAS;oBAAC;uBAAa;iBAAK;YAExC,kCAAkC;YAClC,IAAI,SAAS;gBACX,MAAM,SAAS;oBACb,IAAI,IAAA,iLAAM;oBACV,YAAY;oBACZ,WAAW;oBACX,SAAS;oBACT,WAAW;gBACb;gBACA,MAAM,uIAAE,CAAC,UAAU,CAAC,GAAG,CAAC;gBACxB,QAAQ,GAAG,CAAC;gBACZ,IAAA,gJAAW,KAAI,wBAAwB;YACzC;QACF;IACF;IAEA,6CAA6C;IAC7C,MAAM,mBAAmB,OAAO;QAC9B,MAAM,uIAAE,CAAC,YAAY,CAAC,MAAM,CAAC;QAC7B,WAAW,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,QAAU,MAAM,EAAE,KAAK;QAEzD,IAAI,SAAS;YACX,MAAM,SAAS;gBACb,IAAI,IAAA,iLAAM;gBACV,YAAY;gBACZ,WAAW;gBACX,SAAS;oBAAE;gBAAG;gBACd,WAAW,KAAK,GAAG;YACrB;YACA,MAAM,uIAAE,CAAC,UAAU,CAAC,GAAG,CAAC;YACxB,QAAQ,GAAG,CAAC;YACZ,IAAA,gJAAW;QACb;IACF;IAEA,OAAO;QACL;QACA;QACA;IACF;AACF","debugId":null}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/app/app/diary/page.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { useDiary } from \"@/lib/db/useDiary\";\n\nexport default function DiaryPage() {\n  // âœ… 1. Get the deleteDiaryEntry function\n  const { entries, saveTodayEntry, deleteDiaryEntry } = useDiary();\n  const [content, setContent] = useState(\"\");\n  const today = new Date().toISOString().split(\"T\")[0]; // YYYY-MM-DD\n\n  const todaysEntry = entries.find((entry) => entry.entryDate === today);\n\n  // Load today's content if it exists\n  useEffect(() => {\n    if (todaysEntry) {\n      setContent(todaysEntry.content);\n    } else {\n      // âœ… If today's entry is deleted, clear the box\n      setContent(\"\");\n    }\n  }, [todaysEntry, today]);\n\n  // This effect formats the date\n  useEffect(() => {\n    const todayElement = document.getElementById(\"today-date\");\n    if (todayElement) {\n      todayElement.textContent = new Date().toLocaleDateString(undefined, {\n        weekday: \"long\",\n        month: \"long\",\n        day: \"numeric\",\n      });\n    }\n  }, []);\n\n  const handleSave = () => {\n    if (content.trim()) {\n      saveTodayEntry(content.trim());\n      // âœ… 2. Clear the text box after saving\n      setContent(\"\");\n    }\n  };\n\n  // âœ… 3. Add a generic delete handler\n  const handleDelete = (id: string) => {\n    if (confirm(\"Are you sure you want to delete this diary entry?\")) {\n      deleteDiaryEntry(id);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 p-4\">\n      <div className=\"max-w-3xl mx-auto\">\n        <h1 className=\"text-2xl font-bold text-gray-900 mb-6\">\n          Personal Diary\n        </h1>\n\n        {/* Today's Entry */}\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-8\">\n          <h2 className=\"text-lg font-medium text-gray-900 mb-2\">\n            Today, <span id=\"today-date\">Loading...</span>\n          </h2>\n          <textarea\n            value={content}\n            onChange={(e) => setContent(e.target.value)}\n            placeholder=\"Write your thoughts for today...\"\n            rows={8}\n            className=\"w-full border border-gray-300 rounded px-3 py-2 text-gray-800 mb-4\"\n          />\n          <button\n            onClick={handleSave}\n            className=\"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700\"\n          >\n            {todaysEntry ? \"Update Entry\" : \"Save Entry\"}\n          </button>\n\n          {/* âœ… 4. Add delete button for today's entry */}\n          {todaysEntry && (\n            <button\n              onClick={() => handleDelete(todaysEntry.id)}\n              className=\"ml-2 bg-red-100 text-red-700 px-4 py-2 rounded hover:bg-red-200\"\n            >\n              Delete Entry\n            </button>\n          )}\n        </div>\n\n        {/* Past Entries */}\n        {entries.length > 0 && (\n          <div>\n            <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n              Past Entries\n            </h2>\n            <div className=\"space-y-4\">\n              {[...entries]\n                .filter((entry) => entry.entryDate !== today)\n                .sort(\n                  (a, b) =>\n                    new Date(b.entryDate).getTime() -\n                    new Date(a.entryDate).getTime()\n                )\n                .map((entry) => (\n                  <div\n                    key={entry.id}\n                    className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\"\n                  >\n                    {/* âœ… 5. Add flex and delete button for past entries */}\n                    <div className=\"flex justify-between items-center\">\n                      <div className=\"font-medium text-gray-900\">\n                        {new Date(entry.entryDate).toLocaleDateString(\n                          undefined,\n                          {\n                            year: \"numeric\",\n                            month: \"long\",\n                            day: \"numeric\",\n                            timeZone: \"UTC\",\n                          }\n                        )}\n                      </div>\n                      <button\n                        onClick={() => handleDelete(entry.id)}\n                        className=\"text-xs text-red-600 hover:text-red-800\"\n                      >\n                        Delete\n                      </button>\n                    </div>\n                    <div className=\"mt-2 text-gray-700 whitespace-pre-wrap\">\n                      {entry.content}\n                    </div>\n                  </div>\n                ))}\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAKe,SAAS;IACtB,yCAAyC;IACzC,MAAM,EAAE,OAAO,EAAE,cAAc,EAAE,gBAAgB,EAAE,GAAG,IAAA,wIAAQ;IAC9D,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,QAAQ,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,EAAE,aAAa;IAEnE,MAAM,cAAc,QAAQ,IAAI,CAAC,CAAC,QAAU,MAAM,SAAS,KAAK;IAEhE,oCAAoC;IACpC,IAAA,kNAAS,EAAC;QACR,IAAI,aAAa;YACf,WAAW,YAAY,OAAO;QAChC,OAAO;YACL,+CAA+C;YAC/C,WAAW;QACb;IACF,GAAG;QAAC;QAAa;KAAM;IAEvB,+BAA+B;IAC/B,IAAA,kNAAS,EAAC;QACR,MAAM,eAAe,SAAS,cAAc,CAAC;QAC7C,IAAI,cAAc;YAChB,aAAa,WAAW,GAAG,IAAI,OAAO,kBAAkB,CAAC,WAAW;gBAClE,SAAS;gBACT,OAAO;gBACP,KAAK;YACP;QACF;IACF,GAAG,EAAE;IAEL,MAAM,aAAa;QACjB,IAAI,QAAQ,IAAI,IAAI;YAClB,eAAe,QAAQ,IAAI;YAC3B,uCAAuC;YACvC,WAAW;QACb;IACF;IAEA,oCAAoC;IACpC,MAAM,eAAe,CAAC;QACpB,IAAI,QAAQ,sDAAsD;YAChE,iBAAiB;QACnB;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC;YAAI,WAAU;;8BACb,8OAAC;oBAAG,WAAU;8BAAwC;;;;;;8BAKtD,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BAAG,WAAU;;gCAAyC;8CAC9C,8OAAC;oCAAK,IAAG;8CAAa;;;;;;;;;;;;sCAE/B,8OAAC;4BACC,OAAO;4BACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;4BAC1C,aAAY;4BACZ,MAAM;4BACN,WAAU;;;;;;sCAEZ,8OAAC;4BACC,SAAS;4BACT,WAAU;sCAET,cAAc,iBAAiB;;;;;;wBAIjC,6BACC,8OAAC;4BACC,SAAS,IAAM,aAAa,YAAY,EAAE;4BAC1C,WAAU;sCACX;;;;;;;;;;;;gBAOJ,QAAQ,MAAM,GAAG,mBAChB,8OAAC;;sCACC,8OAAC;4BAAG,WAAU;sCAA2C;;;;;;sCAGzD,8OAAC;4BAAI,WAAU;sCACZ;mCAAI;6BAAQ,CACV,MAAM,CAAC,CAAC,QAAU,MAAM,SAAS,KAAK,OACtC,IAAI,CACH,CAAC,GAAG,IACF,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAC7B,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,IAEhC,GAAG,CAAC,CAAC,sBACJ,8OAAC;oCAEC,WAAU;;sDAGV,8OAAC;4CAAI,WAAU;;8DACb,8OAAC;oDAAI,WAAU;8DACZ,IAAI,KAAK,MAAM,SAAS,EAAE,kBAAkB,CAC3C,WACA;wDACE,MAAM;wDACN,OAAO;wDACP,KAAK;wDACL,UAAU;oDACZ;;;;;;8DAGJ,8OAAC;oDACC,SAAS,IAAM,aAAa,MAAM,EAAE;oDACpC,WAAU;8DACX;;;;;;;;;;;;sDAIH,8OAAC;4CAAI,WAAU;sDACZ,MAAM,OAAO;;;;;;;mCAxBX,MAAM,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkCjC","debugId":null}}]
}