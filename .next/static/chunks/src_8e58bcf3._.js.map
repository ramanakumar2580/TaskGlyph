{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/db/clientDb.ts"],"sourcesContent":["import Dexie from \"dexie\";\n\n// Create a subclass of Dexie for type safety\nclass TaskGlyphDB extends Dexie {\n  tasks!: Dexie.Table<Task, string>;\n  projects!: Dexie.Table<Project, string>;\n  notes!: Dexie.Table<Note, string>;\n  diaryEntries!: Dexie.Table<DiaryEntry, string>;\n  pomodoroSessions!: Dexie.Table<PomodoroSession, string>;\n  syncOutbox!: Dexie.Table<SyncOperation, string>;\n  userMetadata!: Dexie.Table<UserMetadata, string>;\n  // [NEW] Add the new notifications table\n  notifications!: Dexie.Table<Notification, string>;\n\n  constructor() {\n    super(\"TaskGlyphDB\");\n\n    // [NEW] BUMPED TO VERSION 4 for reminder/notification schema\n    this.version(4).stores({\n      userMetadata: \"userId\",\n      // [UPDATED] Added new fields for querying reminders and meetings\n      tasks:\n        // --- THIS LINE IS THE FIX ---\n        \"id, title, completed, createdAt, updatedAt, projectId, parentId, dueDate, priority, *tags, reminderAt, recurringSchedule, meetLink, reminder_30_sent, reminder_20_sent, reminder_10_sent\",\n      projects: \"id, name, createdAt, updatedAt\",\n      notes: \"id, title, createdAt, updatedAt\",\n      diaryEntries: \"id, entryDate, createdAt\",\n      pomodoroSessions: \"id, durationMinutes, completedAt, type\",\n      syncOutbox: \"id, entityType, operation, timestamp\",\n      // [NEW] Added notifications table\n      notifications: \"id, userId, read, createdAt\",\n    });\n\n    // This was your old version 3, we keep it for migrations\n    this.version(3).stores({\n      userMetadata: \"userId\",\n      tasks:\n        \"id, title, completed, createdAt, updatedAt, projectId, parentId, dueDate, priority, *tags, reminderAt, recurringSchedule\",\n      projects: \"id, name, createdAt, updatedAt\",\n      notes: \"id, title, createdAt, updatedAt\",\n      diaryEntries: \"id, entryDate, createdAt\",\n      pomodoroSessions: \"id, durationMinutes, completedAt, type\",\n      syncOutbox: \"id, entityType, operation, timestamp\",\n    });\n\n    // This was your old version 2\n    this.version(2).stores({\n      userMetadata: \"userId\",\n      tasks: \"id, title, completed, createdAt, updatedAt\",\n      notes: \"id, title, createdAt, updatedAt\",\n      diaryEntries: \"id, entryDate, createdAt\",\n      pomodoroSessions: \"id, durationMinutes, completedAt, type\",\n      syncOutbox: \"id, entityType, operation, timestamp\",\n    });\n\n    // This was your old version 1\n    this.version(1).stores({\n      userMetadata: \"userId\",\n      tasks: \"id, title, completed, createdAt, updatedAt\",\n      notes: \"id, title, createdAt, updatedAt\",\n      diaryEntries: \"id, entryDate, createdAt\",\n      pomodoroSessions: \"id, durationMinutes, completedAt\",\n      syncOutbox: \"id, entityType, operation, timestamp\",\n    });\n  }\n}\nexport interface UserMetadata {\n  userId: string;\n  trialStartedAt: number; // timestamp\n  tier: \"free\" | \"basic\" | \"pro\" | \"ultra_pro\";\n}\n\nexport interface Project {\n  id: string;\n  name: string; // \"title\" from your spec\n  description: string | null; // \"rich-text description\"\n  accentColor: string | null; // \"accent color\"\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport type Priority = \"none\" | \"low\" | \"medium\" | \"high\";\nexport type RecurringSchedule = \"none\" | \"daily\" | \"weekly\" | \"monthly\";\n\n// [UPDATED] Task interface with meeting link and reminder flags\nexport interface Task {\n  id: string;\n  title: string;\n  completed: boolean;\n  createdAt: number;\n  updatedAt: number;\n\n  // --- HIERARCHY FIELDS ---\n  projectId: string | null; // Null if standalone\n  parentId: string | null; // Null if top-level task\n\n  // --- FEATURE FIELDS ---\n  notes: string | null; // \"optional notes\"\n  dueDate: number | null; // Store as timestamp\n  priority: Priority;\n  tags: string[]; // \"comma-separated tags\"\n  recurringSchedule: RecurringSchedule;\n  reminderAt: number | null; // Store as timestamp\n\n  // --- [NEW] Fields for Meetings & Reminders ---\n  meetLink: string | null;\n  reminder_30_sent: boolean;\n  reminder_20_sent: boolean;\n  reminder_10_sent: boolean;\n}\n\nexport interface Note {\n  id: string;\n  title: string;\n  content: string; // This is the separate \"Markdown Note\" feature\n  createdAt: number;\n  updatedAt: number;\n}\n\nexport interface DiaryEntry {\n  id: string;\n  entryDate: string; // YYYY-MM-DD\n  content: string;\n  createdAt: number;\n}\n\nexport interface PomodoroSession {\n  id: string;\n  durationMinutes: number;\n  completedAt: number;\n  type: \"work\" | \"break\";\n}\n\n// [NEW] Interface for In-App Notifications\nexport interface Notification {\n  id: string;\n  userId: string;\n  message: string;\n  link: string | null; // e.g., to the task/meeting ID\n  read: boolean;\n  createdAt: number;\n}\n\n// [UPDATED] Entity Type to include 'notification' and 'project'\nexport type EntityType =\n  | \"task\"\n  | \"project\"\n  | \"note\"\n  | \"diary\"\n  | \"pomodoro\"\n  | \"notification\";\nexport type OperationType = \"create\" | \"update\" | \"delete\";\n\nexport interface SyncOperation {\n  id: string;\n  entityType: EntityType;\n  operation: OperationType;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  payload: any;\n  timestamp: number;\n}\n\n// Export a singleton instance\nconst db = new TaskGlyphDB();\n\nexport default db;\n"],"names":[],"mappings":";;;;;AAAA;;;AAEA,6CAA6C;AAC7C,MAAM,oBAAoB,yJAAK;IAW7B,aAAc;QACZ,KAAK,CAAC,gBAXR,+KAAA,SAAA,KAAA,IACA,+KAAA,YAAA,KAAA,IACA,+KAAA,SAAA,KAAA,IACA,+KAAA,gBAAA,KAAA,IACA,+KAAA,oBAAA,KAAA,IACA,+KAAA,cAAA,KAAA,IACA,+KAAA,gBAAA,KAAA,IACA,wCAAwC;QACxC,+KAAA,iBAAA,KAAA;QAKE,6DAA6D;QAC7D,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACrB,cAAc;YACd,iEAAiE;YACjE,OACE,+BAA+B;YAC/B;YACF,UAAU;YACV,OAAO;YACP,cAAc;YACd,kBAAkB;YAClB,YAAY;YACZ,kCAAkC;YAClC,eAAe;QACjB;QAEA,yDAAyD;QACzD,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACrB,cAAc;YACd,OACE;YACF,UAAU;YACV,OAAO;YACP,cAAc;YACd,kBAAkB;YAClB,YAAY;QACd;QAEA,8BAA8B;QAC9B,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACrB,cAAc;YACd,OAAO;YACP,OAAO;YACP,cAAc;YACd,kBAAkB;YAClB,YAAY;QACd;QAEA,8BAA8B;QAC9B,IAAI,CAAC,OAAO,CAAC,GAAG,MAAM,CAAC;YACrB,cAAc;YACd,OAAO;YACP,OAAO;YACP,cAAc;YACd,kBAAkB;YAClB,YAAY;QACd;IACF;AACF;AAiGA,8BAA8B;AAC9B,MAAM,KAAK,IAAI;uCAEA","debugId":null}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/sync/syncService.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/no-explicit-any */\nimport db from \"@/lib/db/clientDb\";\n\n// âœ… ADDED: A \"lock\" to prevent multiple syncs at once\nlet isSyncing = false;\n// âœ… ADDED: A timer for debouncing sync pokes\nlet syncTimeout: NodeJS.Timeout | null = null;\n// âœ… ADDED: A custom event name to \"poke\" the sync service\nconst SYNC_TRIGGER_EVENT = \"taskglyph-sync-trigger\";\n\n// âœ… ADDED: A new function to call from your hooks (useTasks, etc.)\nexport function triggerSync() {\n  console.log(\"Poking sync service...\");\n  window.dispatchEvent(new Event(SYNC_TRIGGER_EVENT));\n}\n\n// Check if user is online\nexport function isOnline(): boolean {\n  return typeof window !== \"undefined\" && navigator.onLine;\n}\n\n// Get user tier from IndexedDB\nasync function getUserTier(userId: string): Promise<string> {\n  const userMeta = await db.userMetadata.get(userId);\n  return userMeta?.tier || \"free\";\n}\n\n// Flush sync outbox to server\nexport async function flushSyncOutbox(userId: string): Promise<void> {\n  // âœ… ADDED: Check online status and sync lock\n  if (!isOnline()) {\n    console.log(\"Offline, flush aborted.\");\n    return;\n  }\n  if (isSyncing) {\n    console.log(\"Sync already in progress, skipping flush request.\");\n    return;\n  }\n  isSyncing = true;\n\n  // âœ… ALL TIERS SYNC NOW â€” including Free (with limits enforced on server)\n  const outbox = await db.syncOutbox.toArray();\n  if (outbox.length === 0) {\n    console.log(\"âœ… Sync outbox is empty\");\n    isSyncing = false; // âœ… Release lock\n    return;\n  }\n\n  console.log(`ðŸ“¤ Flushing ${outbox.length} operations to server...`);\n\n  try {\n    const response = await fetch(\"/api/sync\", {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ operations: outbox }),\n    });\n\n    if (!response.ok) {\n      let errorText = \"Unknown error\";\n      try {\n        const error = await response.json();\n        errorText = JSON.stringify(error, null, 2);\n      } catch {\n        errorText = await response.text();\n      }\n      console.log(`âŒ Sync failed: ${errorText}`);\n      return; // Do not delete operations, try again next time\n    }\n\n    const result = await response.json();\n    console.log(\"âœ… Sync result:\", result);\n\n    // Remove successfully synced operations\n    const successIds = result.results\n      .filter((r: any) => r.success)\n      .map((r: any) => r.id);\n\n    if (successIds.length > 0) {\n      await db.syncOutbox.bulkDelete(successIds);\n      console.log(\n        `ðŸ—‘ï¸ Removed ${successIds.length} synced operations from outbox`\n      );\n    }\n  } catch (error) {\n    console.error(\"âŒ Network error during sync:\", error);\n  } finally {\n    // âœ… ADDED: Always release the lock\n    isSyncing = false;\n  }\n}\n\n// Start background sync (call this on app load)\nexport function startBackgroundSync(userId: string): () => void {\n  // 1. Sync immediately if online\n  if (isOnline()) {\n    flushSyncOutbox(userId);\n  }\n\n  // 2. Listen for online events (sync immediately)\n  const handleOnline = () => {\n    console.log(\"ðŸŒ Back online â€” triggering sync\");\n    flushSyncOutbox(userId);\n  };\n  window.addEventListener(\"online\", handleOnline);\n\n  // 3. âœ… ADDED: Listen for pokes (debounced sync)\n  const handleSyncTrigger = () => {\n    if (syncTimeout) {\n      clearTimeout(syncTimeout);\n    }\n    console.log(\"Sync poke received, debouncing...\");\n    syncTimeout = setTimeout(() => {\n      flushSyncOutbox(userId);\n    }, 1500); // 1.5 second debounce\n  };\n  window.addEventListener(SYNC_TRIGGER_EVENT, handleSyncTrigger);\n\n  // 4. Return cleanup function\n  return () => {\n    window.removeEventListener(\"online\", handleOnline);\n    // âœ… ADDED: Cleanup for new listener and timeout\n    window.removeEventListener(SYNC_TRIGGER_EVENT, handleSyncTrigger);\n    if (syncTimeout) {\n      clearTimeout(syncTimeout);\n    }\n  };\n}\n"],"names":[],"mappings":"AAAA,oDAAoD,GACpD,qDAAqD;;;;;;;;;;AACrD;;AAEA,sDAAsD;AACtD,IAAI,YAAY;AAChB,6CAA6C;AAC7C,IAAI,cAAqC;AACzC,0DAA0D;AAC1D,MAAM,qBAAqB;AAGpB,SAAS;IACd,QAAQ,GAAG,CAAC;IACZ,OAAO,aAAa,CAAC,IAAI,MAAM;AACjC;AAGO,SAAS;IACd,OAAO,aAAkB,eAAe,UAAU,MAAM;AAC1D;AAEA,+BAA+B;AAC/B,eAAe,YAAY,MAAc;IACvC,MAAM,WAAW,MAAM,0IAAE,CAAC,YAAY,CAAC,GAAG,CAAC;IAC3C,OAAO,CAAA,qBAAA,+BAAA,SAAU,IAAI,KAAI;AAC3B;AAGO,eAAe,gBAAgB,MAAc;IAClD,6CAA6C;IAC7C,IAAI,CAAC,YAAY;QACf,QAAQ,GAAG,CAAC;QACZ;IACF;IACA,IAAI,WAAW;QACb,QAAQ,GAAG,CAAC;QACZ;IACF;IACA,YAAY;IAEZ,yEAAyE;IACzE,MAAM,SAAS,MAAM,0IAAE,CAAC,UAAU,CAAC,OAAO;IAC1C,IAAI,OAAO,MAAM,KAAK,GAAG;QACvB,QAAQ,GAAG,CAAC;QACZ,YAAY,OAAO,iBAAiB;QACpC;IACF;IAEA,QAAQ,GAAG,CAAC,AAAC,eAA4B,OAAd,OAAO,MAAM,EAAC;IAEzC,IAAI;QACF,MAAM,WAAW,MAAM,MAAM,aAAa;YACxC,QAAQ;YACR,aAAa;YACb,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE,YAAY;YAAO;QAC5C;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,IAAI,YAAY;YAChB,IAAI;gBACF,MAAM,QAAQ,MAAM,SAAS,IAAI;gBACjC,YAAY,KAAK,SAAS,CAAC,OAAO,MAAM;YAC1C,EAAE,UAAM;gBACN,YAAY,MAAM,SAAS,IAAI;YACjC;YACA,QAAQ,GAAG,CAAC,AAAC,kBAA2B,OAAV;YAC9B,QAAQ,gDAAgD;QAC1D;QAEA,MAAM,SAAS,MAAM,SAAS,IAAI;QAClC,QAAQ,GAAG,CAAC,kBAAkB;QAE9B,wCAAwC;QACxC,MAAM,aAAa,OAAO,OAAO,CAC9B,MAAM,CAAC,CAAC,IAAW,EAAE,OAAO,EAC5B,GAAG,CAAC,CAAC,IAAW,EAAE,EAAE;QAEvB,IAAI,WAAW,MAAM,GAAG,GAAG;YACzB,MAAM,0IAAE,CAAC,UAAU,CAAC,UAAU,CAAC;YAC/B,QAAQ,GAAG,CACT,AAAC,eAAgC,OAAlB,WAAW,MAAM,EAAC;QAErC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gCAAgC;IAChD,SAAU;QACR,mCAAmC;QACnC,YAAY;IACd;AACF;AAGO,SAAS,oBAAoB,MAAc;IAChD,gCAAgC;IAChC,IAAI,YAAY;QACd,gBAAgB;IAClB;IAEA,iDAAiD;IACjD,MAAM,eAAe;QACnB,QAAQ,GAAG,CAAC;QACZ,gBAAgB;IAClB;IACA,OAAO,gBAAgB,CAAC,UAAU;IAElC,gDAAgD;IAChD,MAAM,oBAAoB;QACxB,IAAI,aAAa;YACf,aAAa;QACf;QACA,QAAQ,GAAG,CAAC;QACZ,cAAc,WAAW;YACvB,gBAAgB;QAClB,GAAG,OAAO,sBAAsB;IAClC;IACA,OAAO,gBAAgB,CAAC,oBAAoB;IAE5C,6BAA6B;IAC7B,OAAO;QACL,OAAO,mBAAmB,CAAC,UAAU;QACrC,gDAAgD;QAChD,OAAO,mBAAmB,CAAC,oBAAoB;QAC/C,IAAI,aAAa;YACf,aAAa;QACf;IACF;AACF","debugId":null}},
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/app/layout-client.tsx"],"sourcesContent":["\"use client\";\n\nimport { SessionProvider, useSession } from \"next-auth/react\";\nimport { useEffect } from \"react\";\nimport { startBackgroundSync } from \"@/lib/sync/syncService\";\n\n// We create a new component that *contains* the sync logic\n// because we can only call useSession() inside a <SessionProvider>.\nfunction SyncManager({ children }: { children: React.ReactNode }) {\n  const { data: session } = useSession();\n\n  // âœ… ADDED: Start background sync for authenticated users\n  useEffect(() => {\n    if (session?.user?.id) {\n      console.log(\"Starting global background sync...\");\n      const cleanup = startBackgroundSync(session.user.id);\n      return cleanup; // Clean up event listener on unmount\n    }\n  }, [session?.user?.id]);\n\n  return <>{children}</>;\n}\n\nexport default function LayoutClient({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <SessionProvider>\n      {/* âœ… WRAPPED: We wrap the children in our new SyncManager */}\n      <SyncManager>{children}</SyncManager>\n    </SessionProvider>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAMA,2DAA2D;AAC3D,oEAAoE;AACpE,SAAS,YAAY,KAA2C;QAA3C,EAAE,QAAQ,EAAiC,GAA3C;QAUf;;IATJ,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,IAAA,+JAAU;IAEpC,yDAAyD;IACzD,IAAA,0KAAS;iCAAC;gBACJ;YAAJ,IAAI,oBAAA,+BAAA,gBAAA,QAAS,IAAI,cAAb,oCAAA,cAAe,EAAE,EAAE;gBACrB,QAAQ,GAAG,CAAC;gBACZ,MAAM,UAAU,IAAA,2JAAmB,EAAC,QAAQ,IAAI,CAAC,EAAE;gBACnD,OAAO,SAAS,qCAAqC;YACvD;QACF;gCAAG;QAAC,oBAAA,+BAAA,gBAAA,QAAS,IAAI,cAAb,oCAAA,cAAe,EAAE;KAAC;IAEtB,qBAAO;kBAAG;;AACZ;GAbS;;QACmB,+JAAU;;;KAD7B;AAeM,SAAS,aAAa,KAIpC;QAJoC,EACnC,QAAQ,EAGT,GAJoC;IAKnC,qBACE,6LAAC,oKAAe;kBAEd,cAAA,6LAAC;sBAAa;;;;;;;;;;;AAGpB;MAXwB","debugId":null}}]
}