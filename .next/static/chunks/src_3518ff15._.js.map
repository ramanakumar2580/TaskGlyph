{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/db/useDiary.ts"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport db, {\n  DiaryEntry,\n  OperationType,\n  EntityType,\n  DiaryWeather,\n  DiaryMedia,\n} from \"./clientDb\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { format } from \"date-fns\";\nimport { useTier } from \"./useTier\";\nimport { triggerSync } from \"../sync/syncService\";\n\n// Helper interface for the data passed from the UI\nexport interface DiaryUpdatePayload {\n  content: string;\n  mood?: string;\n  energy?: number;\n  weather?: DiaryWeather | null;\n  location?: string;\n  tags?: string[];\n  isLocked?: boolean;\n  media?: DiaryMedia[];\n}\n\nexport function useDiary() {\n  const [entries, setEntries] = useState<DiaryEntry[]>([]);\n  const tier = useTier();\n  const canSync = !!tier;\n\n  // Load diary entries from IndexedDB on mount\n  useEffect(() => {\n    const fetchEntries = async () => {\n      const allEntries = await db.diaryEntries.toArray();\n      // Sort: Newest first\n      const sorted = allEntries.sort(\n        (a, b) =>\n          new Date(b.entryDate).getTime() - new Date(a.entryDate).getTime()\n      );\n      setEntries(sorted);\n    };\n    fetchEntries();\n  }, []);\n\n  /**\n   * Save (Create or Update) an entry.\n   * @param data - The content and new fields (mood, weather, etc.)\n   * @param dateStr - Optional YYYY-MM-DD string. Defaults to TODAY if omitted.\n   */\n  const saveEntry = async (data: DiaryUpdatePayload, dateStr?: string) => {\n    // Default to today if no specific date provided\n    const targetDate = dateStr || format(new Date(), \"yyyy-MM-dd\");\n\n    const existing = entries.find((entry) => entry.entryDate === targetDate);\n    const now = Date.now();\n\n    if (existing) {\n      // --- UPDATE EXISTING ---\n\n      // Prepare the update object (merging existing data with new data)\n      const updates = {\n        content: data.content,\n        // We generally keep the original createdAt, but you could add updatedAt if needed\n        mood: data.mood,\n        energy: data.energy,\n        weather: data.weather,\n        location: data.location,\n        tags: data.tags,\n        isLocked: data.isLocked,\n        media: data.media,\n      };\n\n      // 1. Update in Local DB\n      await db.diaryEntries.update(existing.id, updates);\n\n      // 2. Update Local State\n      setEntries((prev) =>\n        prev.map((entry) =>\n          entry.id === existing.id ? { ...entry, ...updates } : entry\n        )\n      );\n\n      // 3. Sync\n      if (canSync) {\n        const fullUpdatedEntry = { ...existing, ...updates };\n        const syncOp = {\n          id: uuidv4(),\n          entityType: \"diary\" as EntityType,\n          operation: \"update\" as OperationType,\n          payload: fullUpdatedEntry,\n          timestamp: now,\n        };\n        await db.syncOutbox.add(syncOp);\n        console.log(\"üì§ Added UPDATE diary entry to sync outbox\");\n        triggerSync();\n      }\n    } else {\n      // --- CREATE NEW ---\n\n      const newEntry: DiaryEntry = {\n        id: uuidv4(),\n        entryDate: targetDate,\n        content: data.content,\n        createdAt: now,\n        mood: data.mood,\n        energy: data.energy,\n        weather: data.weather || null,\n        location: data.location,\n        tags: data.tags || [],\n        isLocked: data.isLocked || false,\n        media: data.media || [],\n      };\n\n      // 1. Add to Local DB\n      await db.diaryEntries.add(newEntry);\n\n      // 2. Update Local State (and re-sort)\n      setEntries((prev) => {\n        const updated = [newEntry, ...prev];\n        return updated.sort(\n          (a, b) =>\n            new Date(b.entryDate).getTime() - new Date(a.entryDate).getTime()\n        );\n      });\n\n      // 3. Sync\n      if (canSync) {\n        const syncOp = {\n          id: uuidv4(),\n          entityType: \"diary\" as EntityType,\n          operation: \"create\" as OperationType,\n          payload: newEntry,\n          timestamp: now,\n        };\n        await db.syncOutbox.add(syncOp);\n        console.log(\"üì§ Added CREATE diary entry to sync outbox\");\n        triggerSync();\n      }\n    }\n  };\n\n  const deleteDiaryEntry = async (id: string) => {\n    await db.diaryEntries.delete(id);\n    setEntries((prev) => prev.filter((entry) => entry.id !== id));\n\n    if (canSync) {\n      const syncOp = {\n        id: uuidv4(),\n        entityType: \"diary\" as EntityType,\n        operation: \"delete\" as OperationType,\n        payload: { id },\n        timestamp: Date.now(),\n      };\n      await db.syncOutbox.add(syncOp);\n      console.log(\"üì§ Added DELETE diary entry to sync outbox\");\n      triggerSync();\n    }\n  };\n\n  return {\n    entries,\n    saveEntry, // ‚úÖ Renamed to saveEntry (replaces saveTodayEntry)\n    deleteDiaryEntry,\n  };\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 166, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/uploadToS3.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\n/**\n * [UPDATED] The object returned by the uploader.\n * It now includes the full public URL.\n */\nexport interface S3UploadResponse {\n  s3Key: string;\n  url: string; // The full public URL\n  fileName: string;\n  fileSize: number;\n}\n\n/**\n * Uploads a file to AWS S3 using your Next.js presigned URL route.\n *\n * @param file - The File object (from input or drag-drop)\n * @param entityType - \"notes\" | \"diary\"\n * @returns An object with the s3Key, public URL, fileName, and fileSize\n */\nexport async function uploadToS3(\n  file: File,\n  entityType: \"notes\" | \"diary\"\n): Promise<S3UploadResponse> {\n  try {\n    // 1Ô∏è‚É£ Request a presigned URL\n    const res = await fetch(\"/api/s3-upload\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        fileName: file.name,\n        fileType: file.type,\n        entityType,\n      }),\n    });\n\n    if (!res.ok) {\n      const err = await res.json();\n      throw new Error(err.error || \"Failed to get upload URL\");\n    }\n\n    const { uploadUrl, s3Key } = await res.json();\n\n    // 2Ô∏è‚É£ Upload the file directly to S3\n    const upload = await fetch(uploadUrl, {\n      method: \"PUT\",\n      headers: { \"Content-Type\": file.type },\n      body: file,\n    });\n\n    if (!upload.ok) {\n      throw new Error(\"Failed to upload file to S3\");\n    }\n\n    // 3Ô∏è‚É£ [NEW] Construct the final public URL\n    // Make sure these NEXT_PUBLIC_ variables are in your .env.local\n    const finalUrl = `https://${process.env.NEXT_PUBLIC_AWS_S3_BUCKET_NAME}.s3.${process.env.NEXT_PUBLIC_AWS_S3_REGION}.amazonaws.com/${s3Key}`;\n\n    return {\n      s3Key: s3Key,\n      url: finalUrl, // Return the full URL\n      fileName: file.name,\n      fileSize: file.size,\n    };\n  } catch (error: any) {\n    console.error(\"S3 Upload Error:\", error);\n    throw new Error(error.message || \"Upload failed\");\n  }\n}\n"],"names":[],"mappings":"AAAA,qDAAqD,GAErD;;;CAGC;;;;AAmD+B;AApCzB,eAAe,WACpB,IAAU,EACV,UAA6B;IAE7B,IAAI;QACF,8BAA8B;QAC9B,MAAM,MAAM,MAAM,MAAM,kBAAkB;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBACnB,UAAU,KAAK,IAAI;gBACnB,UAAU,KAAK,IAAI;gBACnB;YACF;QACF;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,MAAM,IAAI,MAAM,IAAI,KAAK,IAAI;QAC/B;QAEA,MAAM,EAAE,SAAS,EAAE,KAAK,EAAE,GAAG,MAAM,IAAI,IAAI;QAE3C,qCAAqC;QACrC,MAAM,SAAS,MAAM,MAAM,WAAW;YACpC,QAAQ;YACR,SAAS;gBAAE,gBAAgB,KAAK,IAAI;YAAC;YACrC,MAAM;QACR;QAEA,IAAI,CAAC,OAAO,EAAE,EAAE;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,2CAA2C;QAC3C,gEAAgE;QAChE,MAAM,WAAW,AAAC,WAA2D,qEAAN,QAA6D,uDAAjB,mBAAuB,OAAN;QAEpI,OAAO;YACL,OAAO;YACP,KAAK;YACL,UAAU,KAAK,IAAI;YACnB,UAAU,KAAK,IAAI;QACrB;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,oBAAoB;QAClC,MAAM,IAAI,MAAM,MAAM,OAAO,IAAI;IACnC;AACF","debugId":null}},
    {"offset": {"line": 225, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/lib/deleteFromS3.ts"],"sourcesContent":["/**\n * Deletes a file from AWS S3 via your Next.js API route.\n * * @param url - The full S3 URL of the file to delete\n * @returns boolean - True if deleted successfully\n */\nexport async function deleteFromS3(url: string): Promise<boolean> {\n  try {\n    const res = await fetch(\"/api/s3-delete\", {\n      method: \"POST\",\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({ url }),\n    });\n\n    if (!res.ok) {\n      const err = await res.json();\n      console.error(\"Failed to delete from S3:\", err.error);\n      return false;\n    }\n\n    return true;\n  } catch (error) {\n    console.error(\"Error in deleteFromS3:\", error);\n    return false;\n  }\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AACM,eAAe,aAAa,GAAW;IAC5C,IAAI;QACF,MAAM,MAAM,MAAM,MAAM,kBAAkB;YACxC,QAAQ;YACR,SAAS;gBAAE,gBAAgB;YAAmB;YAC9C,MAAM,KAAK,SAAS,CAAC;gBAAE;YAAI;QAC7B;QAEA,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,MAAM,MAAM,IAAI,IAAI;YAC1B,QAAQ,KAAK,CAAC,6BAA6B,IAAI,KAAK;YACpD,OAAO;QACT;QAEA,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;IACT;AACF","debugId":null}},
    {"offset": {"line": 262, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/components/AudioRecorder.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useRef, useEffect } from \"react\";\nimport { Mic, StopCircle, Play, Pause, X, Check } from \"lucide-react\";\n\ntype Props = {\n  onClose: () => void;\n  onAdd: (file: File) => void;\n};\n\nexport function AudioRecorder({ onClose, onAdd }: Props) {\n  const [isRecording, setIsRecording] = useState(false);\n  const [audioURL, setAudioURL] = useState<string | null>(null);\n  const [audioFile, setAudioFile] = useState<File | null>(null);\n  const [permissionError, setPermissionError] = useState(false);\n  const mediaRecorderRef = useRef<MediaRecorder | null>(null);\n  const audioChunksRef = useRef<Blob[]>([]);\n  const audioRef = useRef<HTMLAudioElement>(null);\n  const [isPlaying, setIsPlaying] = useState(false);\n\n  // Request mic permission on mount\n  useEffect(() => {\n    navigator.mediaDevices\n      .getUserMedia({ audio: true })\n      .then(() => {\n        // [THE FIX] Changed 'stream =>' to '() =>'\n        setPermissionError(false);\n      })\n      .catch((err) => {\n        console.error(\"Mic permission denied:\", err);\n        setPermissionError(true);\n      });\n  }, []);\n\n  const startRecording = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });\n      setIsRecording(true);\n      setAudioURL(null);\n      setAudioFile(null);\n      audioChunksRef.current = [];\n\n      mediaRecorderRef.current = new MediaRecorder(stream);\n      mediaRecorderRef.current.ondataavailable = (event) => {\n        audioChunksRef.current.push(event.data);\n      };\n      mediaRecorderRef.current.onstop = () => {\n        const audioBlob = new Blob(audioChunksRef.current, {\n          type: \"audio/wav\",\n        });\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const file = new File([audioBlob], \"recording.wav\", {\n          type: \"audio/wav\",\n        });\n        setAudioURL(audioUrl);\n        setAudioFile(file);\n      };\n      mediaRecorderRef.current.start();\n    } catch (err) {\n      console.error(\"Error starting recording:\", err);\n      setPermissionError(true);\n    }\n  };\n\n  const stopRecording = () => {\n    if (mediaRecorderRef.current && isRecording) {\n      mediaRecorderRef.current.stop();\n      setIsRecording(false);\n    }\n  };\n\n  const togglePlay = () => {\n    if (audioRef.current) {\n      if (isPlaying) {\n        audioRef.current.pause();\n      } else {\n        audioRef.current.play();\n      }\n      setIsPlaying(!isPlaying);\n    }\n  };\n\n  const handleAddClick = () => {\n    if (audioFile) {\n      onAdd(audioFile);\n      onClose();\n    }\n  };\n\n  return (\n    <div\n      className=\"fixed inset-0 z-50 flex items-center justify-center bg-black/50\"\n      onClick={onClose}\n    >\n      <div\n        onClick={(e) => e.stopPropagation()}\n        className=\"bg-white rounded-lg shadow-xl w-96 p-6\"\n      >\n        <div className=\"flex justify-between items-center mb-4\">\n          <h3 className=\"text-lg font-semibold\">Record Audio</h3>\n          <button\n            onClick={onClose}\n            className=\"p-1 rounded-full hover:bg-gray-200\"\n          >\n            <X className=\"w-5 h-5\" />\n          </button>\n        </div>\n\n        {permissionError && (\n          <div\n            className=\"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative\"\n            role=\"alert\"\n          >\n            <strong className=\"font-bold\">Error:</strong>\n            <span className=\"block sm:inline\">\n              {\" \"}\n              Microphone permission denied. Please allow mic access in your\n              browser settings.\n            </span>\n          </div>\n        )}\n\n        {/* Player / Recorder */}\n        <div className=\"flex flex-col items-center justify-center h-32\">\n          {!audioURL && (\n            <button\n              type=\"button\"\n              onClick={isRecording ? stopRecording : startRecording}\n              className={`flex items-center justify-center w-20 h-20 rounded-full text-white transition-all\n                ${\n                  isRecording\n                    ? \"bg-red-500 hover:bg-red-600\"\n                    : \"bg-blue-500 hover:bg-blue-600\"\n                }\n              `}\n              disabled={permissionError}\n            >\n              {isRecording ? (\n                <StopCircle className=\"w-8 h-8\" />\n              ) : (\n                <Mic className=\"w-8 h-8\" />\n              )}\n            </button>\n          )}\n\n          {audioURL && (\n            <div className=\"w-full flex items-center gap-3\">\n              <button\n                type=\"button\"\n                onClick={togglePlay}\n                className=\"flex-shrink-0 w-12 h-12 rounded-full bg-gray-200 hover:bg-gray-300 flex items-center justify-center\"\n              >\n                {isPlaying ? (\n                  <Pause className=\"w-6 h-6\" />\n                ) : (\n                  <Play className=\"w-6 h-6\" />\n                )}\n              </button>\n              <audio\n                ref={audioRef}\n                src={audioURL}\n                onEnded={() => setIsPlaying(false)}\n                className=\"w-full\"\n              />\n            </div>\n          )}\n        </div>\n\n        {/* Footer Buttons */}\n        <div className=\"flex justify-end gap-3 mt-6 border-t pt-4\">\n          <button\n            type=\"button\"\n            onClick={onClose}\n            className=\"px-4 py-2 text-sm font-medium bg-gray-200 rounded-md hover:bg-gray-300 focus:outline-none\"\n          >\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            onClick={handleAddClick}\n            disabled={!audioFile}\n            className=\"px-4 py-2 text-sm font-medium text-white bg-black rounded-md hover:bg-gray-800 focus:outline-none disabled:opacity-50\"\n          >\n            <Check className=\"w-4 h-4 inline-block mr-1\" />\n            Add to Note\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 565, "column": 0}, "map": {"version":3,"sources":["file:///Users/ramanakumar/TaskGlyph/src/app/app/diary/page.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\n\"use client\";\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { createPortal } from \"react-dom\";\nimport { useDiary } from \"@/lib/db/useDiary\";\nimport {\n  format,\n  subDays,\n  addDays,\n  isSameDay,\n  parseISO,\n  startOfMonth,\n  endOfMonth,\n  eachDayOfInterval,\n  addMonths,\n  subMonths,\n  addYears,\n  subYears,\n  isSameMonth,\n  getDay,\n  isFuture,\n  isToday,\n} from \"date-fns\";\nimport { uploadToS3 } from \"@/lib/uploadToS3\";\nimport { deleteFromS3 } from \"@/lib/deleteFromS3\";\nimport {\n  Cloud,\n  Sun,\n  MapPin,\n  Hash,\n  ChevronLeft,\n  ChevronRight,\n  ChevronsLeft,\n  ChevronsRight,\n  Save,\n  Trash2,\n  Calendar as CalendarIcon,\n  Zap,\n  Bold as BoldIcon,\n  Italic as ItalicIcon,\n  List,\n  ListOrdered,\n  Image as ImageIcon,\n  Mic,\n  Loader2,\n  CheckCircle2,\n  Eye,\n  Type,\n  ChevronDown,\n  Minimize2,\n  Maximize2,\n  PenLine,\n  Clock,\n} from \"lucide-react\";\n\n// Tippy for manual floating menu\nimport tippy, { Instance as TippyInstance } from \"tippy.js\";\nimport \"tippy.js/dist/tippy.css\";\nimport \"tippy.js/dist/svg-arrow.css\";\n\n// Tiptap Core\nimport {\n  useEditor,\n  EditorContent,\n  Node as TiptapNode,\n  mergeAttributes,\n} from \"@tiptap/react\";\nimport Document from \"@tiptap/extension-document\";\nimport Paragraph from \"@tiptap/extension-paragraph\";\nimport Text from \"@tiptap/extension-text\";\nimport Bold from \"@tiptap/extension-bold\";\nimport Italic from \"@tiptap/extension-italic\";\nimport BulletList from \"@tiptap/extension-bullet-list\";\nimport OrderedList from \"@tiptap/extension-ordered-list\";\nimport ListItem from \"@tiptap/extension-list-item\";\nimport History from \"@tiptap/extension-history\";\nimport Placeholder from \"@tiptap/extension-placeholder\";\nimport ImageExtension from \"@tiptap/extension-image\";\nimport Link from \"@tiptap/extension-link\";\nimport BubbleMenuExtension from \"@tiptap/extension-bubble-menu\";\nimport { TextStyle } from \"@tiptap/extension-text-style\";\nimport FontFamily from \"@tiptap/extension-font-family\";\nimport { AudioRecorder } from \"@/components/AudioRecorder\";\n\n/* --------------------\n   Custom Components\n   -------------------- */\n\n// 1. Toolbar Button\nconst ToolbarBtn = ({\n  onClick,\n  isActive = false,\n  icon: Icon,\n  label,\n  className = \"\",\n}: {\n  onClick: () => void;\n  isActive?: boolean;\n  icon: any;\n  label: string;\n  className?: string;\n}) => (\n  <button\n    type=\"button\"\n    onClick={(e) => {\n      e.preventDefault();\n      e.stopPropagation();\n      onClick();\n    }}\n    className={`group relative p-2 rounded transition-all duration-200 ${\n      isActive\n        ? \"bg-blue-100 text-blue-600 ring-1 ring-blue-200\"\n        : \"text-gray-500 hover:bg-gray-100 hover:text-blue-600\"\n    } ${className}`}\n  >\n    <Icon size={18} />\n    <span className=\"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-gray-800 text-gray-100 text-[10px] font-medium px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-sm\">\n      {label}\n      <span className=\"absolute -top-1 left-1/2 -translate-x-1/2 border-4 border-transparent border-b-gray-800\"></span>\n    </span>\n  </button>\n);\n\n// 2. Custom Audio Node\nconst CustomAudio = TiptapNode.create({\n  name: \"audio\",\n  group: \"block\",\n  atom: true,\n  addAttributes() {\n    return { src: { default: null }, controls: { default: true } };\n  },\n  parseHTML() {\n    return [{ tag: \"audio[src]\" }];\n  },\n  renderHTML({ HTMLAttributes }) {\n    return [\n      \"div\",\n      {\n        class:\n          \"audio-player my-4 w-full flex justify-center items-center bg-gray-50/50 rounded-lg py-2 cursor-pointer\",\n        \"data-audio-wrapper\": \"true\",\n      },\n      [\"audio\", mergeAttributes(HTMLAttributes)],\n    ];\n  },\n  addCommands() {\n    return {\n      setAudio:\n        (options: { src: string }) =>\n        ({ commands }: any) =>\n          commands.insertContent({ type: this.name, attrs: options }),\n    };\n  },\n});\n\n/* --------------------\n   Config\n   -------------------- */\nconst MOODS = [\n  { label: \"Amazing\", emoji: \"ü§©\" },\n  { label: \"Happy\", emoji: \"üôÇ\" },\n  { label: \"Neutral\", emoji: \"üòê\" },\n  { label: \"Tired\", emoji: \"üò¥\" },\n  { label: \"Sad\", emoji: \"üò¢\" },\n  { label: \"Stressed\", emoji: \"üò´\" },\n  { label: \"Angry\", emoji: \"üò°\" },\n];\n\nconst FONTS = [\n  { name: \"Default\", value: \"Inter, sans-serif\" },\n  { name: \"Serif\", value: \"'Lora', serif\" },\n  { name: \"Handwritten\", value: \"'Dancing Script', cursive\" },\n  { name: \"Casual\", value: \"'Patrick Hand', cursive\" },\n  { name: \"Mono\", value: \"'JetBrains Mono', monospace\" },\n];\n\nconst caretStorageKey = (dateStr: string) => `diary-caret-${dateStr}`;\n\nexport default function DiaryPage() {\n  const { entries, saveEntry, deleteDiaryEntry } = useDiary();\n\n  const [selectedDate, setSelectedDate] = useState<Date>(new Date());\n  const [isZenMode, setIsZenMode] = useState(false);\n\n  // Editor UI state\n  const [mood, setMood] = useState<string | null>(null);\n  const [energy, setEnergy] = useState<number>(5);\n  const [tags, setTags] = useState<string[]>([]);\n  const [newTag, setNewTag] = useState(\"\");\n  const [saveStatus, setSaveStatus] = useState<\"saved\" | \"unsaved\" | \"saving\">(\n    \"saved\"\n  );\n  const [isFontMenuOpen, setIsFontMenuOpen] = useState(false);\n\n  const [, setEditorUpdateTrigger] = useState(0);\n\n  // Calendar state\n  const [isCalendarOpen, setIsCalendarOpen] = useState(false);\n  const [calendarViewDate, setCalendarViewDate] = useState(new Date());\n  const calendarRef = useRef<HTMLDivElement>(null);\n\n  // Context\n  const [weather, setWeather] = useState<{\n    temp: number;\n    condition: string;\n    city: string;\n  } | null>(null);\n  const [locationName, setLocationName] = useState<string>(\"Locating...\");\n\n  // UI flags\n  const [isUploading, setIsUploading] = useState(false);\n  const [isAudioModalOpen, setIsAudioModalOpen] = useState(false);\n  const [isDeletingMedia, setIsDeletingMedia] = useState(false);\n  const [isDeletingEntry, setIsDeletingEntry] = useState(false);\n\n  // Privacy & State Management\n  const [hasExistingEntry, setHasExistingEntry] = useState(false);\n  const [isRevealed, setIsRevealed] = useState(false); // For \"Hidden for Privacy\"\n  const [isWriting, setIsWriting] = useState(false); // For \"Start Writing\" (Empty State)\n\n  const isInitialLoad = useRef(true);\n\n  // Refs\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const menuContainerRef = useRef<HTMLDivElement | null>(null);\n  const tippyInstance = useRef<TippyInstance | null>(null);\n  const lastSelectedPos = useRef<number | null>(null);\n  const fontMenuRef = useRef<HTMLDivElement>(null);\n\n  // --- 1. Editor Setup ---\n  const editor = useEditor({\n    extensions: [\n      Document,\n      Paragraph,\n      Text,\n      Bold,\n      Italic,\n      TextStyle,\n      FontFamily,\n      BulletList,\n      OrderedList,\n      ListItem,\n      History,\n      Link.configure({ openOnClick: true, autolink: true }),\n      ImageExtension.configure({ inline: false, allowBase64: true }),\n      Placeholder.configure({ placeholder: \"Dear Diary...\" }),\n      BubbleMenuExtension,\n      CustomAudio,\n    ],\n    editorProps: {\n      attributes: {\n        class:\n          \"prose prose-lg max-w-none focus:outline-none min-h-[300px] text-gray-800 leading-relaxed [&_img]:max-h-[300px] [&_img]:rounded-lg [&_img]:shadow-md [&_img]:mx-auto [&_img]:cursor-pointer [&_img]:transition-opacity hover:[&_img]:opacity-90 [&_img]:border-2 [&_img]:border-transparent [&_img.ProseMirror-selectednode]:border-blue-500 [&_ul]:list-disc [&_ul]:pl-5 [&_ol]:list-decimal [&_ol]:pl-5\",\n      },\n    },\n    onTransaction: () => {\n      setEditorUpdateTrigger(Date.now());\n    },\n    onUpdate: () => {\n      setSaveStatus(\"unsaved\");\n      isInitialLoad.current = false;\n      // If typing starts, we are definitely writing\n      if (!isWriting) setIsWriting(true);\n\n      try {\n        const dateKey = format(selectedDate, \"yyyy-MM-dd\");\n        const pos = editor?.state.selection.from ?? null;\n        if (pos !== null)\n          localStorage.setItem(caretStorageKey(dateKey), String(pos));\n      } catch {}\n    },\n    immediatelyRender: false,\n  });\n\n  const currentDateKey = useCallback(\n    () => format(selectedDate, \"yyyy-MM-dd\"),\n    [selectedDate]\n  );\n\n  // --- Navigation Helper (Prevents Data Loss) ---\n  const safeDateChange = (newDate: Date) => {\n    if (saveStatus === \"unsaved\") {\n      if (!confirm(\"You have unsaved changes. Discard them and leave?\")) {\n        return;\n      }\n    }\n    setSelectedDate(newDate);\n  };\n\n  // --- 2. Privacy & Sync Logic (Fixed for Empty States) ---\n\n  // Reset State on Date Change\n  useEffect(() => {\n    isInitialLoad.current = true;\n    setIsRevealed(false);\n    setIsWriting(false); // Default to \"Not Writing\" (Show Empty State) until checked\n    setHasExistingEntry(false);\n  }, [selectedDate]);\n\n  useEffect(() => {\n    if (!editor) return;\n    const dateStr = currentDateKey();\n    const existingEntry = entries.find((e) => e.entryDate === dateStr);\n\n    if (existingEntry) {\n      // Entry Exists -> Show Privacy Screen\n      setHasExistingEntry(true);\n      setIsWriting(true); // Content exists, so we are in writing mode (just hidden)\n\n      if (isInitialLoad.current) {\n        setIsRevealed(false); // Force hide on load\n        isInitialLoad.current = false;\n\n        if (editor.getHTML() !== existingEntry.content) {\n          editor.commands.setContent(existingEntry.content);\n        }\n\n        setMood(existingEntry.mood || null);\n        setEnergy(existingEntry.energy || 5);\n        setTags(existingEntry.tags || []);\n        if (existingEntry.weather) setWeather(existingEntry.weather);\n        if (existingEntry.location) setLocationName(existingEntry.location);\n      }\n      setSaveStatus(\"saved\");\n    } else {\n      // No Entry -> Show Empty State\n      setHasExistingEntry(false);\n\n      // ‚úÖ FIX: Force Clear Editor Content when switching to a date with no entry\n      editor.commands.clearContent();\n\n      // If it's Today, we might want to just let them write immediately (Optional)\n      // But keeping it consistent with \"Start Writing\" is cleaner.\n      // Let's auto-start writing ONLY if it's TODAY and user just loaded the app (optional UX).\n      // For now, sticking to \"Show Empty State\" for all dates with no data is consistent.\n\n      setIsWriting(false); // This triggers the \"Empty State\" UI\n\n      setMood(null);\n      setEnergy(5);\n      setTags([]);\n      setSaveStatus(\"saved\");\n      if (!isSameDay(selectedDate, new Date())) {\n        setWeather(null);\n        setLocationName(\"\");\n      }\n    }\n  }, [editor, entries, currentDateKey, selectedDate]);\n\n  const handleReveal = () => {\n    if (!editor) return;\n    const dateStr = currentDateKey();\n    const existingEntry = entries.find((e) => e.entryDate === dateStr);\n\n    isInitialLoad.current = false;\n\n    if (existingEntry) {\n      if (editor.getHTML() !== existingEntry.content) {\n        editor.commands.setContent(existingEntry.content);\n      }\n      try {\n        const saved = localStorage.getItem(caretStorageKey(dateStr));\n        if (saved) {\n          const pos = parseInt(saved);\n          if (!isNaN(pos)) {\n            setTimeout(() => {\n              editor.commands.focus();\n              editor.commands.setTextSelection(pos);\n            }, 10);\n          }\n        }\n      } catch {}\n    }\n    setIsRevealed(true);\n  };\n\n  const startWriting = () => {\n    setIsWriting(true);\n    setIsRevealed(true);\n    editor?.commands.focus();\n  };\n\n  // --- 3. Click Outside Logic ---\n  useEffect(() => {\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        calendarRef.current &&\n        !calendarRef.current.contains(event.target as Node)\n      ) {\n        setIsCalendarOpen(false);\n      }\n      if (\n        fontMenuRef.current &&\n        !fontMenuRef.current.contains(event.target as Node)\n      ) {\n        setIsFontMenuOpen(false);\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n\n  // --- 4. Tippy Logic ---\n  useEffect(() => {\n    if (typeof document !== \"undefined\") {\n      const container = document.createElement(\"div\");\n      container.setAttribute(\"data-tippy-menu\", \"true\");\n      menuContainerRef.current = container;\n      document.body.appendChild(container);\n\n      tippyInstance.current = tippy(document.body, {\n        content: container,\n        trigger: \"manual\",\n        interactive: true,\n        placement: \"right\",\n        appendTo: document.body,\n        animation: \"shift-away\",\n        zIndex: 9999,\n        arrow: true,\n        offset: [0, 15],\n      });\n\n      return () => {\n        tippyInstance.current?.destroy();\n        if (menuContainerRef.current?.parentNode) {\n          menuContainerRef.current.parentNode.removeChild(\n            menuContainerRef.current\n          );\n        }\n      };\n    }\n  }, []);\n\n  const updateBubble = useCallback(() => {\n    if (!editor || !tippyInstance.current) return;\n    const { state, view } = editor;\n    const { from } = state.selection;\n    const node = state.doc.nodeAt(from);\n    const isMedia =\n      !!node && (node.type.name === \"image\" || node.type.name === \"audio\");\n\n    if (!isMedia) {\n      tippyInstance.current.hide();\n      return;\n    }\n\n    const domNode = view.nodeDOM(from) as HTMLElement;\n    let targetElement = domNode;\n\n    if (node.type.name === \"audio\") {\n      const wrapper = view.dom\n        .querySelector(`[data-audio-wrapper] audio[src=\"${node.attrs.src}\"]`)\n        ?.closest(\".audio-player\");\n      if (wrapper) {\n        const innerAudio = wrapper.querySelector(\"audio\");\n        targetElement = (innerAudio || wrapper) as HTMLElement;\n      } else if (domNode && domNode.classList.contains(\"audio-player\")) {\n        targetElement = domNode;\n      }\n    }\n\n    let rect;\n    if (targetElement && targetElement.getBoundingClientRect) {\n      rect = targetElement.getBoundingClientRect();\n    } else {\n      const coords = view.coordsAtPos(from);\n      rect = {\n        width: 0,\n        height: 0,\n        top: coords.top,\n        bottom: coords.bottom,\n        left: coords.left,\n        right: coords.right,\n      };\n    }\n\n    tippyInstance.current.setProps({\n      getReferenceClientRect: () => rect as DOMRect,\n    });\n    tippyInstance.current.show();\n  }, [editor]);\n\n  useEffect(() => {\n    if (!editor) return;\n    const dom = editor.view.dom;\n    const clickHandler = (e: Event) => {\n      const target = e.target as HTMLElement;\n      const isImg = target.tagName === \"IMG\";\n      const audioWrapper = target.closest(\".audio-player\");\n      const isMediaClick = isImg || audioWrapper;\n\n      if (isMediaClick) {\n        setTimeout(() => {\n          const { from } = editor.state.selection;\n          const isReClickingSameItem = lastSelectedPos.current === from;\n          if (isReClickingSameItem) {\n            const node = editor.state.doc.nodeAt(from);\n            if (node) {\n              const afterPos = from + node.nodeSize;\n              editor.chain().focus().setTextSelection(afterPos).run();\n              tippyInstance.current?.hide();\n              lastSelectedPos.current = null;\n            }\n          } else {\n            updateBubble();\n            lastSelectedPos.current = from;\n          }\n        }, 50);\n      } else {\n        tippyInstance.current?.hide();\n        lastSelectedPos.current = null;\n      }\n    };\n    dom.addEventListener(\"click\", clickHandler);\n    const scrollHandler = () => tippyInstance.current?.hide();\n    window.addEventListener(\"scroll\", scrollHandler, true);\n    return () => {\n      dom.removeEventListener(\"click\", clickHandler);\n      window.removeEventListener(\"scroll\", scrollHandler, true);\n    };\n  }, [editor, updateBubble]);\n\n  // --- 5. Weather ---\n  useEffect(() => {\n    if (!navigator.geolocation) return;\n    navigator.geolocation.getCurrentPosition(\n      async (pos) => {\n        try {\n          const res = await fetch(\n            `https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current=temperature_2m,weather_code&timezone=auto`\n          );\n          const data = await res.json();\n          setWeather({\n            temp: Math.round(data.current.temperature_2m),\n            condition: data.current.weather_code > 3 ? \"Cloudy\" : \"Clear\",\n            city: \"Current Location\",\n          });\n          setLocationName(\n            `${pos.coords.latitude.toFixed(1)}, ${pos.coords.longitude.toFixed(\n              1\n            )}`\n          );\n        } catch (e) {\n          console.error(e);\n        }\n      },\n      () => setLocationName(\"Location denied\")\n    );\n  }, []);\n\n  // --- 6. Handlers ---\n  const handleFileUpload = async (files: FileList | File[] | null) => {\n    if (!editor || !files) return;\n    setIsUploading(true);\n    const filesToUpload = Array.from(files);\n    try {\n      for (const file of filesToUpload) {\n        const s3Response = await uploadToS3(file, \"diary\");\n        if (file.type.startsWith(\"image/\")) {\n          editor\n            .chain()\n            .focus()\n            .setImage({ src: s3Response.url, alt: file.name })\n            .createParagraphNear()\n            .insertContent(\"<p></p>\")\n            .run();\n        } else if (file.type.startsWith(\"audio/\")) {\n          editor\n            .chain()\n            .focus()\n            .setAudio({ src: s3Response.url })\n            .createParagraphNear()\n            .insertContent(\"<p></p>\")\n            .run();\n        }\n      }\n      setSaveStatus(\"unsaved\");\n    } catch {\n      alert(\"Upload failed\");\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const deleteSelectedMedia = useCallback(async () => {\n    if (!editor) return;\n    setIsDeletingMedia(true);\n    const { state } = editor;\n    const { from } = state.selection;\n    const node = state.doc.nodeAt(from);\n    if (node && (node.type.name === \"image\" || node.type.name === \"audio\")) {\n      const src = node.attrs.src;\n      if (src) await deleteFromS3(src);\n      editor.chain().focus().deleteSelection().run();\n      setSaveStatus(\"unsaved\");\n      tippyInstance.current?.hide();\n      lastSelectedPos.current = null;\n    }\n    setIsDeletingMedia(false);\n  }, [editor]);\n\n  const handleSave = async () => {\n    if (!editor) return;\n    setSaveStatus(\"saving\");\n    isInitialLoad.current = false;\n    await saveEntry(\n      {\n        content: editor.getHTML(),\n        mood: mood || undefined,\n        energy,\n        tags,\n        weather,\n        location: locationName,\n      },\n      currentDateKey()\n    );\n    setHasExistingEntry(true);\n    setTimeout(() => setSaveStatus(\"saved\"), 500);\n  };\n\n  const handleDeleteEntry = async () => {\n    const dateStr = currentDateKey();\n    const entry = entries.find((e) => e.entryDate === dateStr);\n    if (!entry) return;\n    if (confirm(\"Delete entry and all attachments?\")) {\n      setIsDeletingEntry(true);\n      const parser = new DOMParser();\n      const doc = parser.parseFromString(entry.content, \"text/html\");\n      const mediaElements = doc.querySelectorAll(\"img, audio\");\n      const deletePromises: Promise<any>[] = [];\n      mediaElements.forEach((el) => {\n        const src = el.getAttribute(\"src\");\n        if (src && src.includes(\"amazonaws.com\"))\n          deletePromises.push(deleteFromS3(src));\n      });\n      if (deletePromises.length) await Promise.all(deletePromises);\n      await deleteDiaryEntry(entry.id);\n      editor?.commands.clearContent();\n      setMood(null);\n      setSaveStatus(\"saved\");\n      setHasExistingEntry(false);\n      setIsRevealed(true);\n      setIsDeletingEntry(false);\n      // Reset to Empty State\n      setIsWriting(false);\n      try {\n        localStorage.removeItem(caretStorageKey(dateStr));\n      } catch {}\n    }\n  };\n\n  const floatingMenu = (\n    <div className=\"bg-gray-900 text-white rounded-lg shadow-xl px-3 py-2 flex items-center gap-2 text-xs font-medium\">\n      <button\n        onClick={deleteSelectedMedia}\n        className=\"flex items-center gap-1 hover:text-red-400 transition-colors\"\n      >\n        {isDeletingMedia ? (\n          <Loader2 size={14} className=\"animate-spin\" />\n        ) : (\n          <Trash2 size={14} />\n        )}\n        <span>Delete</span>\n      </button>\n    </div>\n  );\n\n  const getEnergyColor = (level: number) => {\n    if (level <= 3) return \"text-red-500\";\n    if (level <= 7) return \"text-yellow-500\";\n    return \"text-green-500\";\n  };\n\n  const getEnergyAccent = (level: number) => {\n    if (level <= 3) return \"accent-red-500\";\n    if (level <= 7) return \"accent-yellow-500\";\n    return \"accent-green-500\";\n  };\n\n  return (\n    <>\n      <style jsx global>{`\n        @import url(\"https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&family=JetBrains+Mono:wght@400&family=Lora:ital,wght@0,400..700;1,400..700&family=Patrick+Hand&display=swap\");\n      `}</style>\n\n      <div\n        className={`fixed inset-x-0 bottom-0 top-[64px] bg-[#F3F4F6] overflow-hidden flex flex-col ${\n          isZenMode ? \"z-50 top-0\" : \"\"\n        }`}\n      >\n        <div\n          className={`flex-1 flex gap-4 p-3 w-full h-full ${\n            isZenMode ? \"max-w-4xl mx-auto p-6\" : \"max-w-full\"\n          }`}\n        >\n          {/* LEFT SIDEBAR */}\n          {!isZenMode && (\n            <aside className=\"w-80 h-full flex-shrink-0 hidden lg:flex flex-col gap-4\">\n              <div className=\"bg-white rounded-3xl shadow-sm border border-white/50 flex flex-col h-full overflow-hidden\">\n                <div className=\"p-5 pb-2 flex justify-between items-center relative\">\n                  <h3 className=\"font-bold text-gray-700 flex items-center gap-2\">\n                    History\n                  </h3>\n                  <div className=\"relative group\">\n                    <button\n                      onClick={() => setIsCalendarOpen(!isCalendarOpen)}\n                      className=\"p-2 bg-blue-50 hover:bg-blue-100 rounded-full text-blue-600 transition-colors\"\n                    >\n                      <CalendarIcon size={18} />\n                    </button>\n                    <span className=\"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-gray-800 text-gray-100 text-[10px] font-medium px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-sm\">\n                      Calendar\n                      <span className=\"absolute -top-1 left-1/2 -translate-x-1/2 border-4 border-transparent border-b-gray-800\"></span>\n                    </span>\n                  </div>\n\n                  {/* Calendar Popup */}\n                  {isCalendarOpen && (\n                    <div\n                      ref={calendarRef}\n                      className=\"absolute top-14 right-0 w-72 bg-white border border-gray-200 shadow-xl rounded-2xl z-50 p-4 animate-in fade-in zoom-in-95 duration-100\"\n                    >\n                      <div className=\"flex justify-between items-center mb-4 text-gray-700\">\n                        <div className=\"flex items-center gap-1\">\n                          <button\n                            onClick={() =>\n                              setCalendarViewDate(subYears(calendarViewDate, 1))\n                            }\n                            className=\"p-1 hover:bg-gray-100 rounded\"\n                            title=\"Previous Year\"\n                          >\n                            <ChevronsLeft size={16} />\n                          </button>\n                          <button\n                            onClick={() =>\n                              setCalendarViewDate(\n                                subMonths(calendarViewDate, 1)\n                              )\n                            }\n                            className=\"p-1 hover:bg-gray-100 rounded\"\n                            title=\"Previous Month\"\n                          >\n                            <ChevronLeft size={16} />\n                          </button>\n                        </div>\n\n                        <span className=\"font-bold text-sm\">\n                          {format(calendarViewDate, \"MMMM yyyy\")}\n                        </span>\n\n                        <div className=\"flex items-center gap-1\">\n                          <button\n                            onClick={() =>\n                              setCalendarViewDate(\n                                addMonths(calendarViewDate, 1)\n                              )\n                            }\n                            className=\"p-1 hover:bg-gray-100 rounded\"\n                            title=\"Next Month\"\n                          >\n                            <ChevronRight size={16} />\n                          </button>\n                          <button\n                            onClick={() =>\n                              setCalendarViewDate(addYears(calendarViewDate, 1))\n                            }\n                            className=\"p-1 hover:bg-gray-100 rounded\"\n                            title=\"Next Year\"\n                          >\n                            <ChevronsRight size={16} />\n                          </button>\n                        </div>\n                      </div>\n\n                      <div className=\"grid grid-cols-7 gap-1 text-center text-xs mb-2 font-medium text-gray-400\">\n                        {[\"S\", \"M\", \"T\", \"W\", \"T\", \"F\", \"S\"].map((d, i) => (\n                          <div key={i}>{d}</div>\n                        ))}\n                      </div>\n                      <div className=\"grid grid-cols-7 gap-1 text-center text-sm\">\n                        {Array.from({\n                          length: getDay(startOfMonth(calendarViewDate)),\n                        }).map((_, i) => (\n                          <div key={`e-${i}`} />\n                        ))}\n                        {eachDayOfInterval({\n                          start: startOfMonth(calendarViewDate),\n                          end: endOfMonth(calendarViewDate),\n                        }).map((day) => {\n                          const dateStr = format(day, \"yyyy-MM-dd\");\n                          const hasEntry = entries.some(\n                            (e) => e.entryDate === dateStr\n                          );\n                          const isSelected = isSameDay(day, selectedDate);\n                          const currentMonth = isSameMonth(\n                            day,\n                            calendarViewDate\n                          );\n                          return (\n                            <button\n                              key={dateStr}\n                              onClick={() => {\n                                // ‚úÖ FIX: Safe Navigation with check\n                                safeDateChange(day);\n                                setIsCalendarOpen(false);\n                              }}\n                              className={`w-8 h-8 rounded-full flex items-center justify-center relative \n                                ${\n                                  isSelected\n                                    ? \"bg-black text-white\"\n                                    : \"hover:bg-gray-100\"\n                                }\n                                ${!currentMonth ? \"opacity-30\" : \"\"}\n                              `}\n                            >\n                              {format(day, \"d\")}\n                              {hasEntry && !isSelected && (\n                                <div className=\"absolute bottom-1 w-1 h-1 bg-blue-500 rounded-full\"></div>\n                              )}\n                            </button>\n                          );\n                        })}\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"flex-1 overflow-y-auto custom-scrollbar p-3 space-y-2\">\n                  {entries.map((entry) => (\n                    <div\n                      key={entry.id}\n                      // ‚úÖ FIX: Safe Navigation\n                      onClick={() => safeDateChange(parseISO(entry.entryDate))}\n                      className={`p-3 rounded-xl cursor-pointer transition-all border group ${\n                        isSameDay(parseISO(entry.entryDate), selectedDate)\n                          ? \"bg-blue-50 border-blue-200 shadow-sm\"\n                          : \"bg-gray-50/50 border-transparent hover:bg-gray-100\"\n                      }`}\n                    >\n                      <div className=\"flex justify-between items-center mb-1\">\n                        <span className=\"text-sm font-semibold text-gray-800\">\n                          {format(parseISO(entry.entryDate), \"MMM d, yyyy\")}\n                        </span>\n                        <span className=\"text-lg\">{entry.mood}</span>\n                      </div>\n                      <p className=\"text-xs text-gray-400 overflow-hidden whitespace-nowrap\">\n                        {entry.content.replace(/<[^>]*>?/gm, \"\").slice(0, 12) ||\n                          \"Media...\"}\n                        ...\n                      </p>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            </aside>\n          )}\n\n          {/* MAIN EDITOR */}\n          <main className=\"flex-1 flex flex-col h-full overflow-hidden\">\n            <header className=\"flex-shrink-0 flex justify-between items-end mb-2 px-2\">\n              <div>\n                <div className=\"flex items-center gap-3 text-gray-400 text-sm mb-1 font-medium uppercase tracking-wider\">\n                  {/* ‚úÖ FIX: Safe Navigation Arrows */}\n                  <button\n                    onClick={() => safeDateChange(subDays(selectedDate, 1))}\n                    className=\"hover:text-blue-600\"\n                  >\n                    <ChevronLeft size={16} />\n                  </button>\n                  <span>{isToday(selectedDate) ? \"Today\" : \"Time Travel\"}</span>\n                  <button\n                    onClick={() => safeDateChange(addDays(selectedDate, 1))}\n                    className=\"hover:text-blue-600\"\n                  >\n                    <ChevronRight size={16} />\n                  </button>\n                </div>\n                <h1 className=\"text-2xl sm:text-3xl font-serif font-bold text-gray-900 leading-tight\">\n                  {format(selectedDate, \"EEEE, d MMMM yyyy\")}\n                </h1>\n                <div className=\"flex items-center gap-3 mt-2 text-xs text-gray-500 font-medium\">\n                  <span className=\"flex items-center gap-1 bg-white px-2 py-1 rounded-md shadow-sm\">\n                    {weather?.condition === \"Clear\" ? (\n                      <Sun size={12} className=\"text-orange-400\" />\n                    ) : (\n                      <Cloud size={12} className=\"text-blue-400\" />\n                    )}\n                    {weather\n                      ? `${weather.temp}¬∞C ${weather.condition}`\n                      : \"No Data\"}\n                  </span>\n                  <span className=\"flex items-center gap-1 bg-white px-2 py-1 rounded-md shadow-sm\">\n                    <MapPin size={12} className=\"text-red-400\" /> {locationName}\n                  </span>\n                </div>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"relative group\">\n                  <button\n                    onClick={() => setIsZenMode(!isZenMode)}\n                    className=\"p-2 bg-white text-gray-500 hover:text-blue-600 rounded-xl shadow-sm border border-gray-100\"\n                  >\n                    {isZenMode ? (\n                      <Minimize2 size={20} />\n                    ) : (\n                      <Maximize2 size={20} />\n                    )}\n                  </button>\n                  <span className=\"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-gray-800 text-gray-100 text-[10px] font-medium px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-sm\">\n                    {isZenMode ? \"Exit Zen Mode\" : \"Zen Mode\"}\n                    <span className=\"absolute -top-1 left-1/2 -translate-x-1/2 border-4 border-transparent border-b-gray-800\"></span>\n                  </span>\n                </div>\n              </div>\n            </header>\n\n            <div className=\"flex-1 bg-white rounded-3xl shadow-sm border border-gray-100 flex flex-col overflow-hidden relative\">\n              <div className=\"flex-shrink-0 border-b border-gray-50 p-4 flex flex-wrap gap-6 items-center bg-gray-50/30\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-xs font-bold text-gray-400 uppercase tracking-wider\">\n                    Mood\n                  </span>\n                  <div className=\"flex gap-1\">\n                    {MOODS.map((m) => (\n                      <button\n                        key={m.label}\n                        onClick={() => {\n                          setMood(m.emoji);\n                          setSaveStatus(\"unsaved\");\n                        }}\n                        className={`text-xl p-1.5 rounded-lg transition-all hover:scale-110 ${\n                          mood === m.emoji\n                            ? \"bg-white shadow-md scale-110 ring-1 ring-black/5\"\n                            : \"opacity-60 hover:opacity-100\"\n                        }`}\n                      >\n                        {m.emoji}\n                      </button>\n                    ))}\n                  </div>\n                </div>\n                <div className=\"w-px h-8 bg-gray-200 hidden sm:block\" />\n                <div className=\"flex items-center gap-3 flex-1 min-w-[150px]\">\n                  <div\n                    className={`flex items-center gap-1 text-xs font-bold uppercase tracking-wider ${getEnergyColor(\n                      energy\n                    )}`}\n                  >\n                    <Zap size={14} /> Energy\n                  </div>\n                  <input\n                    type=\"range\"\n                    min=\"1\"\n                    max=\"10\"\n                    value={energy}\n                    onChange={(e) => {\n                      setEnergy(parseInt(e.target.value));\n                      setSaveStatus(\"unsaved\");\n                    }}\n                    className={`flex-1 h-1.5 bg-gray-200 rounded-lg appearance-none cursor-pointer ${getEnergyAccent(\n                      energy\n                    )}`}\n                  />\n                  <span className=\"text-xs font-medium text-gray-600 w-4\">\n                    {energy}\n                  </span>\n                </div>\n              </div>\n\n              {/* LOGIC:\n                  1. Entry Exists + Not Revealed -> Show Privacy Screen\n                  2. No Entry + Not Writing (Empty State) -> Show Empty UI\n                  3. Else -> Show Editor\n              */}\n\n              {hasExistingEntry && !isRevealed ? (\n                <div\n                  className=\"flex-1 flex flex-col items-center justify-center bg-gray-50/50 cursor-pointer group\"\n                  onClick={handleReveal}\n                >\n                  <div className=\"bg-white p-4 rounded-full inline-block mb-4 shadow-sm group-hover:shadow-md transition-shadow\">\n                    <Eye\n                      size={32}\n                      className=\"text-gray-400 group-hover:text-blue-500 transition-colors\"\n                    />\n                  </div>\n                  <h3 className=\"text-xl font-semibold text-gray-700 mb-2\">\n                    Hidden for Privacy\n                  </h3>\n                  <p className=\"text-gray-500\">Tap to read your thoughts.</p>\n                </div>\n              ) : !isWriting && !hasExistingEntry ? (\n                <div className=\"flex-1 flex flex-col items-center justify-center bg-white text-center p-8\">\n                  <div className=\"mb-6 p-6 bg-gray-50 rounded-full\">\n                    {isFuture(selectedDate) ? (\n                      <Clock size={48} className=\"text-gray-300\" />\n                    ) : (\n                      <PenLine size={48} className=\"text-gray-300\" />\n                    )}\n                  </div>\n                  <h3 className=\"text-xl font-serif font-bold text-gray-800 mb-2\">\n                    {isFuture(selectedDate)\n                      ? \"Writing from the future?\"\n                      : \"No entry for this day\"}\n                  </h3>\n                  <p className=\"text-gray-500 max-w-md mb-8 leading-relaxed\">\n                    {isFuture(selectedDate)\n                      ? \"This day hasn't happened yet. But hey, if you want to manifest something, go ahead!\"\n                      : \"The pages are empty. Would you like to pen down your thoughts for this day?\"}\n                  </p>\n                  <button\n                    onClick={startWriting}\n                    className=\"bg-gray-900 text-white px-6 py-3 rounded-xl font-medium hover:bg-black transition-all shadow-lg hover:shadow-xl flex items-center gap-2\"\n                  >\n                    <PenLine size={18} />\n                    Start Writing\n                  </button>\n                </div>\n              ) : (\n                <>\n                  <div className=\"flex-shrink-0 flex items-center gap-1 p-2 border-b border-gray-100 bg-white z-10\">\n                    <ToolbarBtn\n                      onClick={() => editor?.chain().focus().toggleBold().run()}\n                      isActive={editor?.isActive(\"bold\")}\n                      icon={BoldIcon}\n                      label=\"Bold\"\n                    />\n                    <ToolbarBtn\n                      onClick={() =>\n                        editor?.chain().focus().toggleItalic().run()\n                      }\n                      isActive={editor?.isActive(\"italic\")}\n                      icon={ItalicIcon}\n                      label=\"Italic\"\n                    />\n\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\n\n                    <div className=\"relative\" ref={fontMenuRef}>\n                      <button\n                        onClick={() => setIsFontMenuOpen(!isFontMenuOpen)}\n                        className=\"group relative p-2 rounded hover:bg-gray-100 text-gray-500 hover:text-blue-600 flex items-center gap-1 text-sm font-medium\"\n                      >\n                        <Type size={18} />\n                        <ChevronDown size={14} />\n                        <span className=\"absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-gray-800 text-gray-100 text-[10px] font-medium px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap z-50 shadow-sm\">\n                          Fonts\n                          <span className=\"absolute -top-1 left-1/2 -translate-x-1/2 border-4 border-transparent border-b-gray-800\"></span>\n                        </span>\n                      </button>\n                      {isFontMenuOpen && (\n                        <div className=\"absolute top-full left-0 mt-1 w-40 bg-white border border-gray-100 rounded-xl shadow-lg z-50 overflow-hidden py-1\">\n                          {FONTS.map((font) => (\n                            <button\n                              key={font.name}\n                              onClick={() => {\n                                editor\n                                  ?.chain()\n                                  .focus()\n                                  .setFontFamily(font.value)\n                                  .run();\n                                setIsFontMenuOpen(false);\n                              }}\n                              className=\"w-full text-left px-3 py-2 text-sm hover:bg-blue-50 text-gray-700 hover:text-blue-600\"\n                              style={{ fontFamily: font.value }}\n                            >\n                              {font.name}\n                            </button>\n                          ))}\n                        </div>\n                      )}\n                    </div>\n\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\n\n                    <ToolbarBtn\n                      onClick={() =>\n                        editor?.chain().focus().toggleBulletList().run()\n                      }\n                      isActive={editor?.isActive(\"bulletList\")}\n                      icon={List}\n                      label=\"Bullet List\"\n                    />\n                    <ToolbarBtn\n                      onClick={() =>\n                        editor?.chain().focus().toggleOrderedList().run()\n                      }\n                      isActive={editor?.isActive(\"orderedList\")}\n                      icon={ListOrdered}\n                      label=\"Ordered List\"\n                    />\n                    <div className=\"w-px h-6 bg-gray-200 mx-2\" />\n\n                    <ToolbarBtn\n                      onClick={() => fileInputRef.current?.click()}\n                      icon={ImageIcon}\n                      label=\"Upload Image\"\n                    />\n\n                    <ToolbarBtn\n                      onClick={() => setIsAudioModalOpen(true)}\n                      icon={Mic}\n                      label=\"Record Audio\"\n                      className=\"hover:text-red-500\"\n                    />\n\n                    {isUploading && (\n                      <span className=\"ml-auto text-xs text-blue-500 flex items-center gap-1\">\n                        <Loader2 size={12} className=\"animate-spin\" />{\" \"}\n                        Uploading...\n                      </span>\n                    )}\n                  </div>\n\n                  <div className=\"flex-1 overflow-y-auto bg-[url('https://www.transparenttextures.com/patterns/notebook.png')]\">\n                    <EditorContent editor={editor} className=\"p-8 h-full\" />\n                  </div>\n\n                  <div className=\"flex-shrink-0 p-4 bg-gray-50/50 border-t border-gray-100 flex flex-col sm:flex-row justify-between items-center gap-4\">\n                    <div className=\"flex items-center gap-2 w-full sm:flex-1 overflow-hidden\">\n                      <Hash size={16} className=\"text-gray-400 flex-shrink-0\" />\n                      <div className=\"flex gap-2 overflow-x-auto no-scrollbar items-center flex-1\">\n                        {tags.map((tag) => (\n                          <span\n                            key={tag}\n                            className=\"bg-white border border-gray-200 text-gray-600 px-2 py-1 rounded-md text-xs font-medium flex items-center gap-1 whitespace-nowrap\"\n                          >\n                            #{tag}{\" \"}\n                            <button\n                              onClick={() =>\n                                setTags(tags.filter((t) => t !== tag))\n                              }\n                              className=\"hover:text-red-500\"\n                            >\n                              √ó\n                            </button>\n                          </span>\n                        ))}\n                        <input\n                          type=\"text\"\n                          value={newTag}\n                          onChange={(e) => setNewTag(e.target.value)}\n                          onKeyDown={(e) =>\n                            (e.key === \"Enter\" &&\n                              newTag.trim() &&\n                              setTags([...tags, newTag])) ||\n                            setNewTag(\"\")\n                          }\n                          placeholder=\"Add tag...\"\n                          className=\"bg-transparent text-sm outline-none min-w-[80px] flex-1 placeholder:text-gray-400\"\n                        />\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3 self-end sm:self-auto\">\n                      {hasExistingEntry && (\n                        <button\n                          onClick={handleDeleteEntry}\n                          className=\"p-2 text-red-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors\"\n                          title=\"Delete Entire Entry\"\n                        >\n                          {isDeletingEntry ? (\n                            <Loader2 size={18} className=\"animate-spin\" />\n                          ) : (\n                            <Trash2 size={18} />\n                          )}\n                        </button>\n                      )}\n                      <button\n                        onClick={handleSave}\n                        disabled={saveStatus === \"saved\"}\n                        className={`px-6 py-2 rounded-xl text-sm font-medium transition-all flex items-center gap-2 shadow-sm ${\n                          saveStatus === \"unsaved\"\n                            ? \"bg-indigo-600 text-white hover:bg-indigo-700\"\n                            : \"bg-green-100 text-green-700 cursor-default\"\n                        }`}\n                      >\n                        {saveStatus === \"saving\" ? (\n                          <Loader2 size={16} className=\"animate-spin\" />\n                        ) : saveStatus === \"unsaved\" ? (\n                          <Save size={16} />\n                        ) : (\n                          <CheckCircle2 size={16} />\n                        )}\n                        {saveStatus === \"saved\"\n                          ? \"Saved\"\n                          : saveStatus === \"saving\"\n                          ? \"Saving...\"\n                          : \"Save Changes\"}\n                      </button>\n                    </div>\n                  </div>\n                </>\n              )}\n            </div>\n          </main>\n\n          <input\n            type=\"file\"\n            ref={fileInputRef}\n            className=\"hidden\"\n            accept=\"image/*\"\n            onChange={(e) => {\n              handleFileUpload(e.target.files);\n              e.target.value = \"\";\n            }}\n          />\n          {isAudioModalOpen && (\n            <AudioRecorder\n              onClose={() => setIsAudioModalOpen(false)}\n              onAdd={(file) => handleFileUpload([file] as any)}\n            />\n          )}\n        </div>\n      </div>\n\n      {menuContainerRef.current &&\n        createPortal(floatingMenu, menuContainerRef.current)}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}